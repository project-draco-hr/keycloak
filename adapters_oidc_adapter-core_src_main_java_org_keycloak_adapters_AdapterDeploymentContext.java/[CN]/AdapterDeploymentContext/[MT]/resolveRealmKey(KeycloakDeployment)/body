{
  if (deployment.getClient() == null) {
    throw new RuntimeException("KeycloakDeployment was never initialized through appropriate SPIs");
  }
  HttpGet get=new HttpGet(deployment.getRealmInfoUrl());
  try {
    HttpResponse response=deployment.getClient().execute(get);
    int status=response.getStatusLine().getStatusCode();
    if (status != 200) {
      close(response);
      throw new RuntimeException("Unable to resolve realm public key remotely, status = " + status);
    }
    HttpEntity entity=response.getEntity();
    if (entity == null) {
      throw new RuntimeException("Unable to resolve realm public key remotely.  There was no entity.");
    }
    InputStream is=entity.getContent();
    try {
      ByteArrayOutputStream os=new ByteArrayOutputStream();
      int c;
      while ((c=is.read()) != -1) {
        os.write(c);
      }
      byte[] bytes=os.toByteArray();
      String json=new String(bytes);
      PublishedRealmRepresentation rep=JsonSerialization.readValue(json,PublishedRealmRepresentation.class);
      deployment.setRealmKey(rep.getPublicKey());
    }
  finally {
      try {
        is.close();
      }
 catch (      IOException ignored) {
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException("Unable to resolve realm public key remotely",e);
  }
}
