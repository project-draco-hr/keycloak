{
  KeycloakRegistry registry=ResteasyProviderFactory.getContextData(KeycloakRegistry.class);
  if (registry == null) {
    logger.warn("KeycloakRegistry not found");
    return null;
  }
  PartitionManagerRegistry partitionManagerRegistry=registry.getService(PartitionManagerRegistry.class);
  if (partitionManagerRegistry == null) {
    partitionManagerRegistry=new PartitionManagerRegistry();
    partitionManagerRegistry=registry.putServiceIfAbsent(PartitionManagerRegistry.class,partitionManagerRegistry);
    logger.info("Pushed PartitionManagerRegistry component");
  }
  return partitionManagerRegistry.getPartitionManager(realm);
}
