{
  if (encodedToken == null) {
    throw new IdentityBrokerException("No id_token from server.");
  }
  try {
    JWSInput jws=new JWSInput(encodedToken);
    if (!verify(jws,key)) {
      throw new IdentityBrokerException("IDToken signature validation failed");
    }
    IDToken idToken=jws.readJsonContent(IDToken.class);
    String aud=idToken.getAudience();
    String iss=idToken.getIssuer();
    if (aud != null && !aud.equals(getConfig().getClientId())) {
      throw new IdentityBrokerException("Wrong audience from id_token..");
    }
    String trustedIssuers=getConfig().getIssuer();
    if (trustedIssuers != null) {
      String[] issuers=trustedIssuers.split(",");
      for (      String trustedIssuer : issuers) {
        if (iss != null && iss.equals(trustedIssuer.trim())) {
          return idToken;
        }
      }
      throw new IdentityBrokerException("Wrong issuer from id_token. Got: " + iss + " expected: "+ getConfig().getIssuer());
    }
    return idToken;
  }
 catch (  IOException e) {
    throw new IdentityBrokerException("Could not decode id token.",e);
  }
}
