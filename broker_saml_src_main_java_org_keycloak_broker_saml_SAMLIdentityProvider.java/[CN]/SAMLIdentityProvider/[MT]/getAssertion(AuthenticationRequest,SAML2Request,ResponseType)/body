{
  validateStatusResponse(responseType);
  validateSignature(saml2Request);
  List<RTChoiceType> assertions=responseType.getAssertions();
  if (assertions.isEmpty()) {
    throw new RuntimeException("No assertion from response.");
  }
  RTChoiceType rtChoiceType=assertions.get(0);
  EncryptedAssertionType encryptedAssertion=rtChoiceType.getEncryptedAssertion();
  if (encryptedAssertion != null) {
    decryptAssertion(responseType,request.getRealm().getPrivateKey());
  }
  return responseType.getAssertions().get(0).getAssertion();
}
