{
  super(servletContext,dispatcher);
  KeycloakSession session=factory.createSession();
  session.getTransaction().begin();
  try {
    InputStream is=servletContext.getResourceAsStream("/WEB-INF/testrealm.json");
    RealmRepresentation rep=loadJson(is,RealmRepresentation.class);
    RealmModel realm=importRealm(session,rep);
    AdapterDeploymentContext deploymentContext=(AdapterDeploymentContext)servletContext.getAttribute(AdapterDeploymentContext.class.getName());
    AdapterConfig adapterConfig=new AdapterConfig();
    String host=(String)servletContext.getInitParameter("host-port");
    String uri=KeycloakUriBuilder.fromUri("http://" + host).path(servletContext.getContextPath()).path("auth").build().toString();
    log.info("**** auth server url: " + uri);
    adapterConfig.setRealm("demo");
    adapterConfig.setResource("customer-portal");
    adapterConfig.setRealmKey(realm.getPublicKeyPem());
    Map<String,String> creds=new HashMap<String,String>();
    creds.put(CredentialRepresentation.SECRET,"password");
    adapterConfig.setCredentials(creds);
    adapterConfig.setAuthServerUrl(uri);
    adapterConfig.setSslNotRequired(true);
    deploymentContext.updateDeployment(adapterConfig);
    session.getTransaction().commit();
  }
  finally {
    session.close();
  }
}
