{
synchronized (allProviders) {
    if (!kcdata.exists()) {
      return;
    }
    FileInputStream fis=null;
    try {
      fis=new FileInputStream(kcdata);
      Model model=JsonSerialization.readValue(fis,Model.class);
      ImportUtils.importFromStream(session,JsonSerialization.mapper,fis,Strategy.IGNORE_EXISTING);
      session.realms().getMigrationModel().setStoredVersion(model.getModelVersion());
      List<RealmRepresentation> realmReps=new ArrayList<RealmRepresentation>();
      for (      RealmRepresentation realmRep : model.getRealms()) {
        if (Config.getAdminRealm().equals(realmRep.getRealm())) {
          realmReps.add(0,realmRep);
        }
 else {
          realmReps.add(realmRep);
        }
      }
      for (      RealmRepresentation realmRep : realmReps) {
        ImportUtils.importRealm(session,realmRep,Strategy.IGNORE_EXISTING);
      }
    }
 catch (    IOException ioe) {
      logger.error("Unable to read model file " + kcdata.getAbsolutePath(),ioe);
    }
 finally {
      try {
        if (fis != null) {
          fis.close();
        }
      }
 catch (      IOException e) {
        logger.error("Failed to close output stream.",e);
      }
    }
  }
}
