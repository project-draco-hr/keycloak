{
  if (cacheManager == null) {
synchronized (this) {
      if (cacheManager == null) {
        String cacheContainer=config.get("cacheContainer");
        if (cacheContainer != null) {
          initContainerManaged(cacheContainer);
        }
 else {
          initEmbedded();
        }
        if (cacheManager.getCacheConfiguration(InfinispanConnectionProvider.OFFLINE_SESSION_CACHE_NAME) == null) {
          logger.debugf("No configuration provided for '%s' cache. Using '%s' configuration as template",InfinispanConnectionProvider.OFFLINE_SESSION_CACHE_NAME,InfinispanConnectionProvider.SESSION_CACHE_NAME);
          Configuration sessionCacheConfig=cacheManager.getCacheConfiguration(InfinispanConnectionProvider.SESSION_CACHE_NAME);
          if (sessionCacheConfig != null) {
            ConfigurationBuilder confBuilder=new ConfigurationBuilder().read(sessionCacheConfig);
            Configuration offlineSessionConfig=confBuilder.build();
            cacheManager.defineConfiguration(InfinispanConnectionProvider.OFFLINE_SESSION_CACHE_NAME,offlineSessionConfig);
          }
        }
      }
    }
  }
}
