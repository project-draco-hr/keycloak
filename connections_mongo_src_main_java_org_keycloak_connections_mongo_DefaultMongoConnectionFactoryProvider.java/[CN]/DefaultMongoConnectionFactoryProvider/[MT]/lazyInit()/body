{
  if (client == null) {
synchronized (this) {
      if (client == null) {
        try {
          String host=config.get("host",ServerAddress.defaultHost());
          int port=config.getInt("port",ServerAddress.defaultPort());
          String dbName=config.get("db","keycloak");
          boolean clearOnStartup=config.getBoolean("clearOnStartup",false);
          String user=config.get("user");
          String password=config.get("password");
          if (user != null && password != null) {
            MongoCredential credential=MongoCredential.createMongoCRCredential(user,dbName,password.toCharArray());
            client=new MongoClient(new ServerAddress(host,port),Collections.singletonList(credential));
          }
 else {
            client=new MongoClient(host,port);
          }
          this.db=client.getDB(dbName);
          this.mongoStore=new MongoStoreImpl(db,clearOnStartup,getManagedEntities());
          logger.infof("Initialized mongo model. host: %s, port: %d, db: %s, clearOnStartup: %b",host,port,dbName,clearOnStartup);
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
}
