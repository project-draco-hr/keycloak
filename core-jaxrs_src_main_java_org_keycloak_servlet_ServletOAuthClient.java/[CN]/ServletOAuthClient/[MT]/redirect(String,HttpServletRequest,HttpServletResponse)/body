{
  String state=getStateCode();
  URI url=UriBuilder.fromUri(authUrl).queryParam("client_id",clientId).queryParam("redirect_uri",redirectUri).queryParam("state",state).build();
  String stateCookiePath=this.stateCookiePath;
  if (stateCookiePath == null)   stateCookiePath=request.getContextPath();
  if (stateCookiePath.equals(""))   stateCookiePath="/";
  Cookie cookie=new Cookie(stateCookieName,state);
  cookie.setSecure(isSecure);
  cookie.setPath(stateCookiePath);
  response.addCookie(cookie);
  response.sendRedirect(url.toString());
}
