{
  redirectUri=stripOauthParametersFromRedirect(redirectUri);
  String authHeader=BasicAuthHelper.createHeader(clientId,password);
  Form codeForm=new Form().param("grant_type","authorization_code").param("code",code).param("client_id",clientId).param("Password",password).param("redirect_uri",redirectUri);
  Response res=client.target(codeUrl).request().header(HttpHeaders.AUTHORIZATION,authHeader).post(Entity.form(codeForm));
  try {
    if (res.getStatus() == 400) {
      throw new BadRequestException();
    }
 else     if (res.getStatus() != 200) {
      throw new InternalServerErrorException(new Exception("Unknown error when getting acess token"));
    }
    AccessTokenResponse tokenResponse=res.readEntity(AccessTokenResponse.class);
    return tokenResponse.getToken();
  }
  finally {
    res.close();
  }
}
