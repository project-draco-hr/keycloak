{
  JWSInput input=null;
  try {
    input=new JWSInput(tokenString);
  }
 catch (  Exception e) {
    throw new VerificationException("Couldn't parse token",e);
  }
  if (!isPublicKeyValid(input,realmKey))   throw new VerificationException("Invalid token signature.");
  AccessToken token;
  try {
    token=input.readJsonContent(AccessToken.class);
  }
 catch (  IOException e) {
    throw new VerificationException("Couldn't parse token signature",e);
  }
  String user=token.getSubject();
  if (user == null) {
    throw new VerificationException("Token user was null.");
  }
  if (!realm.equals(token.getAudience())) {
    throw new VerificationException("Token audience doesn't match domain.");
  }
  if (checkActive && !token.isActive()) {
    throw new VerificationException("Token is not active.");
  }
  return token;
}
