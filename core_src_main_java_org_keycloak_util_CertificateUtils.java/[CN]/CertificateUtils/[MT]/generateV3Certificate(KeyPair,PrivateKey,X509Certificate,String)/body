{
  X509V3CertificateGenerator certGen=new X509V3CertificateGenerator();
  X500Principal subjectName=new X500Principal("CN=" + subject);
  BigInteger serialNumber=BigInteger.valueOf(System.currentTimeMillis());
  certGen.setSerialNumber(serialNumber);
  certGen.setIssuerDN(caCert.getSubjectX500Principal());
  certGen.setNotBefore(new Date(System.currentTimeMillis() - 100000));
  Calendar calendar=Calendar.getInstance();
  calendar.add(Calendar.YEAR,10);
  certGen.setNotAfter(calendar.getTime());
  certGen.setSubjectDN(subjectName);
  certGen.setPublicKey(keyPair.getPublic());
  certGen.setSignatureAlgorithm("SHA256WithRSAEncryption");
  certGen.addExtension(X509Extensions.AuthorityKeyIdentifier,false,new AuthorityKeyIdentifierStructure(caCert));
  certGen.addExtension(X509Extensions.SubjectKeyIdentifier,false,new SubjectKeyIdentifierStructure(keyPair.getPublic()));
  X509Certificate cert=certGen.generate(caPrivateKey,"BC");
  return cert;
}
