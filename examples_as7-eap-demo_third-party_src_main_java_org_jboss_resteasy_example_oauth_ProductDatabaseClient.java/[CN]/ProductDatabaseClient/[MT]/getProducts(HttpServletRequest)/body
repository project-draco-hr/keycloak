{
  ServletOAuthClient oAuthClient=(ServletOAuthClient)request.getServletContext().getAttribute(ServletOAuthClient.class.getName());
  String token=oAuthClient.getBearerToken(request);
  ResteasyClient client=new ResteasyClientBuilder().trustStore(oAuthClient.getTruststore()).hostnameVerification(ResteasyClientBuilder.HostnameVerificationPolicy.ANY).build();
  try {
    Response response=client.target("http://localhost:8080/database/products").request().get();
    response.close();
    if (response.getStatus() != 401) {
      response.close();
      client.close();
      throw new RuntimeException("Expecting an auth status code: " + response.getStatus());
    }
  }
  finally {
  }
  try {
    Response response=client.target("http://localhost:8080/database/products").request().header(HttpHeaders.AUTHORIZATION,"Bearer " + token).get();
    if (response.getStatus() != 200) {
      response.close();
      throw new RuntimeException("Failed to access!: " + response.getStatus());
    }
    return response.readEntity(new GenericType<List<String>>(){
    }
);
  }
  finally {
    client.close();
  }
}
