{
  try {
    Socket socket=server.accept();
    System.out.println("Request received");
    BufferedReader br=new BufferedReader(new InputStreamReader(socket.getInputStream()));
    String request=br.readLine();
    System.out.println(request);
    String[] params=request.split(" ")[1].substring(2).split("&");
    System.out.println(params.length);
    for (    String param : params) {
      String[] p=param.split("=");
      System.out.println(p[0]);
      if (p[0].equals("code")) {
        code=p[1];
      }
 else       if (p[0].equals("error")) {
        error=p[1];
      }
 else       if (p[0].equals("state")) {
        state=p[1];
      }
    }
    PrintWriter pw=new PrintWriter(new OutputStreamWriter(socket.getOutputStream()));
    pw.println("Please close and return to application");
    pw.flush();
    socket.close();
  }
 catch (  IOException e) {
    error="Local error: " + e.getMessage();
  }
  try {
    server.close();
  }
 catch (  IOException e) {
  }
}
