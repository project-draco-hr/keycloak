{
  try {
    CallbackListener callback=new CallbackListener();
    callback.start();
    String redirectUri=URLEncoder.encode("urn:ietf:wg:oauth:2.0:oob","utf-8");
    String loginUrl=authServerUrl + "/rest/realms/" + realm+ "/tokens/login?"+ "client_id="+ clientId+ "&redirect_uri="+ redirectUri;
    System.out.println("Open the following URL in a browser and paste the code back:");
    System.out.println(loginUrl);
    System.out.print("code: ");
    String code=br.readLine().trim();
    String tokenUrl=authServerUrl + "/rest/realms/" + realm+ "/tokens/access/codes";
    JSONObject response=SimpleHttp.doPost(tokenUrl).param("client_id",clientId).param("code",code).asJson();
    accessToken=response.getString("access_token");
    System.out.println("Access token received");
    return;
  }
 catch (  Throwable e) {
    System.err.println("Failed to log in user: " + e.getMessage());
  }
}
