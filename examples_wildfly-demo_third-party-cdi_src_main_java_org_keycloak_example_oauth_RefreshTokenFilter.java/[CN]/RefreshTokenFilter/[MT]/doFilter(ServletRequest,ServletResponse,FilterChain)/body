{
  HttpServletRequest request=(HttpServletRequest)req;
  HttpServletResponse response=(HttpServletResponse)resp;
  Map<String,String[]> reqParams=request.getParameterMap();
  if (reqParams.containsKey("code")) {
    try {
      String accessToken=oauthClient.getBearerToken(request);
      userData.setAccessToken(accessToken);
    }
 catch (    TokenGrantRequest.HttpFailure e) {
      throw new ServletException(e);
    }
  }
 else   if (reqParams.containsKey("error")) {
    String oauthError=reqParams.get("error")[0];
    request.setAttribute(OAUTH_ERROR_ATTR,oauthError);
  }
  chain.doFilter(request,response);
}
