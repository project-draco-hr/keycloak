{
  KeycloakTransaction tx=session.getTransaction();
  try {
    tx.begin();
    job.run();
    if (tx.isActive()) {
      if (tx.getRollbackOnly()) {
        tx.rollback();
      }
 else {
        tx.commit();
      }
    }
  }
  finally {
    if (tx.isActive()) {
      tx.rollback();
    }
  }
}
