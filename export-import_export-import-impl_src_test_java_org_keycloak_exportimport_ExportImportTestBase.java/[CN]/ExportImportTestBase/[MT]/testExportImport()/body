{
  System.setProperty("keycloak.model.provider",getExportModelProvider());
  factory=KeycloakApplication.createSessionFactory();
  beginTransaction();
  new ApplianceBootstrap().bootstrap(session,"/auth");
  commitTransaction();
  beginTransaction();
  RealmRepresentation rep=AbstractModelTest.loadJson("testrealm.json");
  realmManager=new RealmManager(session);
  RealmModel realm=realmManager.createRealm("demo",rep.getRealm());
  realmManager.importRealm(rep,realm);
  commitTransaction();
  exportModel(factory);
  beginTransaction();
  realm=session.model().getRealm("demo");
  String wburkeId=session.users().getUserByUsername("wburke",realm).getId();
  String appId=realm.getApplicationByName("Application").getId();
  commitTransaction();
  factory.close();
  System.setProperty("keycloak.model.provider",getImportModelProvider());
  factory=KeycloakApplication.createSessionFactory();
  importModel(factory);
  beginTransaction();
  RealmModel importedRealm=session.model().getRealm("demo");
  System.out.println("Exported realm: " + realm + ", Imported realm: "+ importedRealm);
  Assert.assertEquals(wburkeId,session.users().getUserByUsername("wburke",importedRealm).getId());
  Assert.assertEquals(appId,importedRealm.getApplicationByName("Application").getId());
  ImportTest.assertDataImportedInRealm(session,importedRealm);
  commitTransaction();
  factory.close();
}
