{
  if (editMode == EditMode.READ_ONLY || editMode == EditMode.UNSYNCED)   throw new IllegalStateException("Registration is not supported by this ldap server");
  if (!synchronizeRegistrations())   throw new IllegalStateException("Registration is not supported by this ldap server");
  LDAPUser ldapUser=LDAPUtils.addUser(this.ldapIdentityStore,user.getUsername(),user.getFirstName(),user.getLastName(),user.getEmail());
  user.setAttribute(LDAPConstants.LDAP_ID,ldapUser.getId());
  user.setAttribute(LDAPConstants.LDAP_ENTRY_DN,ldapUser.getEntryDN());
  return proxy(user);
}
