{
  if (editMode == EditMode.READ_ONLY || editMode == EditMode.UNSYNCED)   throw new IllegalStateException("Registration is not supported by this ldap server");
  ;
  if (!synchronizeRegistrations())   throw new IllegalStateException("Registration is not supported by this ldap server");
  try {
    User picketlinkUser=LDAPUtils.addUser(this.partitionManager,user.getUsername(),user.getFirstName(),user.getLastName(),user.getEmail());
    user.setAttribute(LDAP_ID,picketlinkUser.getId());
    return proxy(user);
  }
 catch (  IdentityManagementException ie) {
    throw convertIDMException(ie);
  }
}
