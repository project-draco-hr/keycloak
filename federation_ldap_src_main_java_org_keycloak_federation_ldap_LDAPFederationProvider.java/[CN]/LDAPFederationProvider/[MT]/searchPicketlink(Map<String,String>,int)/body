{
  IdentityManager identityManager=getIdentityManager();
  Map<String,User> results=new HashMap<String,User>();
  if (attributes.containsKey(USERNAME)) {
    User user=BasicModel.getUser(identityManager,attributes.get(USERNAME));
    if (user != null) {
      results.put(user.getLoginName(),user);
      return results;
    }
  }
  if (attributes.containsKey(EMAIL)) {
    User user=queryByEmail(identityManager,attributes.get(EMAIL));
    if (user != null) {
      results.put(user.getLoginName(),user);
      return results;
    }
  }
  if (attributes.containsKey(FIRST_NAME) || attributes.containsKey(LAST_NAME)) {
    IdentityQuery<User> query=identityManager.createIdentityQuery(User.class);
    if (attributes.containsKey(FIRST_NAME)) {
      query.setParameter(User.FIRST_NAME,attributes.get(FIRST_NAME));
    }
    if (attributes.containsKey(LAST_NAME)) {
      query.setParameter(User.LAST_NAME,attributes.get(LAST_NAME));
    }
    query.setLimit(maxResults);
    List<User> agents=query.getResultList();
    for (    User user : agents) {
      results.put(user.getLoginName(),user);
    }
  }
  return results;
}
