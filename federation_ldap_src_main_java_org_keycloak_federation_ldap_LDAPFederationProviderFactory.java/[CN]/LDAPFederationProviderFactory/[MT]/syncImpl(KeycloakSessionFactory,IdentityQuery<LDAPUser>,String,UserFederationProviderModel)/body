{
  boolean pagination=Boolean.parseBoolean(fedModel.getConfig().get(LDAPConstants.PAGINATION));
  if (pagination) {
    String pageSizeConfig=fedModel.getConfig().get(LDAPConstants.BATCH_SIZE_FOR_SYNC);
    int pageSize=pageSizeConfig != null ? Integer.parseInt(pageSizeConfig) : LDAPConstants.DEFAULT_BATCH_SIZE_FOR_SYNC;
    boolean nextPage=true;
    while (nextPage) {
      userQuery.setLimit(pageSize);
      final List<LDAPUser> users=userQuery.getResultList();
      nextPage=userQuery.getPaginationContext() != null;
      KeycloakModelUtils.runJobInTransaction(sessionFactory,new KeycloakSessionTask(){
        @Override public void run(        KeycloakSession session){
          importLdapUsers(session,realmId,fedModel,users);
        }
      }
);
    }
  }
 else {
    final List<LDAPUser> users=userQuery.getResultList();
    KeycloakModelUtils.runJobInTransaction(sessionFactory,new KeycloakSessionTask(){
      @Override public void run(      KeycloakSession session){
        importLdapUsers(session,realmId,fedModel,users);
      }
    }
);
  }
}
