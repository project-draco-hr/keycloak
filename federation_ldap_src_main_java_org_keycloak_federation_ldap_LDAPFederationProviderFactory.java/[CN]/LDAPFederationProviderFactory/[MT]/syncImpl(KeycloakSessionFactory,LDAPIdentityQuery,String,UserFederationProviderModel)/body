{
  final UserFederationSyncResult syncResult=new UserFederationSyncResult();
  boolean pagination=Boolean.parseBoolean(fedModel.getConfig().get(LDAPConstants.PAGINATION));
  if (pagination) {
    String pageSizeConfig=fedModel.getConfig().get(LDAPConstants.BATCH_SIZE_FOR_SYNC);
    int pageSize=pageSizeConfig != null ? Integer.parseInt(pageSizeConfig) : LDAPConstants.DEFAULT_BATCH_SIZE_FOR_SYNC;
    boolean nextPage=true;
    while (nextPage) {
      userQuery.setLimit(pageSize);
      final List<LDAPObject> users=userQuery.getResultList();
      nextPage=userQuery.getPaginationContext() != null;
      KeycloakModelUtils.runJobInTransaction(sessionFactory,new KeycloakSessionTask(){
        @Override public void run(        KeycloakSession session){
          UserFederationSyncResult currentPageSync=importLdapUsers(session,realmId,fedModel,users);
          syncResult.add(currentPageSync);
        }
      }
);
    }
  }
 else {
    final List<LDAPObject> users=userQuery.getResultList();
    KeycloakModelUtils.runJobInTransaction(sessionFactory,new KeycloakSessionTask(){
      @Override public void run(      KeycloakSession session){
        UserFederationSyncResult currentSync=importLdapUsers(session,realmId,fedModel,users);
        syncResult.add(currentSync);
      }
    }
);
  }
  return syncResult;
}
