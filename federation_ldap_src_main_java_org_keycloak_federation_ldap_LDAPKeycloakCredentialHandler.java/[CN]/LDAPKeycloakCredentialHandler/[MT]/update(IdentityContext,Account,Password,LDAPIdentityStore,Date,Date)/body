{
  if (!store.getConfig().isActiveDirectory()) {
    super.update(context,account,password,store,effectiveDate,expiryDate);
  }
 else {
    User user=(User)account;
    LDAPOperationManager operationManager=Reflections.invokeMethod(false,KeycloakLDAPIdentityStore.GET_OPERATION_MANAGER_METHOD,LDAPOperationManager.class,store);
    IdentityManager identityManager=getIdentityManager(context);
    String userDN=getDNOfUser(user,identityManager,store,operationManager);
    updateADPassword(userDN,new String(password.getValue()),operationManager);
    if (userAccountControlAfterPasswordUpdate != null) {
      ModificationItem[] mods=new ModificationItem[1];
      BasicAttribute mod0=new BasicAttribute("userAccountControl",userAccountControlAfterPasswordUpdate);
      mods[0]=new ModificationItem(DirContext.REPLACE_ATTRIBUTE,mod0);
      operationManager.modifyAttribute(userDN,mod0);
    }
  }
}
