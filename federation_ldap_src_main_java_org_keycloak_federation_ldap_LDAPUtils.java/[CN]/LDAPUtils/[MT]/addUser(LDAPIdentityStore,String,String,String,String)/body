{
  if (getUser(ldapIdentityStore,username) != null) {
    throw new ModelDuplicateException("User with same username already exists");
  }
  if (getUserByEmail(ldapIdentityStore,email) != null) {
    throw new ModelDuplicateException("User with same email already exists");
  }
  LDAPUser ldapUser=new LDAPUser(username);
  ldapUser.setFirstName(firstName);
  ldapUser.setLastName(lastName);
  ldapUser.setEmail(email);
  ldapUser.setAttribute(new Attribute<String>("fullName",getFullName(username,firstName,lastName)));
  ldapIdentityStore.add(ldapUser);
  return ldapUser;
}
