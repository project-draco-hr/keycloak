{
  LDAPIdentityStore ldapIdentityStore=provider.getLdapIdentityStore();
  LDAPUser ldapUser=LDAPUtils.getUser(ldapIdentityStore,delegate.getUsername());
  if (ldapUser == null) {
    throw new IllegalStateException("User not found in LDAP storage!");
  }
  ldapUser.setLoginName(username);
  ldapIdentityStore.update(ldapUser);
  delegate.setUsername(username);
}
