{
  IdentityManager identityManager=provider.getIdentityManager();
  try {
    User picketlinkUser=BasicModel.getUser(identityManager,delegate.getUsername());
    if (picketlinkUser == null) {
      throw new IllegalStateException("User not found in LDAP storage!");
    }
    picketlinkUser.setLoginName(username);
    identityManager.update(picketlinkUser);
  }
 catch (  IdentityManagementException ie) {
    throw new ModelException(ie);
  }
  delegate.setUsername(username);
}
