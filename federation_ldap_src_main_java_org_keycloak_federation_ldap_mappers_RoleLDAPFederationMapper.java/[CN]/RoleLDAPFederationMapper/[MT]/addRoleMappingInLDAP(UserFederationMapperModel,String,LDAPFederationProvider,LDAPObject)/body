{
  LDAPObject ldapRole=loadLDAPRoleByName(mapperModel,ldapProvider,roleName);
  if (ldapRole == null) {
    ldapRole=createLDAPRole(mapperModel,roleName,ldapProvider);
  }
  MembershipType membershipType=getMembershipTypeLdapAttribute(mapperModel);
  Set<String> memberships=getExistingMemberships(mapperModel,ldapRole);
  if (membershipType == MembershipType.DN) {
    for (    String membership : memberships) {
      if (LDAPConstants.EMPTY_MEMBER_ATTRIBUTE_VALUE.equals(membership)) {
        memberships.remove(membership);
        break;
      }
    }
  }
  String membership=getMembershipFromUser(ldapUser,membershipType);
  memberships.add(membership);
  ldapRole.setAttribute(getMembershipLdapAttribute(mapperModel),memberships);
  ldapProvider.getLdapIdentityStore().update(ldapRole);
}
