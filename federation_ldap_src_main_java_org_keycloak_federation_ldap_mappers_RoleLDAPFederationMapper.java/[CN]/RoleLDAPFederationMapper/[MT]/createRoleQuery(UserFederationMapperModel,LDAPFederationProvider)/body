{
  LDAPQuery ldapQuery=new LDAPQuery(ldapProvider);
  ldapQuery.setSearchScope(ldapProvider.getLdapIdentityStore().getConfig().getSearchScope());
  String rolesDn=getRolesDn(mapperModel);
  ldapQuery.setSearchDn(rolesDn);
  Collection<String> roleObjectClasses=getRoleObjectClasses(mapperModel,ldapProvider);
  ldapQuery.addObjectClasses(roleObjectClasses);
  String rolesRdnAttr=getRoleNameLdapAttribute(mapperModel);
  ldapQuery.setLdapFilter(mapperModel.getConfig().get(RoleLDAPFederationMapper.ROLES_LDAP_FILTER));
  String membershipAttr=getMembershipLdapAttribute(mapperModel);
  ldapQuery.addReturningLdapAttribute(rolesRdnAttr);
  ldapQuery.addReturningLdapAttribute(membershipAttr);
  return ldapQuery;
}
