{
  String userModelAttrName=mapperModel.getConfig().get(USER_MODEL_ATTRIBUTE);
  String ldapAttrName=mapperModel.getConfig().get(LDAP_ATTRIBUTE);
  Property<Object> userModelProperty=userModelProperties.get(userModelAttrName.toLowerCase());
  if (userModelProperty != null) {
    Object attrValue=userModelProperty.getValue(localUser);
    String valueAsString=(attrValue == null) ? null : attrValue.toString();
    ldapUser.setSingleAttribute(ldapAttrName,valueAsString);
  }
 else {
    List<String> attrValues=localUser.getAttribute(userModelAttrName);
    if (attrValues.size() == 0) {
      ldapUser.setAttribute(ldapAttrName,null);
    }
 else {
      ldapUser.setAttribute(ldapAttrName,new LinkedHashSet<>(attrValues));
    }
  }
  if (isReadOnly(mapperModel)) {
    ldapUser.addReadOnlyAttributeName(ldapAttrName);
  }
}
