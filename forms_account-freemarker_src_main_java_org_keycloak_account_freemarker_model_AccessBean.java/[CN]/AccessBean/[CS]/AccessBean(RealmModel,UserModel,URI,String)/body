{
  List<GrantedConsentModel> grantedConsents=user.getGrantedConsents();
  for (  GrantedConsentModel consent : grantedConsents) {
    ClientModel client=realm.getClientById(consent.getClientId());
    List<RoleModel> realmRolesGranted=new LinkedList<RoleModel>();
    MultivaluedHashMap<String,RoleModel> resourceRolesGranted=new MultivaluedHashMap<String,RoleModel>();
    for (    String roleId : consent.getGrantedRoles()) {
      RoleModel role=realm.getRoleById(roleId);
      if (role.getContainer() instanceof RealmModel) {
        realmRolesGranted.add(role);
      }
 else {
        resourceRolesGranted.add(((ClientModel)role.getContainer()).getClientId(),role);
      }
    }
    List<String> claimsGranted=new LinkedList<String>();
    for (    String protocolMapperId : consent.getGrantedProtocolMappers()) {
      ProtocolMapperModel protocolMapper=client.getProtocolMapperById(protocolMapperId);
      claimsGranted.add(protocolMapper.getConsentText());
    }
    ClientGrantBean clientGrant=new ClientGrantBean(realmRolesGranted,resourceRolesGranted,client,claimsGranted);
    clientGrants.add(clientGrant);
  }
}
