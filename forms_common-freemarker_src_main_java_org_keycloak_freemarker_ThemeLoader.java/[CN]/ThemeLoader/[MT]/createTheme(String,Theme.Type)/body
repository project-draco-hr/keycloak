{
  if (name == null) {
    name=Config.scope("theme").get("default");
  }
  List<ThemeProvider> providers=new LinkedList();
  for (  ThemeProvider p : ProviderLoader.load(ThemeProvider.class)) {
    providers.add(p);
  }
  Collections.sort(providers,new Comparator<ThemeProvider>(){
    @Override public int compare(    ThemeProvider o1,    ThemeProvider o2){
      return o2.getProviderPriority() - o1.getProviderPriority();
    }
  }
);
  Theme theme=findTheme(providers,name,type);
  if (theme.getParentName() != null) {
    List<Theme> themes=new LinkedList<Theme>();
    themes.add(theme);
    if (theme.getImportName() != null) {
      String[] s=theme.getImportName().split("/");
      themes.add(findTheme(providers,s[1],Theme.Type.valueOf(s[0].toUpperCase())));
    }
    for (String parentName=theme.getParentName(); parentName != null; parentName=theme.getParentName()) {
      theme=findTheme(providers,parentName,type);
      themes.add(theme);
      if (theme.getImportName() != null) {
        String[] s=theme.getImportName().split("/");
        themes.add(findTheme(providers,s[1],Theme.Type.valueOf(s[0].toUpperCase())));
      }
    }
    return new ExtendingTheme(themes);
  }
 else {
    return theme;
  }
}
