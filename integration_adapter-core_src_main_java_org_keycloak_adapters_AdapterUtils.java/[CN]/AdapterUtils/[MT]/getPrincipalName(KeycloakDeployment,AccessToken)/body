{
  String attr="sub";
  if (deployment.getPrincipalAttribute() != null)   attr=deployment.getPrincipalAttribute();
  String name=null;
  UserClaimSet claimSet=token.getUserClaimSet();
  if ("sub".equals(attr)) {
    name=token.getSubject();
  }
 else   if ("email".equals(attr)) {
    name=claimSet.getEmail();
  }
 else   if ("preferred_username".equals(attr)) {
    name=claimSet.getPreferredUsername();
  }
 else   if ("name".equals(attr)) {
    name=claimSet.getName();
  }
 else   if ("given_name".equals(attr)) {
    name=claimSet.getGivenName();
  }
 else   if ("family_name".equals(attr)) {
    name=claimSet.getFamilyName();
  }
 else   if ("nickname".equals(attr)) {
    name=claimSet.getNickName();
  }
  if (name == null)   name=token.getSubject();
  return name;
}
