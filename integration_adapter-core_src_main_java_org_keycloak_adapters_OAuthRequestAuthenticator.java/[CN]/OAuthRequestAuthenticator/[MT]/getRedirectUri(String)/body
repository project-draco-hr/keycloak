{
  String url=getRequestUrl();
  log.infof("callback uri: %s",url);
  if (!facade.getRequest().isSecure() && deployment.getSslRequired().isRequired(facade.getRequest().getRemoteAddr())) {
    int port=sslRedirectPort();
    if (port < 0) {
      return null;
    }
    KeycloakUriBuilder secureUrl=KeycloakUriBuilder.fromUri(url).scheme("https").port(-1);
    if (port != 443)     secureUrl.port(port);
    url=secureUrl.build().toString();
  }
  return deployment.getAuthUrl().clone().queryParam(OAuth2Constants.CLIENT_ID,deployment.getResourceName()).queryParam(OAuth2Constants.REDIRECT_URI,url).queryParam(OAuth2Constants.STATE,state).queryParam("login","true").build().toString();
}
