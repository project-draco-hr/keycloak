{
  if (log.isTraceEnabled()) {
    log.trace("K_GET_SESSION_STATS sent");
  }
  try {
    JWSInput token=verifyAdminRequest();
    if (token == null)     return;
    SessionStatsAction action=JsonSerialization.readValue(token.getContent(),SessionStatsAction.class);
    if (!validateAction(action))     return;
    SessionStats stats=new SessionStats();
    stats.setActiveSessions(userSessionManagement.getActiveSessions());
    stats.setActiveUsers(userSessionManagement.getActiveUsers().size());
    if (action.isListUsers() && userSessionManagement.getActiveSessions() > 0) {
      Map<String,UserStats> list=new HashMap<String,UserStats>();
      for (      String user : userSessionManagement.getActiveUsers()) {
        list.put(user,getUserStats(user));
      }
      stats.setUsers(list);
    }
    facade.getResponse().setStatus(200);
    facade.getResponse().setHeader("Content-Type","application/json");
    JsonSerialization.writeValueToStream(facade.getResponse().getOutputStream(),stats);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
