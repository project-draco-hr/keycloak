{
  initTruststore();
  initClientKeystore();
  String realm=adapterConfig.getRealm();
  if (realm == null)   throw new RuntimeException("Must set 'realm' in config");
  String resource=adapterConfig.getResource();
  if (resource == null)   throw new RuntimeException("Must set 'resource' in config");
  String realmKeyPem=adapterConfig.getRealmKey();
  if (realmKeyPem == null) {
    throw new IllegalArgumentException("You must set the realm-public-key");
  }
  PublicKey realmKey=null;
  try {
    realmKey=PemUtils.decodePublicKey(realmKeyPem);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  resourceMetadata=new ResourceMetadata();
  resourceMetadata.setRealm(realm);
  resourceMetadata.setResourceName(resource);
  resourceMetadata.setRealmKey(realmKey);
  resourceMetadata.setClientKeystore(clientCertKeystore);
  String clientKeyPassword=adapterConfig.getClientKeyPassword();
  resourceMetadata.setClientKeyPassword(clientKeyPassword);
  resourceMetadata.setTruststore(this.truststore);
  if (adapterConfig.getScope() != null) {
    String scope=encodeScope(adapterConfig.getScope());
    resourceMetadata.setScope(scope);
  }
}
