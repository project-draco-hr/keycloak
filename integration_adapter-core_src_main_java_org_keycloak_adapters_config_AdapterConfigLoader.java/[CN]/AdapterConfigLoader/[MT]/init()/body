{
  String truststorePath=adapterConfig.getTruststore();
  if (truststorePath != null) {
    truststorePath=EnvUtil.replace(truststorePath);
    String truststorePassword=adapterConfig.getTruststorePassword();
    truststorePath=null;
    try {
      this.truststore=loadKeyStore(truststorePath,truststorePassword);
    }
 catch (    Exception e) {
      throw new RuntimeException("Failed to load truststore",e);
    }
  }
  String clientKeystore=adapterConfig.getClientKeystore();
  String clientKeyPassword=null;
  if (clientKeystore != null) {
    clientKeystore=EnvUtil.replace(clientKeystore);
    String clientKeystorePassword=adapterConfig.getClientKeystorePassword();
    clientCertKeystore=null;
    try {
      clientCertKeystore=loadKeyStore(clientKeystore,clientKeystorePassword);
    }
 catch (    Exception e) {
      throw new RuntimeException("Failed to load keystore",e);
    }
  }
  String realm=adapterConfig.getRealm();
  if (realm == null)   throw new RuntimeException("Must set 'realm' in config");
  String resource=adapterConfig.getResource();
  if (resource == null)   throw new RuntimeException("Must set 'resource' in config");
  String realmKeyPem=adapterConfig.getRealmKey();
  if (realmKeyPem == null) {
    throw new IllegalArgumentException("You must set the realm-public-key");
  }
  PublicKey realmKey=null;
  try {
    realmKey=PemUtils.decodePublicKey(realmKeyPem);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  resourceMetadata=new ResourceMetadata();
  resourceMetadata.setRealm(realm);
  resourceMetadata.setResourceName(resource);
  resourceMetadata.setRealmKey(realmKey);
  resourceMetadata.setClientKeystore(clientCertKeystore);
  clientKeyPassword=adapterConfig.getClientKeyPassword();
  resourceMetadata.setClientKeyPassword(clientKeyPassword);
  resourceMetadata.setTruststore(this.truststore);
}
