{
  if (!config.isCors())   return false;
  log.debugv("CORS enabled + request.getRequestURI()");
  String origin=request.getHeader("Origin");
  log.debugv("Origin: {0} uri: {1}",origin,request.getRequestURI());
  if (session != null && origin != null) {
    AccessToken token=session.getToken();
    Set<String> allowedOrigins=token.getAllowedOrigins();
    if (log.isDebugEnabled()) {
      for (      String a : allowedOrigins)       log.debug("   " + a);
    }
    if (allowedOrigins == null || (!allowedOrigins.contains("*") && !allowedOrigins.contains(origin))) {
      if (allowedOrigins == null) {
        log.debugv("allowedOrigins was null in token");
      }
      if (!allowedOrigins.contains("*") && !allowedOrigins.contains(origin)) {
        log.debugv("allowedOrigins did not contain origin");
      }
      response.sendError(HttpServletResponse.SC_FORBIDDEN);
      return true;
    }
    log.debugv("returning origin: {0}",origin);
    response.setHeader("Access-Control-Allow-Origin",origin);
    response.setHeader("Access-Control-Allow-Credentials","true");
  }
 else {
    log.debugv("session or origin was null: {0}",request.getRequestURI());
  }
  return false;
}
