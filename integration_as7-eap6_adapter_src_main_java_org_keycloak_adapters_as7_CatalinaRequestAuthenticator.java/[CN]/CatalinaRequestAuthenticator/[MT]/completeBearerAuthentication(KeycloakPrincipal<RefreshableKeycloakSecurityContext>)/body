{
  RefreshableKeycloakSecurityContext securityContext=principal.getKeycloakSecurityContext();
  Set<String> roles=getRolesFromToken(securityContext);
  if (log.isDebugEnabled()) {
    log.debug("Completing bearer authentication. Bearer roles: " + roles);
  }
  Principal generalPrincipal=new CatalinaSecurityContextHelper().createPrincipal(request.getContext().getRealm(),principal,roles,securityContext);
  request.setUserPrincipal(generalPrincipal);
  request.setAuthType("KEYCLOAK");
  request.setAttribute(KeycloakSecurityContext.class.getName(),securityContext);
}
