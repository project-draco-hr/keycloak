{
  SkeletonKeyToken token=new SkeletonKeyToken();
  token.id(generateId());
  token.principal(gp.getName());
  token.audience(skeletonKeyConfig.getRealm());
  int expiration=skeletonKeyConfig.getAccessCodeLifetime() == 0 ? 3600 : skeletonKeyConfig.getAccessCodeLifetime();
  if (skeletonKeyConfig.getTokenLifetime() > 0) {
    token.expiration((System.currentTimeMillis() / 1000) + expiration);
  }
  SkeletonKeyToken.Access realmAccess=new SkeletonKeyToken.Access();
  for (  String role : gp.getRoles()) {
    realmAccess.addRole(role);
  }
  token.setRealmAccess(realmAccess);
  return token;
}
