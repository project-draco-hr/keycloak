{
  try {
    String contextPath=request.getContextPath();
    String requestURI=request.getDecodedRequestURI();
    log.debug("--- invoke: " + requestURI);
    if (request.getMethod().equalsIgnoreCase("GET") && context.getLoginConfig().getLoginPage().equals(request.getRequestPathMB().toString())) {
      if (handleLoginPage(request,response))       return;
    }
 else     if (request.getMethod().equalsIgnoreCase("GET") && requestURI.endsWith(Actions.J_OAUTH_LOGOUT)) {
      logoutCurrentUser(request,response);
      return;
    }
 else     if (request.getMethod().equalsIgnoreCase("POST") && requestURI.endsWith(Actions.J_OAUTH_ADMIN_FORCED_LOGOUT)) {
      adminLogout(request,response);
      return;
    }
 else     if (request.getMethod().equalsIgnoreCase("POST") && requestURI.startsWith(contextPath) && requestURI.endsWith(Constants.FORM_ACTION)&& request.getParameter("client_id") != null) {
      handleOAuth(request,response);
      return;
    }
 else     if (request.getMethod().equalsIgnoreCase("POST") && requestURI.endsWith(Actions.J_OAUTH_TOKEN_GRANT)) {
      tokenGrant(request,response);
      return;
    }
 else     if (request.getMethod().equalsIgnoreCase("POST") && requestURI.startsWith(contextPath) && requestURI.endsWith(Actions.J_OAUTH_RESOLVE_ACCESS_CODE)) {
      resolveAccessCode(request,response);
      return;
    }
 else     if (request.getMethod().equalsIgnoreCase("GET") && requestURI.startsWith(contextPath) && requestURI.endsWith("j_oauth_realm_info.html")) {
      publishRealmInfoHtml(request,response);
      return;
    }
    if (!skeletonKeyConfig.isCancelPropagation()) {
      if (request.getAttribute(SkeletonKeySession.class.getName()) == null && request.getSessionInternal() != null) {
        SkeletonKeySession skSession=(SkeletonKeySession)request.getSessionInternal().getNote(SkeletonKeySession.class.getName());
        if (skSession != null) {
          request.setAttribute(SkeletonKeySession.class.getName(),skSession);
          ResteasyProviderFactory.pushContext(SkeletonKeySession.class,skSession);
        }
      }
    }
    request.setAttribute("OAUTH_FORM_ACTION","j_security_check");
    super.invoke(request,response);
  }
  finally {
    ResteasyProviderFactory.clearContextData();
  }
}
