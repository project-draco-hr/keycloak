{
  SkeletonKeyToken token=buildToken(gp);
  AccessCode code=new AccessCode();
  code.setToken(token);
  code.setClient(client_id);
  code.setSso(sso);
  code.setRedirect(redirect_uri);
  int expiration=skeletonKeyConfig.getAccessCodeLifetime() == 0 ? 300 : skeletonKeyConfig.getAccessCodeLifetime();
  code.setExpiration((System.currentTimeMillis() / 1000) + expiration);
  accessCodeMap.put(code.getId(),code);
  log.debug("--- sign access code");
  String accessCode=null;
  try {
    accessCode=new JWSBuilder().content(code.getId().getBytes("UTF-8")).rsa256(realmPrivateKey);
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
  log.debug("--- build redirect");
  UriBuilder redirectUri=UriBuilder.fromUri(redirect_uri).queryParam("code",accessCode);
  if (state != null)   redirectUri.queryParam("state",state);
  response.sendRedirect(redirectUri.toTemplate());
  log.debug("<--- end oauthAuthenticate");
}
