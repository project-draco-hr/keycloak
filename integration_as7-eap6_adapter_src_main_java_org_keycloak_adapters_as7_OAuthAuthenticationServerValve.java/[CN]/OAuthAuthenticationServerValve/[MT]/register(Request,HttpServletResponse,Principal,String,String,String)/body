{
  super.register(request,response,principal,authType,username,password);
  log.debug("authenticate userSessionManage.login(): " + principal.getName());
  userSessionManagement.login(request.getSessionInternal(),principal.getName());
  if (!skeletonKeyConfig.isCancelPropagation()) {
    GenericPrincipal gp=(GenericPrincipal)request.getPrincipal();
    if (gp != null) {
      SkeletonKeyToken token=buildToken(gp);
      String stringToken=buildTokenString(realmPrivateKey,token);
      SkeletonKeySession skSession=new SkeletonKeySession(stringToken,resourceMetadata);
      request.setAttribute(SkeletonKeySession.class.getName(),skSession);
      ResteasyProviderFactory.pushContext(SkeletonKeySession.class,skSession);
      request.getSessionInternal(true).setNote(SkeletonKeySession.class.getName(),skSession);
    }
  }
}
