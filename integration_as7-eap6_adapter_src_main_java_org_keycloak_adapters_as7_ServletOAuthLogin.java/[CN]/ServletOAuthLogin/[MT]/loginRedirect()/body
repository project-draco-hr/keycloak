{
  String state=getStateCode();
  String redirect=getRedirectUri(state);
  if (redirect == null) {
    sendError(HttpServletResponse.SC_FORBIDDEN);
    return;
  }
  setCookie(deployment.getStateCookieName(),state,null,getDefaultCookiePath(),deployment.isSslRequired());
  sendRedirect(redirect);
}
