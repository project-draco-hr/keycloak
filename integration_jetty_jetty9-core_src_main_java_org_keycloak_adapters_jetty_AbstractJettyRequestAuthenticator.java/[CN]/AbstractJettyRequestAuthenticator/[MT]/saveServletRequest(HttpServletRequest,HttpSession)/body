{
synchronized (session) {
    if (session.getAttribute(FormAuthenticator.__J_URI) == null) {
      StringBuffer buf=request.getRequestURL();
      if (request.getQueryString() != null)       buf.append("?").append(request.getQueryString());
      session.setAttribute(FormAuthenticator.__J_URI,buf.toString());
      session.setAttribute(FormAuthenticator.__J_METHOD,request.getMethod());
      if (MimeTypes.Type.FORM_ENCODED.is(request.getContentType()) && HttpMethod.POST.is(request.getMethod())) {
        Request base_request=(request instanceof Request) ? (Request)request : HttpChannel.getCurrentHttpChannel().getRequest();
        MultiMap<String> formParameters=extractFormParameters(base_request);
        session.setAttribute(FormAuthenticator.__J_POST,formParameters);
      }
    }
  }
}
