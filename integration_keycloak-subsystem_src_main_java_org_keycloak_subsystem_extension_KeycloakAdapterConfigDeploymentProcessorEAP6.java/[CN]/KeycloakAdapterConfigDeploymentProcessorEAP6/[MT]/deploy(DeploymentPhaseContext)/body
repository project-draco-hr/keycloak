{
  DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  String deploymentName=deploymentUnit.getName();
  KeycloakAdapterConfigService service=KeycloakAdapterConfigService.getInstance();
  if (service.isSecureDeployment(deploymentName)) {
    addKeycloakAuthData(phaseContext,deploymentName,service);
    return;
  }
  WarMetaData warMetaData=deploymentUnit.getAttachment(WarMetaData.ATTACHMENT_KEY);
  if (warMetaData == null)   return;
  JBossWebMetaData webMetaData=warMetaData.getMergedJBossWebMetaData();
  if (webMetaData == null)   return;
  LoginConfigMetaData loginConfig=webMetaData.getLoginConfig();
  if (loginConfig != null && "KEYCLOAK".equalsIgnoreCase(loginConfig.getAuthMethod())) {
    addValve(webMetaData);
  }
}
