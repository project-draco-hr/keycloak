{
  String state=getStateCode();
  KeycloakUriBuilder uriBuilder=KeycloakUriBuilder.fromUri(authUrl).queryParam("client_id",clientId).queryParam("redirect_uri",redirectUri).queryParam("state",state);
  if (scope != null) {
    uriBuilder.queryParam("scope",scope);
  }
  URI url=uriBuilder.build();
  String stateCookiePath=this.stateCookiePath;
  if (stateCookiePath == null)   stateCookiePath=request.getContextPath();
  if (stateCookiePath.equals(""))   stateCookiePath="/";
  Cookie cookie=new Cookie(stateCookieName,state);
  cookie.setSecure(isSecure);
  cookie.setPath(stateCookiePath);
  response.addCookie(cookie);
  response.sendRedirect(url.toString());
}
