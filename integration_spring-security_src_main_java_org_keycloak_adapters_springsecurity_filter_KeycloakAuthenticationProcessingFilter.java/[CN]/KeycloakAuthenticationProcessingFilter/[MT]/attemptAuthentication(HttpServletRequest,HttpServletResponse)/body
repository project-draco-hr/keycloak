{
  log.debug("Attempting Keycloak authentication");
  KeycloakDeployment deployment=adapterDeploymentContextBean.getDeployment();
  SimpleHttpFacade facade=new SimpleHttpFacade(request,response);
  AdapterTokenStore tokenStore=adapterTokenStoreFactory.createAdapterTokenStore(deployment,request);
  RequestAuthenticator authenticator=new SpringSecurityRequestAuthenticator(facade,request,deployment,tokenStore,-1);
  AuthOutcome result=authenticator.authenticate();
  AuthChallenge challenge=authenticator.getChallenge();
  log.debug("Auth outcome: {}",result);
  if (challenge != null) {
    challenge.challenge(facade);
  }
  if (AuthOutcome.AUTHENTICATED.equals(result)) {
    Authentication authentication=SecurityContextHolder.getContext().getAuthentication();
    Assert.notNull(authentication,"Authentication SecurityContextHolder was null");
    return authenticationManager.authenticate(authentication);
  }
  return null;
}
