{
  RefreshableKeycloakSecurityContext securityContext=skp.getKeycloakSecurityContext();
  request.setAttribute(KeycloakSecurityContext.class.getName(),securityContext);
  Set<String> roles=getRolesFromToken(securityContext);
  GenericPrincipal principal=new CatalinaSecurityContextHelper().createPrincipal(request.getContext().getRealm(),skp,roles,securityContext);
  Session session=request.getSessionInternal(true);
  session.setPrincipal(principal);
  session.setAuthType("OAUTH");
  session.setNote(KeycloakSecurityContext.class.getName(),securityContext);
  String username=securityContext.getToken().getSubject();
  log.finer("userSessionManage.login: " + username);
  userSessionManagement.login(session,username,securityContext.getToken().getSessionState());
}
