{
  CatalinaHttpFacade facade=new CatalinaHttpFacade(request,response);
  KeycloakDeployment deployment=deploymentContext.resolveDeployment(facade);
  if (deployment == null || !deployment.isConfigured()) {
    return false;
  }
  AdapterTokenStore tokenStore=getTokenStore(request,facade,deployment);
  nodesRegistrationManagement.tryRegister(deployment);
  CatalinaRequestAuthenticator authenticator=new CatalinaRequestAuthenticator(deployment,tokenStore,facade,request,createPrincipalFactory());
  AuthOutcome outcome=authenticator.authenticate();
  if (outcome == AuthOutcome.AUTHENTICATED) {
    if (facade.isEnded()) {
      return false;
    }
    return true;
  }
  AuthChallenge challenge=authenticator.getChallenge();
  if (challenge != null) {
    challenge.challenge(facade);
  }
  return false;
}
