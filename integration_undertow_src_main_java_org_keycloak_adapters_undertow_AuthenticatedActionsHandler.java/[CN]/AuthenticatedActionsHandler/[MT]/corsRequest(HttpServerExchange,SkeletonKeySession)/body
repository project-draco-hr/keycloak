{
  if (!config.isCors())   return false;
  log.debugv("CORS enabled + request.getRequestURI()");
  String origin=exchange.getRequestHeaders().getFirst("Origin");
  log.debugv("Origin: {0} uri: {1}",origin,exchange.getRequestURI());
  if (session != null && origin != null) {
    SkeletonKeyToken token=session.getToken();
    Set<String> allowedOrigins=token.getAllowedOrigins();
    if (log.isDebugEnabled()) {
      for (      String a : allowedOrigins)       log.debug("   " + a);
    }
    if (allowedOrigins == null || (!allowedOrigins.contains("*") && !allowedOrigins.contains(origin))) {
      if (allowedOrigins == null) {
        log.debugv("allowedOrigins was null in token");
      }
      if (!allowedOrigins.contains("*") && !allowedOrigins.contains(origin)) {
        log.debugv("allowedOrigins did not contain origin");
      }
      exchange.setResponseCode(403);
      exchange.endExchange();
      return true;
    }
    log.debugv("returning origin: {0}",origin);
    exchange.setResponseCode(200);
    exchange.getResponseHeaders().put(PreflightCorsHandler.ACCESS_CONTROL_ALLOW_ORIGIN,origin);
    exchange.getResponseHeaders().put(PreflightCorsHandler.ACCESS_CONTROL_ALLOW_CREDENTIALS,"true");
  }
 else {
    log.debugv("session or origin was null: {0}",exchange.getRequestURI());
  }
  return false;
}
