{
  log.info("K_GET_SESSION_STATS sent");
  JWSInput token=verifyAdminRequest(request,response);
  if (token == null)   return;
  SessionStatsAction action=JsonSerialization.readValue(token.getContent(),SessionStatsAction.class);
  if (!validateAction(response,action))   return;
  SessionStats stats=new SessionStats();
  stats.setActiveSessions(userSessionManagement.getActiveSessions());
  stats.setActiveUsers(userSessionManagement.getActiveUsers().size());
  if (action.isListUsers() && userSessionManagement.getActiveSessions() > 0) {
    Map<String,UserStats> list=new HashMap<String,UserStats>();
    for (    String user : userSessionManagement.getActiveUsers()) {
      list.put(user,getUserStats(user));
    }
    stats.setUsers(list);
  }
  response.setStatus(200);
  response.setContentType("application/json");
  JsonSerialization.writeValueToStream(response.getOutputStream(),stats);
  return;
}
