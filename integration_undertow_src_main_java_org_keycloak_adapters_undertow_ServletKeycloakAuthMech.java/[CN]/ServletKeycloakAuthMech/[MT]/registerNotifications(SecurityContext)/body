{
  final NotificationReceiver logoutReceiver=new NotificationReceiver(){
    @Override public void handleNotification(    SecurityNotification notification){
      if (notification.getEventType() != SecurityNotification.EventType.LOGGED_OUT)       return;
      final ServletRequestContext servletRequestContext=notification.getExchange().getAttachment(ServletRequestContext.ATTACHMENT_KEY);
      HttpServletRequest req=(HttpServletRequest)servletRequestContext.getServletRequest();
      req.removeAttribute(KeycloakUndertowAccount.class.getName());
      req.removeAttribute(KeycloakSecurityContext.class.getName());
      HttpSession session=req.getSession(false);
      if (session == null)       return;
      KeycloakUndertowAccount account=(KeycloakUndertowAccount)session.getAttribute(KeycloakUndertowAccount.class.getName());
      if (account == null)       return;
      session.removeAttribute(KeycloakSecurityContext.class.getName());
      session.removeAttribute(KeycloakUndertowAccount.class.getName());
      String sessionId=account.getKeycloakSecurityContext().getToken().getSessionState();
      try {
        ServerRequest.invokeLogout(deploymentContext.getDeployment(),sessionId);
      }
 catch (      Exception e) {
        log.error("failed to invoke remote logout",e);
      }
    }
  }
;
  securityContext.registerNotificationReceiver(logoutReceiver);
}
