{
  final NotificationReceiver logoutReceiver=new NotificationReceiver(){
    @Override public void handleNotification(    SecurityNotification notification){
      if (notification.getEventType() != SecurityNotification.EventType.LOGGED_OUT)       return;
      Session session=Sessions.getSession(notification.getExchange());
      if (session == null)       return;
      KeycloakUndertowAccount account=(KeycloakUndertowAccount)session.getAttribute(KeycloakUndertowAccount.class.getName());
      if (account == null)       return;
      session.removeAttribute(KeycloakUndertowAccount.class.getName());
      String sessionId=account.getKeycloakSecurityContext().getToken().getSessionState();
      try {
        ServerRequest.invokeLogout(deploymentContext.getDeployment(),sessionId);
      }
 catch (      Exception e) {
        log.error("failed to invoke remote logout",e);
      }
    }
  }
;
  securityContext.registerNotificationReceiver(logoutReceiver);
}
