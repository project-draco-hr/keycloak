{
  UserModel user=session.userStorage().getUserByEmail(email,realm);
  if (user != null) {
    FederationProvider link=getFederationLink(realm,user);
    if (link != null) {
      return link.proxy(user);
    }
    return user;
  }
  for (  FederationProviderModel federation : realm.getFederationProviders()) {
    FederationProvider fed=session.getProvider(FederationProvider.class,federation.getProviderName());
    user=fed.getUserByEmail(email,realm);
    if (user != null)     return user;
  }
  return user;
}
