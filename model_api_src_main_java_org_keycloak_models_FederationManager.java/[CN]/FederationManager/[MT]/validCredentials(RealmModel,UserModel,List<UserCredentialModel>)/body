{
  FederationProvider link=getFederationLink(realm,user);
  if (link != null) {
    if (link.getSupportedCredentialTypes().size() > 0) {
      List<UserCredentialModel> fedCreds=new ArrayList<UserCredentialModel>();
      List<UserCredentialModel> localCreds=new ArrayList<UserCredentialModel>();
      for (      UserCredentialModel cred : input) {
        if (fedCreds.contains(cred.getType())) {
          fedCreds.add(cred);
        }
 else {
          localCreds.add(cred);
        }
      }
      if (!link.validCredentials(realm,user,fedCreds)) {
        return false;
      }
      return session.userStorage().validCredentials(realm,user,localCreds);
    }
  }
  return session.userStorage().validCredentials(realm,user,input);
}
