{
  if (credential.getType().equals(UserCredentialModel.PASSWORD)) {
    if (realm.getPasswordPolicy() != null) {
      String error=realm.getPasswordPolicy().validate(user.getUsername(),credential.getValue());
      if (error != null)       throw new ModelException(error);
    }
  }
  user.updateCredential(credential);
}
