{
  if (realm == null)   throw new NullPointerException("realm == null");
  if (username == null)   throw new NullPointerException("username == null");
  if (userId == null)   userId=KeycloakModelUtils.generateId();
  UserEntity userEntity=new UserEntity();
  userEntity.setId(userId);
  userEntity.setUsername(username);
  userEntity.setRealmId(realm.getId());
  UserAdapter user=new UserAdapter(realm,userEntity,inMemoryModel);
  inMemoryModel.putUser(realm.getId(),userId,user);
  return user;
}
