{
  Collection<UserModel> users=inMemoryModel.getUsers(realm.getId());
  for (  Map.Entry<String,String> entry : attributes.entrySet()) {
    List<UserModel> matchedUsers=new ArrayList<>();
    for (    UserModel user : users) {
      List<String> vals=user.getAttribute(entry.getKey());
      if (vals.contains(entry.getValue())) {
        matchedUsers.add(user);
      }
    }
    users=matchedUsers;
  }
  return (List<UserModel>)users;
}
