{
synchronized (allModels) {
    InMemoryModel model=allModels.get(session);
    if (model == null) {
      model=new InMemoryModel(session);
      allModels.put(session,model);
      session.getTransaction().enlist(model);
      model.readModelFile();
      logger.info("Added session " + session.hashCode() + " total sessions="+ allModels.size());
    }
    return model;
  }
}
