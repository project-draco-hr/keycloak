{
  FileOutputStream outStream=null;
  File keycloakModelFile=new File(directory,fileName);
  try {
    outStream=new FileOutputStream(keycloakModelFile);
    exportModel(outStream);
  }
 catch (  IOException e) {
    logger.error("Unable to write model file " + keycloakModelFile.getAbsolutePath(),e);
  }
 finally {
    logger.info("Wrote model file for session=" + session.hashCode());
    try {
      if (outStream != null)       outStream.close();
    }
 catch (    IOException e) {
      logger.error("Failed to close output stream.",e);
    }
  }
}
