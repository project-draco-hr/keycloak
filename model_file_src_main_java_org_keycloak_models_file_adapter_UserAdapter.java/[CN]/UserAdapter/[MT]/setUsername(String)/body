{
  if (getUsername() == null) {
    user.setUsername(username);
    return;
  }
  if (getUsername().equals(username))   return;
  if (inMemoryModel.hasUserWithUsername(realm.getId(),username))   throw new ModelDuplicateException("User with username " + username + " already exists in realm.");
  user.setUsername(username);
}
