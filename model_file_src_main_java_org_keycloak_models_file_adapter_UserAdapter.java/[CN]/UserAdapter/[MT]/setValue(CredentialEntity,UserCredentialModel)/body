{
  byte[] salt=getSalt();
  int hashIterations=1;
  PasswordPolicy policy=realm.getPasswordPolicy();
  if (policy != null) {
    hashIterations=policy.getHashIterations();
    if (hashIterations == -1)     hashIterations=1;
  }
  credentialEntity.setCreatedDate(Time.toMillis(Time.currentTime()));
  credentialEntity.setValue(new Pbkdf2PasswordEncoder(salt).encode(cred.getValue(),hashIterations));
  credentialEntity.setSalt(salt);
  credentialEntity.setHashIterations(hashIterations);
}
