{
  logger.tracev("getConsentByClient: {0}",user.getUsername());
  String cacheKey=getConsentCacheKey(user.getId());
  if (realmInvalidations.contains(realm.getId()) || invalidations.contains(user.getId()) || invalidations.contains(cacheKey)) {
    return getDelegate().getConsentByClient(realm,user,clientId);
  }
  CachedUserConsents cached=cache.get(cacheKey,CachedUserConsents.class);
  if (cached == null) {
    Long loaded=cache.getCurrentRevision(cacheKey);
    List<UserConsentModel> consents=getDelegate().getConsents(realm,user);
    cached=new CachedUserConsents(loaded,cacheKey,realm,consents);
    cache.addRevisioned(cached,startupRevision);
  }
  CachedUserConsent cachedConsent=cached.getConsents().get(clientId);
  if (cachedConsent == null)   return null;
  return toConsentModel(realm,cachedConsent);
}
