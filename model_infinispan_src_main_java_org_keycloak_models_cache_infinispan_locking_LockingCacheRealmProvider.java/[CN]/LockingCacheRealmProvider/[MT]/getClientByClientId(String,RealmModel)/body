{
  CachedClient cached=cache.getClientByClientId(realm,clientId);
  if (cached != null && !cached.getRealm().equals(realm.getId())) {
    cached=null;
  }
  if (cached != null) {
    logger.tracev("client by name cache hit: {0}",cached.getClientId());
  }
  if (cached == null) {
    Long loaded=UpdateCounter.current();
    if (loaded == null)     loaded=UpdateCounter.current();
    ClientModel model=getDelegate().getClientByClientId(clientId,realm);
    if (model == null)     return null;
    if (appInvalidations.contains(model.getId()))     return model;
    cached=new RevisionedCachedClient(loaded,cache,getDelegate(),realm,model);
    logger.tracev("adding client by name cache miss: {0}",cached.getClientId());
    cache.addClient(cached);
  }
 else   if (appInvalidations.contains(cached.getId())) {
    return getDelegate().getClientById(cached.getId(),realm);
  }
 else   if (managedApplications.containsKey(cached.getId())) {
    return managedApplications.get(cached.getId());
  }
  ClientAdapter adapter=new ClientAdapter(realm,cached,this,cache);
  managedApplications.put(cached.getId(),adapter);
  return adapter;
}
