{
  CachedRole cached=cache.getRole(id);
  if (cached != null && !cached.getRealm().equals(realm.getId())) {
    cached=null;
  }
  if (cached == null) {
    Long loaded=cache.getCurrentRevision(id);
    if (loaded == null)     loaded=UpdateCounter.current();
    RoleModel model=getDelegate().getRoleById(id,realm);
    if (model == null)     return null;
    if (roleInvalidations.contains(id))     return model;
    if (model.getContainer() instanceof ClientModel) {
      cached=new RevisionedCachedClientRole(loaded,((ClientModel)model.getContainer()).getId(),model,realm);
    }
 else {
      cached=new RevisionedCachedRealmRole(loaded,model,realm);
    }
    cache.addRole(cached);
  }
 else   if (roleInvalidations.contains(id)) {
    return getDelegate().getRoleById(id,realm);
  }
 else   if (managedRoles.containsKey(id)) {
    return managedRoles.get(id);
  }
  RoleAdapter adapter=new RoleAdapter(cached,cache,this,realm);
  managedRoles.put(id,adapter);
  return adapter;
}
