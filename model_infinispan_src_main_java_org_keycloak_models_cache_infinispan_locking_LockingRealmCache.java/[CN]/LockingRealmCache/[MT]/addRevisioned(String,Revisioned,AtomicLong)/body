{
  try {
    Long rev=revisions.get(id);
    if (rev == null) {
      rev=counter.incrementAndGet();
      revisions.put(id,rev);
      return;
    }
    revisions.startBatch();
    revisions.getAdvancedCache().lock(id);
    rev=revisions.get(id);
    if (rev == null) {
      rev=counter.incrementAndGet();
      revisions.put(id,rev);
      return;
    }
    if (rev.equals(object.getRevision())) {
      cache.putForExternalRead(id,object);
    }
  }
  finally {
    endRevisionBatch();
  }
}
