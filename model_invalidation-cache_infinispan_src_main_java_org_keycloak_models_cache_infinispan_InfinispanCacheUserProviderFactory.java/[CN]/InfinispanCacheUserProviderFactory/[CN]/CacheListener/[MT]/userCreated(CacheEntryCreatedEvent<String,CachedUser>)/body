{
  if (!event.isPre()) {
    CachedUser cachedUser;
    if (isNewInfinispan) {
      cachedUser=event.getValue();
    }
 else {
      String userId=event.getKey();
      cachedUser=event.getCache().get(userId);
    }
    if (cachedUser != null) {
      String realm=cachedUser.getRealm();
      usernameLookup.put(realm,cachedUser.getUsername(),cachedUser.getId());
      if (cachedUser.getEmail() != null) {
        emailLookup.put(realm,cachedUser.getEmail(),cachedUser.getId());
      }
    }
  }
}
