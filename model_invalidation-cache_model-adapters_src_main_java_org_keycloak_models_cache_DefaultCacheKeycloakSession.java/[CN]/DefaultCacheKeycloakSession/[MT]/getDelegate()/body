{
  if (!transactionActive)   throw new IllegalStateException("Cannot access delegate without a transaction");
  if (sessionDelegate != null)   return sessionDelegate;
  sessionDelegate=providerSession.getProvider(KeycloakSession.class);
  transactionDelegate=sessionDelegate.getTransaction();
  if (!transactionDelegate.isActive()) {
    transactionDelegate.begin();
    if (setRollbackOnly) {
      transactionDelegate.setRollbackOnly();
    }
  }
  return sessionDelegate;
}
