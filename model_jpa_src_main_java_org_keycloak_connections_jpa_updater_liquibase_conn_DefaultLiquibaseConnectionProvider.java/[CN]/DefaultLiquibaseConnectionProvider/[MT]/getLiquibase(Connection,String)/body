{
  Database database=DatabaseFactory.getInstance().findCorrectDatabaseImplementation(new JdbcConnection(connection));
  if (defaultSchema != null) {
    database.setDefaultSchemaName(defaultSchema);
  }
  String changelog=(database instanceof DB2Database) ? LiquibaseJpaUpdaterProvider.DB2_CHANGELOG : LiquibaseJpaUpdaterProvider.CHANGELOG;
  logger.debugf("Using changelog file: %s",changelog);
  LockServiceFactory.getInstance().register(new DummyLockService());
  return new Liquibase(changelog,new ClassLoaderResourceAccessor(getClass().getClassLoader()),database);
}
