{
  while (maxAttempts > 0) {
    try {
      lockService.waitForLock();
      factory.setHasLock(true);
      this.maxAttempts=DEFAULT_MAX_ATTEMPTS;
      return;
    }
 catch (    LockRetryException le) {
      safeRollbackConnection();
      restart();
      maxAttempts--;
    }
catch (    RuntimeException re) {
      safeRollbackConnection();
      safeCloseConnection();
      throw re;
    }
  }
}
