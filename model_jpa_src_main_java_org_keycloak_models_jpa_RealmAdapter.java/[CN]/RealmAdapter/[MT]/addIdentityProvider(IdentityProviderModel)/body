{
  IdentityProviderEntity entity=new IdentityProviderEntity();
  entity.setInternalId(KeycloakModelUtils.generateId());
  entity.setAlias(identityProvider.getAlias());
  entity.setDisplayName(identityProvider.getDisplayName());
  entity.setProviderId(identityProvider.getProviderId());
  entity.setEnabled(identityProvider.isEnabled());
  entity.setStoreToken(identityProvider.isStoreToken());
  entity.setAddReadTokenRoleOnCreate(identityProvider.isAddReadTokenRoleOnCreate());
  entity.setTrustEmail(identityProvider.isTrustEmail());
  entity.setAuthenticateByDefault(identityProvider.isAuthenticateByDefault());
  entity.setFirstBrokerLoginFlowId(identityProvider.getFirstBrokerLoginFlowId());
  entity.setPostBrokerLoginFlowId(identityProvider.getPostBrokerLoginFlowId());
  entity.setConfig(identityProvider.getConfig());
  realm.addIdentityProvider(entity);
  identityProvider.setInternalId(entity.getInternalId());
  em.persist(entity);
  em.flush();
}
