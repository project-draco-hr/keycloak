{
  String id=model.getId() == null ? KeycloakModelUtils.generateId() : model.getId();
  ProtocolMapperEntity entity=new ProtocolMapperEntity();
  entity.setId(id);
  entity.setName(model.getName());
  entity.setProtocol(model.getProtocol());
  entity.setProtocolMapper(model.getProtocolMapper());
  entity.setAppliedByDefault(model.isAppliedByDefault());
  entity.setRealm(realm);
  entity.setConfig(model.getConfig());
  entity.setConsentRequired(model.isConsentRequired());
  entity.setConsentText(model.getConsentText());
  em.persist(entity);
  ProtocolMapperModel mapping=new ProtocolMapperModel();
  mapping.setId(entity.getId());
  mapping.setName(model.getName());
  mapping.setProtocol(entity.getProtocol());
  mapping.setProtocolMapper(entity.getProtocolMapper());
  mapping.setAppliedByDefault(entity.isAppliedByDefault());
  mapping.setConfig(model.getConfig());
  mapping.setConsentRequired(entity.isConsentRequired());
  mapping.setConsentText(entity.getConsentText());
  return mapping;
}
