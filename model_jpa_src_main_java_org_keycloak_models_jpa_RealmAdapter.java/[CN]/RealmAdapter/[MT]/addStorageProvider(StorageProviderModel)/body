{
  KeycloakModelUtils.ensureUniqueDisplayName(model.getDisplayName(),null,getStorageProviders());
  String id=KeycloakModelUtils.generateId();
  StorageProviderEntity entity=new StorageProviderEntity();
  entity.setId(id);
  entity.setRealm(realm);
  entity.setProviderName(model.getProviderName());
  entity.setConfig(model.getConfig());
  entity.setPriority(model.getPriority());
  String displayName=model.getDisplayName();
  if (model.getDisplayName() == null) {
    displayName=id;
  }
  entity.setDisplayName(displayName);
  em.persist(entity);
  realm.getStorageProviders().add(entity);
  em.flush();
  StorageProviderModel providerModel=toModel(entity);
  return providerModel;
}
