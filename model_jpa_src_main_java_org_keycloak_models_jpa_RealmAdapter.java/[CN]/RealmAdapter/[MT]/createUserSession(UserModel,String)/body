{
  UserSessionEntity entity=new UserSessionEntity();
  entity.setUser(((UserAdapter)user).getUser());
  entity.setIpAddress(ipAddress);
  int currentTime=Time.currentTime();
  int expires=currentTime + realm.getSsoSessionIdleTimeout();
  entity.setStarted(currentTime);
  entity.setExpires(expires);
  em.persist(entity);
  return new UserSessionAdapter(entity);
}
