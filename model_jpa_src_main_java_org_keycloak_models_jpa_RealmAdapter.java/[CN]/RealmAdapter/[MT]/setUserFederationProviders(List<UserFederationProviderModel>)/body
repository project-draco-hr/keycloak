{
  Iterator<UserFederationProviderEntity> it=realm.getUserFederationProviders().iterator();
  while (it.hasNext()) {
    UserFederationProviderEntity entity=it.next();
    boolean found=false;
    for (    UserFederationProviderModel model : providers) {
      if (entity.getId().equals(model.getId())) {
        entity.setConfig(model.getConfig());
        entity.setPriority(model.getPriority());
        entity.setProviderName(model.getProviderName());
        entity.setPriority(model.getPriority());
        String displayName=model.getDisplayName();
        if (displayName != null) {
          entity.setDisplayName(model.getDisplayName());
        }
        found=true;
        break;
      }
    }
    if (found)     continue;
    it.remove();
    em.remove(entity);
  }
  List<UserFederationProviderModel> add=new LinkedList<UserFederationProviderModel>();
  for (  UserFederationProviderModel model : providers) {
    boolean found=false;
    for (    UserFederationProviderEntity entity : realm.getUserFederationProviders()) {
      if (entity.getId().equals(model.getId())) {
        found=true;
        break;
      }
    }
    if (!found)     add.add(model);
  }
  for (  UserFederationProviderModel model : add) {
    UserFederationProviderEntity entity=new UserFederationProviderEntity();
    if (model.getId() != null)     entity.setId(model.getId());
 else     entity.setId(KeycloakModelUtils.generateId());
    entity.setConfig(model.getConfig());
    entity.setPriority(model.getPriority());
    entity.setProviderName(model.getProviderName());
    entity.setPriority(model.getPriority());
    String displayName=model.getDisplayName();
    if (displayName == null) {
      entity.setDisplayName(entity.getId());
    }
    em.persist(entity);
    realm.getUserFederationProviders().add(entity);
  }
}
