{
  UserEntity userEntity=((UserAdapter)user).getUser();
  CredentialEntity credentialEntity=getCredentialEntity(userEntity,credModel.getType());
  if (credentialEntity == null) {
    credentialEntity=new CredentialEntity();
    credentialEntity.setType(credModel.getType());
    credentialEntity.setUser(userEntity);
    em.persist(credentialEntity);
    userEntity.getCredentials().add(credentialEntity);
  }
  credentialEntity.setValue(credModel.getValue());
  credentialEntity.setSalt(credModel.getSalt());
  credentialEntity.setDevice(credModel.getDevice());
  em.flush();
}
