{
  if (!validatePassword(user,password))   return false;
  for (  CredentialEntity cred : ((UserAdapter)user).getUser().getCredentials()) {
    if (cred.getType().equals(UserCredentialModel.TOTP)) {
      return new TimeBasedOTP().validate(token,cred.getValue().getBytes());
    }
  }
  return false;
}
