{
  if (user.hasRole(role))   return;
  createIndex(realm,user);
  FederatedUserRoleMappingEntity entity=new FederatedUserRoleMappingEntity();
  entity.setUserId(user.getId());
  entity.setStorageProviderId(StorageId.resolveProviderId(user));
  entity.setRealmId(realm.getId());
  entity.setRoleId(role.getId());
  em.persist(entity);
}
