{
  MongoUserEntity user=getUserById(clientSession.getUserId(),realm).getUser();
  OfflineUserSessionEntity userSessionEntity=getUserSessionEntityById(user,clientSession.getUserSessionId());
  if (userSessionEntity == null) {
    throw new ModelException("OfflineUserSession with ID " + clientSession.getUserSessionId() + " doesn't exist for user "+ user.getUsername());
  }
  OfflineClientSessionEntity clEntity=new OfflineClientSessionEntity();
  clEntity.setClientSessionId(clientSession.getClientSessionId());
  clEntity.setClientId(clientSession.getClientId());
  clEntity.setData(clientSession.getData());
  userSessionEntity.getOfflineClientSessions().add(clEntity);
  getMongoStore().updateEntity(user,invocationContext);
}
