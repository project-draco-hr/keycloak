{
  byte[] salt=getSalt();
  int hashIterations=1;
  PasswordHashProvider provider=session.getProvider(PasswordHashProvider.class);
  PasswordPolicy policy=realm.getPasswordPolicy();
  if (policy != null) {
    hashIterations=policy.getHashIterations();
    if (hashIterations == -1)     hashIterations=1;
  }
  credentialEntity.setCreatedDate(Time.toMillis(Time.currentTime()));
  credentialEntity.setValue(provider.encode(cred.getValue(),salt,hashIterations));
  credentialEntity.setSalt(salt);
  credentialEntity.setHashIterations(hashIterations);
}
