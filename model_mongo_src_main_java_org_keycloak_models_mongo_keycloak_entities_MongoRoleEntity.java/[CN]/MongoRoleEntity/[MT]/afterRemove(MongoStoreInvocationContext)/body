{
  MongoStore mongoStore=invContext.getMongoStore();
  DBObject query=new QueryBuilder().and("roleIds").is(getId()).get();
  List<MongoUserEntity> users=mongoStore.loadEntities(MongoUserEntity.class,query,invContext);
  for (  MongoUserEntity user : users) {
    logger.info("Removing role " + getName() + " from user "+ user.getUsername());
    mongoStore.pullItemFromList(user,"roleIds",getId(),invContext);
  }
  query=new QueryBuilder().and("scopeIds").is(getId()).get();
  users=mongoStore.loadEntities(MongoUserEntity.class,query,invContext);
  for (  MongoUserEntity user : users) {
    logger.info("Removing scope " + getName() + " from user "+ user.getUsername());
    mongoStore.pullItemFromList(user,"scopeIds",getId(),invContext);
  }
  if (getRealmId() != null) {
    MongoRealmEntity realmEntity=mongoStore.loadEntity(MongoRealmEntity.class,getRealmId(),invContext);
    if (realmEntity != null) {
      mongoStore.pullItemFromList(realmEntity,"defaultRoles",getId(),invContext);
    }
  }
  if (getApplicationId() != null) {
    MongoApplicationEntity appEntity=mongoStore.loadEntity(MongoApplicationEntity.class,getApplicationId(),invContext);
    if (appEntity != null) {
      mongoStore.pullItemFromList(appEntity,"defaultRoles",getId(),invContext);
    }
  }
  query=new QueryBuilder().and("compositeRoleIds").is(getId()).get();
  List<MongoRoleEntity> parentRoles=mongoStore.loadEntities(MongoRoleEntity.class,query,invContext);
  for (  MongoRoleEntity role : parentRoles) {
    mongoStore.pullItemFromList(role,"compositeRoleIds",getId(),invContext);
  }
}
