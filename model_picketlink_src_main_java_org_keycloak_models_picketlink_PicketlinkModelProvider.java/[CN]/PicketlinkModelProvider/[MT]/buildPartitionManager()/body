{
  IdentityConfigurationBuilder builder=new IdentityConfigurationBuilder();
  builder.named("KEYCLOAK_JPA_CONFIG").stores().jpa().mappedEntity(AttributedTypeEntity.class,AccountTypeEntity.class,RoleTypeEntity.class,GroupTypeEntity.class,IdentityTypeEntity.class,RelationshipTypeEntity.class,RelationshipIdentityTypeEntity.class,PartitionTypeEntity.class,PasswordCredentialTypeEntity.class,DigestCredentialTypeEntity.class,X509CredentialTypeEntity.class,OTPCredentialTypeEntity.class,AttributeTypeEntity.class,RealmEntity.class,ApplicationEntity.class).supportGlobalRelationship(org.picketlink.idm.model.Relationship.class).addContextInitializer(new JPAContextInitializer(null){
    @Override public EntityManager getEntityManager(){
      return PicketlinkKeycloakSession.currentEntityManager.get();
    }
  }
).supportAllFeatures();
  DefaultPartitionManager partitionManager=new DefaultPartitionManager(builder.buildAll());
  return partitionManager;
}
