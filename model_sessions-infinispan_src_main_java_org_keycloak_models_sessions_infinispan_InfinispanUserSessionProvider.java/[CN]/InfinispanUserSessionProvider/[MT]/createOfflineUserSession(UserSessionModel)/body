{
  UserSessionEntity entity=new UserSessionEntity();
  entity.setId(userSession.getId());
  entity.setRealm(userSession.getRealm().getId());
  entity.setAuthMethod(userSession.getAuthMethod());
  entity.setBrokerSessionId(userSession.getBrokerSessionId());
  entity.setBrokerUserId(userSession.getBrokerUserId());
  entity.setIpAddress(userSession.getIpAddress());
  entity.setLoginUsername(userSession.getLoginUsername());
  entity.setNotes(userSession.getNotes());
  entity.setRememberMe(userSession.isRememberMe());
  entity.setState(userSession.getState());
  entity.setUser(userSession.getUser().getId());
  int currentTime=Time.currentTime();
  entity.setStarted(currentTime);
  entity.setLastSessionRefresh(currentTime);
  tx.put(offlineSessionCache,userSession.getId(),entity);
  return wrap(userSession.getRealm(),entity,true);
}
