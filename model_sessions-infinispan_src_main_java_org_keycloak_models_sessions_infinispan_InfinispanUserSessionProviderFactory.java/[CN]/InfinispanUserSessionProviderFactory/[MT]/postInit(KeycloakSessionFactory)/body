{
  KeycloakModelUtils.runJobInTransaction(factory,new KeycloakSessionTask(){
    @Override public void run(    KeycloakSession session){
      compatMode=isCompatMode(session);
      if (compatMode) {
        compatProviderFactory=new MemUserSessionProviderFactory();
      }
    }
  }
);
  int maxErrors=config.getInt("maxErrors",20);
  int sessionsPerSegment=config.getInt("sessionsPerSegment",100);
  loadPersistentSessions(factory,maxErrors,sessionsPerSegment);
}
