{
  UserSessionEntity entity=new UserSessionEntity();
  entity.setId(KeycloakModelUtils.generateId());
  entity.setRealmId(realm.getId());
  entity.setUserId(user.getId());
  entity.setLoginUsername(loginUsername);
  entity.setIpAddress(ipAddress);
  entity.setAuthMethod(authMethod);
  entity.setRememberMe(rememberMe);
  int currentTime=Time.currentTime();
  entity.setStarted(currentTime);
  entity.setLastSessionRefresh(currentTime);
  em.persist(entity);
  return new UserSessionAdapter(session,em,realm,entity);
}
