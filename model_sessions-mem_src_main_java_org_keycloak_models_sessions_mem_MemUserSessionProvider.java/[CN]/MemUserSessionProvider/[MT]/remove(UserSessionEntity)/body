{
  if (s.getBrokerSessionId() != null) {
    userSessionsByBrokerSessionId.remove(s.getBrokerSessionId());
  }
  if (s.getBrokerUserId() != null) {
    Set<String> set=userSessionsByBrokerUserId.get(s.getBrokerUserId());
    if (set != null) {
synchronized (set) {
        set.remove(s.getId());
        if (set.isEmpty())         userSessionsByBrokerUserId.remove(s.getBrokerUserId());
      }
    }
  }
  for (  ClientSessionEntity clientSession : s.getClientSessions()) {
    clientSessions.remove(clientSession.getId());
  }
}
