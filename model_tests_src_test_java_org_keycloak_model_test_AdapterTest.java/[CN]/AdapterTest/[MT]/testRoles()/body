{
  test1CreateRealm();
  realmModel.addRole("admin");
  realmModel.addRole("user");
  Set<RoleModel> roles=realmModel.getRoles();
  Assert.assertEquals(3,roles.size());
  UserModel user=realmModel.addUser("bburke");
  RoleModel realmUserRole=realmModel.getRole("user");
  realmModel.grantRole(user,realmUserRole);
  Assert.assertTrue(realmModel.hasRole(user,realmUserRole));
  RoleModel found=realmModel.getRoleById(realmUserRole.getId());
  Assert.assertNotNull(found);
  assertRolesEquals(found,realmUserRole);
  ApplicationModel application=realmModel.addApplication("app1");
  application.addRole("user");
  application.addRole("bar");
  Set<RoleModel> appRoles=application.getRoles();
  Assert.assertEquals(2,appRoles.size());
  RoleModel appBarRole=application.getRole("bar");
  Assert.assertNull(application.getRoleById(realmUserRole.getId()));
  Assert.assertNull(realmModel.getRoleById(appBarRole.getId()));
  found=application.getRoleById(appBarRole.getId());
  Assert.assertNotNull(found);
  assertRolesEquals(found,appBarRole);
  realmModel.grantRole(user,appBarRole);
  realmModel.grantRole(user,application.getRole("user"));
  roles=realmModel.getRealmRoleMappings(user);
  Assert.assertEquals(roles.size(),2);
  assertRolesContains(realmUserRole,roles);
  Assert.assertTrue(realmModel.hasRole(user,realmUserRole));
  Assert.assertTrue(realmModel.hasRole(user,realmModel.getRole("foo")));
  roles=application.getApplicationRoleMappings(user);
  Assert.assertEquals(roles.size(),2);
  assertRolesContains(application.getRole("user"),roles);
  assertRolesContains(appBarRole,roles);
  Assert.assertTrue(realmModel.hasRole(user,appBarRole));
  Assert.assertNotEquals(realmModel.getRole("user").getId(),application.getRole("user").getId());
  Assert.assertEquals(6,realmModel.getRoleMappings(user).size());
  realmModel.deleteRoleMapping(user,realmModel.getRole("foo"));
  realmModel.deleteRoleMapping(user,appBarRole);
  roles=realmModel.getRoleMappings(user);
  Assert.assertEquals(4,roles.size());
  assertRolesContains(realmUserRole,roles);
  assertRolesContains(application.getRole("user"),roles);
  Assert.assertFalse(realmModel.hasRole(user,appBarRole));
}
