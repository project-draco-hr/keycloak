{
  MultivaluedMap<String,String> formData=AuthProvidersExternalModelTest.createFormData("johnkeycloak","password");
  LdapTestUtils.setLdapPassword(providerSession,realm,"johnkeycloak","password");
  Assert.assertEquals(AuthenticationManager.AuthenticationStatus.INVALID_USER,am.authenticateForm(null,realm,formData));
  Assert.assertNull(realm.getUser("johnkeycloak"));
  setupAuthenticationProviders();
  Assert.assertEquals(AuthenticationManager.AuthenticationStatus.SUCCESS,am.authenticateForm(null,realm,formData));
  UserModel john=realm.getUser("johnkeycloak");
  Assert.assertNotNull(john);
  Assert.assertEquals("johnkeycloak",john.getLoginName());
  Assert.assertEquals("John",john.getFirstName());
  Assert.assertEquals("Doe",john.getLastName());
  Assert.assertEquals("john@email.org",john.getEmail());
  AuthenticationLinkModel authLink=realm.getAuthenticationLink(john);
  Assert.assertNotNull(authLink);
  Assert.assertEquals(authLink.getAuthProvider(),AuthProviderConstants.PROVIDER_NAME_PICKETLINK);
}
