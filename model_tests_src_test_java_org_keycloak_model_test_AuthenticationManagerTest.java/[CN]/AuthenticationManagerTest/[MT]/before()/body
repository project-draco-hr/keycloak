{
  super.before();
  realm=realmManager.createRealm("Test");
  realm.setAccessCodeLifespan(100);
  realm.setEnabled(true);
  realm.setName("Test");
  realm.setPrivateKeyPem("0234234");
  realm.setPublicKeyPem("0234234");
  realm.setAccessTokenLifespan(1000);
  realm.addRequiredCredential(CredentialRepresentation.PASSWORD);
  realm.setAuthenticationProviders(Arrays.asList(AuthenticationProviderModel.DEFAULT_PROVIDER));
  protector=new BruteForceProtector(factory);
  protector.start();
  am=new AuthenticationManager(providerSession,protector);
  user=realm.addUser("test");
  user.setEnabled(true);
  UserCredentialModel credential=new UserCredentialModel();
  credential.setType(CredentialRepresentation.PASSWORD);
  credential.setValue("password");
  realm.updateCredential(user,credential);
  formData=new MultivaluedMapImpl<String,String>();
  formData.add("username","test");
  formData.add(CredentialRepresentation.PASSWORD,"password");
  otp=new TimeBasedOTP();
}
