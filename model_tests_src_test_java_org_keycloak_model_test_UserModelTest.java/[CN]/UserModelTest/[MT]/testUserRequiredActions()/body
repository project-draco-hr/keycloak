{
  RealmModel realm=realmManager.createRealm("original");
  UserModel user=realm.addUser("user");
  Assert.assertTrue(user.getRequiredActions().isEmpty());
  user.addRequiredAction(UserModel.RequiredAction.CONFIGURE_TOTP);
  String id=realm.getId();
  commit();
  realm=realmManager.getRealm(id);
  user=realm.getUser("user");
  Assert.assertEquals(1,user.getRequiredActions().size());
  Assert.assertTrue(user.getRequiredActions().contains(RequiredAction.CONFIGURE_TOTP));
  user.addRequiredAction(UserModel.RequiredAction.CONFIGURE_TOTP);
  user=realm.getUser("user");
  Assert.assertEquals(1,user.getRequiredActions().size());
  Assert.assertTrue(user.getRequiredActions().contains(RequiredAction.CONFIGURE_TOTP));
  user.addRequiredAction(UserModel.RequiredAction.VERIFY_EMAIL);
  user=realm.getUser("user");
  Assert.assertEquals(2,user.getRequiredActions().size());
  Assert.assertTrue(user.getRequiredActions().contains(RequiredAction.CONFIGURE_TOTP));
  Assert.assertTrue(user.getRequiredActions().contains(RequiredAction.VERIFY_EMAIL));
  user.removeRequiredAction(UserModel.RequiredAction.CONFIGURE_TOTP);
  user=realm.getUser("user");
  Assert.assertEquals(1,user.getRequiredActions().size());
  Assert.assertTrue(user.getRequiredActions().contains(RequiredAction.VERIFY_EMAIL));
  user.removeRequiredAction(UserModel.RequiredAction.VERIFY_EMAIL);
  user=realm.getUser("user");
  Assert.assertTrue(user.getRequiredActions().isEmpty());
}
