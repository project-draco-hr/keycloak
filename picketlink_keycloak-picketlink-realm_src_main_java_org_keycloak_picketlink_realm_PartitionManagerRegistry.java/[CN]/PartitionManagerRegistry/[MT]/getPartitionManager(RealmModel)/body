{
  Map<String,String> ldapConfig=realm.getLdapServerConfig();
  if (ldapConfig == null || ldapConfig.isEmpty()) {
    logger.warnf("Ldap configuration is missing for realm '%s'",realm.getName());
    return null;
  }
  PartitionManagerContext context=partitionManagers.get(realm.getId());
  if (context == null || !ldapConfig.equals(context.config)) {
    logger.infof("Creating new partition manager for the realm: %s, LDAP Connection URL: %s, LDAP Base DN: %s, LDAP Vendor: %s",realm.getId(),ldapConfig.get(LDAPConstants.CONNECTION_URL),ldapConfig.get(LDAPConstants.BASE_DN),ldapConfig.get(LDAPConstants.VENDOR));
    PartitionManager manager=createPartitionManager(ldapConfig);
    context=new PartitionManagerContext(ldapConfig,manager);
    partitionManagers.put(realm.getId(),context);
  }
  return context.partitionManager;
}
