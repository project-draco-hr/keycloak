{
  if (account != null) {
    IDToken idToken=account.getKeycloakSecurityContext().getToken();
    if (idToken == null)     return;
    if (idToken.getSubject() != null) {
      exchange.getRequestHeaders().put(KEYCLOAK_SUBJECT,idToken.getSubject());
    }
    UserClaimSet claimSet=idToken.getUserClaimSet();
    if (claimSet.getPreferredUsername() != null) {
      exchange.getRequestHeaders().put(KEYCLOAK_USERNAME,claimSet.getPreferredUsername());
    }
    if (claimSet.getEmail() != null) {
      exchange.getRequestHeaders().put(KEYCLOAK_EMAIL,claimSet.getEmail());
    }
    if (claimSet.getName() != null) {
      exchange.getRequestHeaders().put(KEYCLOAK_NAME,claimSet.getName());
    }
    if (sendAccessToken) {
      exchange.getRequestHeaders().put(KEYCLOAK_ACCESS_TOKEN,account.getKeycloakSecurityContext().getTokenString());
    }
  }
  next.handleRequest(exchange);
}
