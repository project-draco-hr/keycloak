{
  DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  String deploymentName=deploymentUnit.getName();
  WarMetaData warMetaData=deploymentUnit.getAttachment(WarMetaData.ATTACHMENT_KEY);
  if (warMetaData == null) {
    return;
  }
  JBossWebMetaData webMetaData=warMetaData.getMergedJBossWebMetaData();
  if (webMetaData == null) {
    webMetaData=new JBossWebMetaData();
    warMetaData.setMergedJBossWebMetaData(webMetaData);
  }
  LoginConfigMetaData loginConfig=webMetaData.getLoginConfig();
  boolean webRequiresKC=loginConfig != null && "KEYCLOAK-SAML".equalsIgnoreCase(loginConfig.getAuthMethod());
  if (webRequiresKC) {
    log.debug("Setting up KEYCLOAK-SAML auth method for WAR: " + deploymentName);
    addValve(webMetaData);
  }
}
