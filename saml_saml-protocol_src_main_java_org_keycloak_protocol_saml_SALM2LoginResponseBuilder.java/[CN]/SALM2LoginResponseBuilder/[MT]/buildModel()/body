{
  ResponseType responseType=null;
  SAML2Response saml2Response=new SAML2Response();
  String id=IDGenerator.create("ID_");
  IssuerInfoHolder issuerHolder=new IssuerInfoHolder(issuer);
  issuerHolder.setStatusCode(JBossSAMLURIConstants.STATUS_SUCCESS.get());
  IDPInfoHolder idp=new IDPInfoHolder();
  idp.setNameIDFormatValue(nameId);
  idp.setNameIDFormat(nameIdFormat);
  SPInfoHolder sp=new SPInfoHolder();
  sp.setResponseDestinationURI(destination);
  sp.setRequestID(requestID);
  sp.setIssuer(requestIssuer);
  responseType=saml2Response.createResponseType(id,sp,idp,issuerHolder);
  AssertionType assertion=responseType.getAssertions().get(0).getAssertion();
  if (!disableAuthnStatement) {
    String authContextRef=JBossSAMLURIConstants.AC_UNSPECIFIED.get();
    if (isNotNull(authMethod))     authContextRef=authMethod;
    AuthnStatementType authnStatement=StatementUtil.createAuthnStatement(XMLTimeUtil.getIssueInstant(),authContextRef);
    authnStatement.setSessionIndex(assertion.getID());
    assertion.addStatement(authnStatement);
  }
  if (roles != null && !roles.isEmpty()) {
    AttributeStatementType attrStatement=StatementUtil.createAttributeStatementForRoles(roles,multiValuedRoles);
    assertion.addStatement(attrStatement);
  }
  if (attributes != null && attributes.size() > 0) {
    AttributeStatementType attStatement=StatementUtil.createAttributeStatement(attributes);
    assertion.addStatement(attStatement);
  }
  return responseType;
}
