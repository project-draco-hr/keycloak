{
  SAML2ErrorResponseBuilder builder=new SAML2ErrorResponseBuilder().destination(clientSession.getRedirectUri()).issuer(getResponseIssuer(realm)).status(status);
  try {
    JaxrsSAML2BindingBuilder binding=new JaxrsSAML2BindingBuilder().relayState(clientSession.getNote(GeneralConstants.RELAY_STATE));
    Document document=builder.buildDocument();
    if (isPostBinding(clientSession)) {
      return binding.postBinding(document).response(clientSession.getRedirectUri());
    }
 else {
      return binding.redirectBinding(document).response(clientSession.getRedirectUri());
    }
  }
 catch (  Exception e) {
    return ErrorPage.error(session,Messages.FAILED_TO_PROCESS_RESPONSE);
  }
}
