{
  URI redirectUri=requestAbstractType.getAssertionConsumerServiceURL();
  String redirect=OpenIDConnectService.verifyRedirectUri(uriInfo,redirectUri.toString(),realm,client);
  if (redirect == null) {
    event.error(Errors.INVALID_REDIRECT_URI);
    return Flows.forwardToSecurityFailurePage(session,realm,uriInfo,"Invalid redirect_uri.");
  }
  ClientSessionModel clientSession=session.sessions().createClientSession(realm,client);
  clientSession.setAuthMethod(SamlProtocol.LOGIN_PROTOCOL);
  clientSession.setRedirectUri(redirect);
  clientSession.setAction(ClientSessionModel.Action.AUTHENTICATE);
  clientSession.setNote(ClientSessionCode.ACTION_KEY,KeycloakModelUtils.generateCodeSecret());
  clientSession.setNote(SamlProtocol.SAML_BINDING,getBindingType());
  clientSession.setNote(GeneralConstants.RELAY_STATE,relayState);
  clientSession.setNote(SamlProtocol.SAML_REQUEST_ID,requestAbstractType.getID());
  NameIDPolicyType nameIdPolicy=requestAbstractType.getNameIDPolicy();
  if (nameIdPolicy != null) {
    String nameIdFormat=nameIdPolicy.getFormat().toString();
    if (isSupportedNameIdFormat(nameIdFormat)) {
      clientSession.setNote(GeneralConstants.NAMEID_FORMAT,nameIdFormat);
    }
 else {
      event.error(Errors.INVALID_TOKEN);
      return Flows.forwardToSecurityFailurePage(session,realm,uriInfo,"Unsupported NameIDFormat.");
    }
  }
 else {
    clientSession.setNote(GeneralConstants.NAMEID_FORMAT,JBossSAMLURIConstants.NAMEID_FORMAT_UNSPECIFIED.get());
  }
  Response response=authManager.checkNonFormAuthentication(session,clientSession,realm,uriInfo,request,clientConnection,headers,event);
  if (response != null)   return response;
  LoginFormsProvider forms=Flows.forms(session,realm,clientSession.getClient(),uriInfo).setClientSessionCode(new ClientSessionCode(realm,clientSession).getCode());
  String rememberMeUsername=AuthenticationManager.getRememberMeUsername(realm,headers);
  if (rememberMeUsername != null) {
    MultivaluedMap<String,String> formData=new MultivaluedMapImpl<String,String>();
    formData.add(AuthenticationManager.FORM_USERNAME,rememberMeUsername);
    formData.add("rememberMe","on");
    forms.setFormData(formData);
  }
  return forms.createLogin();
}
