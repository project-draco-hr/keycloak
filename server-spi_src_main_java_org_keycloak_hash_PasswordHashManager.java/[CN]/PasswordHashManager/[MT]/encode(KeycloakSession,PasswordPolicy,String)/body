{
  String algorithm=passwordPolicy.getHashAlgorithm();
  int iterations=passwordPolicy.getHashIterations();
  if (iterations < 1) {
    iterations=1;
  }
  PasswordHashProvider provider=session.getProvider(PasswordHashProvider.class,passwordPolicy.getHashAlgorithm());
  if (provider == null) {
    log.warnv("Could not find hash provider {0} from password policy, using default provider {1}",algorithm,Constants.DEFAULT_HASH_ALGORITHM);
    provider=session.getProvider(PasswordHashProvider.class,Constants.DEFAULT_HASH_ALGORITHM);
  }
  return provider.encode(rawPassword,iterations);
}
