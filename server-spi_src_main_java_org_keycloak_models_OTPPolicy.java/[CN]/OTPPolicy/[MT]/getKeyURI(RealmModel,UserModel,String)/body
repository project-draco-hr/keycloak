{
  try {
    String displayName=realm.getDisplayName() != null && !realm.getDisplayName().isEmpty() ? realm.getDisplayName() : realm.getName();
    String uri;
    uri="otpauth://" + type + "/"+ URLEncoder.encode(user.getUsername(),"UTF-8")+ "?secret="+ Base32.encode(secret.getBytes())+ "&digits="+ digits+ "&algorithm="+ algToKeyUriAlg.get(algorithm);
    uri+="&issuer=" + URLEncoder.encode(displayName,"UTF-8");
    if (type.equals(UserCredentialModel.HOTP)) {
      uri+="&counter=" + initialCounter;
    }
    if (type.equals(UserCredentialModel.TOTP)) {
      uri+="&period=" + period;
    }
    return uri;
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
}
