{
  if (passwordHistoryPolicyValue != -1) {
    UserCredentialValueModel cred=getCredentialValueModel(user,UserCredentialModel.PASSWORD);
    if (cred != null) {
      if (PasswordHashManager.verify(session,passwordPolicy,password,cred)) {
        return new Error(INVALID_PASSWORD_HISTORY,passwordHistoryPolicyValue);
      }
    }
    List<UserCredentialValueModel> passwordExpiredCredentials=getCredentialValueModels(user,passwordHistoryPolicyValue - 1,UserCredentialModel.PASSWORD_HISTORY);
    for (    UserCredentialValueModel credential : passwordExpiredCredentials) {
      if (PasswordHashManager.verify(session,passwordPolicy,password,credential)) {
        return new Error(INVALID_PASSWORD_HISTORY,passwordHistoryPolicyValue);
      }
    }
  }
  return null;
}
