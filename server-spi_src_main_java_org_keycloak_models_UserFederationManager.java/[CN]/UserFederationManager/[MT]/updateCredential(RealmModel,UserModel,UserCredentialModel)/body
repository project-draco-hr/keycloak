{
  if (credential.getType().equals(UserCredentialModel.PASSWORD)) {
    if (realm.getPasswordPolicy() != null) {
      PolicyError error=session.getProvider(PasswordPolicyManagerProvider.class).validate(user,credential.getValue());
      if (error != null)       throw new ModelException(error.getMessage(),error.getParameters());
    }
  }
  user.updateCredential(credential);
}
