{
  Set<String> requiredActionsFor=Collections.EMPTY_SET;
  if (!StorageId.isLocalStorage(user)) {
    String providerId=StorageId.resolveProviderId(user);
    UserStorageProvider provider=getStorageProvider(realm,providerId);
    if (provider instanceof CredentialInputUpdater) {
      CredentialInputUpdater updater=(CredentialInputUpdater)provider;
      if (updater.supportsCredentialType(type)) {
        requiredActionsFor=updater.requiredActionsFor(realm,user,type);
        if (!requiredActionsFor.isEmpty()) {
          return requiredActionsFor;
        }
      }
    }
  }
  List<ComponentModel> components=getCredentialProviderComponents(realm);
  for (  ComponentModel component : components) {
    CredentialProviderFactory factory=(CredentialProviderFactory)session.getKeycloakSessionFactory().getProviderFactory(CredentialProvider.class,component.getProviderId());
    if (!Types.supports(CredentialInputUpdater.class,factory,CredentialProviderFactory.class))     continue;
    CredentialInputUpdater updater=(CredentialInputUpdater)session.getAttribute(component.getId());
    if (updater == null) {
      updater=(CredentialInputUpdater)factory.create(session,component);
      session.setAttribute(component.getId(),updater);
    }
    if (updater.supportsCredentialType(type)) {
      requiredActionsFor=updater.requiredActionsFor(realm,user,type);
      if (!requiredActionsFor.isEmpty()) {
        return requiredActionsFor;
      }
    }
  }
  return requiredActionsFor;
}
