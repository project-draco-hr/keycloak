{
  AuthenticationExecutionModel execution=result.getExecution();
  Status status=result.getStatus();
  if (status == Status.SUCCESS) {
    logger.debugv("authenticator SUCCESS: {0}",execution.getAuthenticator());
    clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.SUCCESS);
    if (execution.isAlternative())     alternativeSuccessful=true;
    return null;
  }
 else   if (status == Status.FAILED) {
    logger.debugv("authenticator FAILED: {0}",execution.getAuthenticator());
    logFailure();
    clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.FAILED);
    if (result.getChallenge() != null) {
      return sendChallenge(result,execution);
    }
    throw new AuthException(result.getError());
  }
 else   if (status == Status.FORCE_CHALLENGE) {
    clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.CHALLENGED);
    return sendChallenge(result,execution);
  }
 else   if (status == Status.CHALLENGE) {
    logger.debugv("authenticator CHALLENGE: {0}",execution.getAuthenticator());
    if (execution.isRequired()) {
      clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.CHALLENGED);
      return sendChallenge(result,execution);
    }
    UserModel authenticatedUser=clientSession.getAuthenticatedUser();
    if (execution.isOptional() && authenticatedUser != null && result.getAuthenticator().configuredFor(session,realm,authenticatedUser)) {
      clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.CHALLENGED);
      return sendChallenge(result,execution);
    }
    if (execution.isAlternative()) {
      alternativeChallenge=result.getChallenge();
      challengedAlternativeExecution=execution;
    }
 else {
      clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.SKIPPED);
    }
    return null;
  }
 else   if (status == Status.FAILURE_CHALLENGE) {
    logger.debugv("authenticator FAILURE_CHALLENGE: {0}",execution.getAuthenticator());
    logFailure();
    clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.CHALLENGED);
    return sendChallenge(result,execution);
  }
 else   if (status == Status.ATTEMPTED) {
    logger.debugv("authenticator ATTEMPTED: {0}",execution.getAuthenticator());
    if (execution.getRequirement() == AuthenticationExecutionModel.Requirement.REQUIRED) {
      throw new AuthException(Error.INVALID_CREDENTIALS);
    }
    clientSession.setExecutionStatus(execution.getId(),ClientSessionModel.ExecutionStatus.ATTEMPTED);
    return null;
  }
 else {
    logger.debugv("authenticator INTERNAL_ERROR: {0}",execution.getAuthenticator());
    logger.error("Unknown result status");
    throw new AuthException(Error.INTERNAL_ERROR);
  }
}
