{
  PolicyRepresentation defaultPolicy=new PolicyRepresentation();
  defaultPolicy.setName("Only From Realm Policy");
  defaultPolicy.setDescription("A policy that grants access only for users within this realm");
  defaultPolicy.setType("js");
  defaultPolicy.setDecisionStrategy(Policy.DecisionStrategy.AFFIRMATIVE);
  defaultPolicy.setLogic(Policy.Logic.POSITIVE);
  HashMap<String,String> defaultPolicyConfig=new HashMap<>();
  defaultPolicyConfig.put("code","var context = $evaluation.getContext();\n" + "\n" + "// using attributes from the evaluation context to obtain the realm\n"+ "var contextAttributes = context.getAttributes();\n"+ "var realmName = contextAttributes.getValue('kc.realm.name').asString(0);\n"+ "\n"+ "// using attributes from the identity to obtain the issuer\n"+ "var identity = context.getIdentity();\n"+ "var identityAttributes = identity.getAttributes();\n"+ "var issuer = identityAttributes.getValue('iss').asString(0);\n"+ "\n"+ "// only users from the realm have access granted \n"+ "if (issuer.endsWith(realmName)) {\n"+ "    $evaluation.grant();\n"+ "}");
  defaultPolicy.setConfig(defaultPolicyConfig);
  getPolicyResource().create(defaultPolicy);
  return defaultPolicy;
}
