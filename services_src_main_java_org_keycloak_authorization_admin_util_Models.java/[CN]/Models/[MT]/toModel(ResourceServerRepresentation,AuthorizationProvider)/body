{
  RealmModel realm=authorization.getKeycloakSession().getContext().getRealm();
  ClientModel client=realm.getClientById(server.getClientId());
  if (client == null) {
    throw new ErrorResponseException(ErrorCode.INVALID_CLIENT_ID,"Client with id [" + server.getClientId() + "] not found in realm ["+ realm.getName()+ "].",Status.BAD_REQUEST);
  }
  if (!client.isServiceAccountsEnabled()) {
    throw new ErrorResponseException(ErrorCode.INVALID_CLIENT_ID,"Client with id [" + server.getClientId() + "] must have a service account.",Status.BAD_REQUEST);
  }
  ResourceServer existingResourceServer=authorization.getStoreFactory().getResourceServerStore().findByClient(client.getId());
  if (existingResourceServer != null) {
    throw new ErrorResponseException(ErrorCode.INVALID_CLIENT_ID,"Resource server already exists with client id [" + server.getClientId() + "].",Status.BAD_REQUEST);
  }
  if (server.getName() == null) {
    server.setName(client.getName());
  }
  ResourceServer model=authorization.getStoreFactory().getResourceServerStore().create(client.getId());
  model.setAllowRemoteResourceManagement(server.isAllowRemoteResourceManagement());
  model.setPolicyEnforcementMode(server.getPolicyEnforcementMode());
  return model;
}
