{
  List<CredentialInput> toValidate=new LinkedList<>();
  toValidate.addAll(inputs);
  if (!StorageId.isLocalStorage(user)) {
    String providerId=StorageId.resolveProviderId(user);
    UserStorageProvider provider=UserStorageManager.getStorageProvider(session,realm,providerId);
    if (provider instanceof CredentialInputValidator) {
      Iterator<CredentialInput> it=toValidate.iterator();
      while (it.hasNext()) {
        CredentialInput input=it.next();
        CredentialInputValidator validator=(CredentialInputValidator)provider;
        if (validator.supportsCredentialType(input.getType()) && validator.isValid(realm,user,input)) {
          it.remove();
        }
      }
    }
  }
 else {
    UserFederationProvider link=session.users().getFederationLink(realm,user);
    if (link != null) {
      session.users().validateUser(realm,user);
      Iterator<CredentialInput> it=toValidate.iterator();
      while (it.hasNext()) {
        CredentialInput input=it.next();
        if (link.supportsCredentialType(input.getType()) && link.isValid(realm,user,input)) {
          it.remove();
        }
      }
    }
  }
  if (toValidate.isEmpty())   return true;
  List<CredentialInputValidator> credentialProviders=getCredentialProviders(realm,CredentialInputValidator.class);
  for (  CredentialInputValidator validator : credentialProviders) {
    Iterator<CredentialInput> it=toValidate.iterator();
    while (it.hasNext()) {
      CredentialInput input=it.next();
      if (validator.supportsCredentialType(input.getType()) && validator.isValid(realm,user,input)) {
        it.remove();
      }
    }
  }
  return toValidate.isEmpty();
}
