{
  List<IdentityProviderModel> identityProviders=realm.getIdentityProviders();
  for (  IdentityProviderModel identityProvider : identityProviders) {
    if (identityProvider.isAuthenticateByDefault()) {
      return buildRedirectToIdentityProvider(identityProvider.getAlias(),new ClientSessionCode(realm,clientSession).getCode());
    }
  }
  AuthenticationFlowModel flow=getAuthenticationFlow();
  String flowId=flow.getId();
  AuthenticationProcessor processor=createProcessor(clientSession,flowId,LoginActionsService.AUTHENTICATE_PATH);
  if (isPassive) {
    Response challenge=null;
    Response challenge2=null;
    try {
      challenge=processor.authenticateOnly();
      if (challenge == null) {
        challenge2=processor.attachSessionExecutionRequiredActions();
      }
    }
 catch (    Exception e) {
      return processor.handleBrowserException(e);
    }
    if (challenge != null || challenge2 != null) {
      if (processor.isUserSessionCreated()) {
        session.sessions().removeUserSession(realm,processor.getUserSession());
      }
      if (challenge != null)       return protocol.sendError(clientSession,Error.PASSIVE_LOGIN_REQUIRED);
 else       return protocol.sendError(clientSession,Error.PASSIVE_INTERACTION_REQUIRED);
    }
 else {
      return processor.finishAuthentication(protocol);
    }
  }
 else {
    try {
      RestartLoginCookie.setRestartCookie(realm,clientConnection,uriInfo,clientSession);
      return processor.authenticate();
    }
 catch (    Exception e) {
      return processor.handleBrowserException(e);
    }
  }
}
