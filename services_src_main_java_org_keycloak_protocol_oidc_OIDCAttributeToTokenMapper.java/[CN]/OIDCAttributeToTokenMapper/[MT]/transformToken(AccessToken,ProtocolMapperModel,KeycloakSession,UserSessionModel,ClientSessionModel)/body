{
  String attributeValue=null;
  UserModel user=userSession.getUser();
switch (mappingModel.getSource()) {
case USER_ATTRIBUTE:
    attributeValue=user.getAttribute(mappingModel.getSourceAttribute());
  break;
case USER_SESSION_NOTE:
attributeValue=userSession.getNote(mappingModel.getSourceAttribute());
break;
case CLIENT_SESSION_NOTE:
attributeValue=clientSession.getNote(mappingModel.getSourceAttribute());
break;
case USER_MODEL:
attributeValue=getUserModelValue(user,mappingModel);
break;
}
if (attributeValue == null) return token;
String[] split=mappingModel.getProtocolClaim().split(".");
Map<String,Object> jsonObject=token.getOtherClaims();
for (int i=0; i < split.length; i++) {
if (i == split.length - 1) {
jsonObject.put(split[i],attributeValue);
}
 else {
Map<String,Object> nested=(Map<String,Object>)jsonObject.get(split[i]);
if (nested == null) {
nested=new HashMap<String,Object>();
jsonObject.put(split[i],nested);
jsonObject=nested;
}
}
}
return token;
}
