{
  if (accessToken == null) {
    throw new IllegalStateException("accessToken not set");
  }
  idToken=new IDToken();
  idToken.id(KeycloakModelUtils.generateId());
  idToken.subject(accessToken.getSubject());
  idToken.audience(client.getClientId());
  idToken.issuedNow();
  idToken.issuedFor(accessToken.getIssuedFor());
  idToken.issuer(accessToken.getIssuer());
  if (realm.getAccessTokenLifespan() > 0) {
    idToken.expiration(Time.currentTime() + realm.getAccessTokenLifespan());
  }
  transformIDToken(session,idToken,realm,client,userSession.getUser(),userSession,clientSession);
  return this;
}
