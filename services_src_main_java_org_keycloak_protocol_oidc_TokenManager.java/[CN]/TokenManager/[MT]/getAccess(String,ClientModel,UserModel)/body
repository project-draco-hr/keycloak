{
  Set<RoleModel> requestedRoles=new HashSet<RoleModel>();
  Set<RoleModel> roleMappings=user.getRoleMappings();
  if (client.isFullScopeAllowed())   return roleMappings;
  Set<RoleModel> scopeMappings=client.getScopeMappings();
  scopeMappings.addAll(client.getRoles());
  for (  RoleModel role : roleMappings) {
    for (    RoleModel desiredRole : scopeMappings) {
      Set<RoleModel> visited=new HashSet<RoleModel>();
      applyScope(role,desiredRole,visited,requestedRoles);
    }
  }
  return requestedRoles;
}
