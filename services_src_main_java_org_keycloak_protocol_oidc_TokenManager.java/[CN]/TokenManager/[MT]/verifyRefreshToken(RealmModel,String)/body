{
  JWSInput jws=new JWSInput(encodedRefreshToken);
  RefreshToken refreshToken=null;
  try {
    if (!RSAProvider.verify(jws,realm.getPublicKey())) {
      throw new OAuthErrorException(OAuthErrorException.INVALID_GRANT,"Invalid refresh token");
    }
    refreshToken=jws.readJsonContent(RefreshToken.class);
  }
 catch (  Exception e) {
    throw new OAuthErrorException(OAuthErrorException.INVALID_GRANT,"Invalid refresh token",e);
  }
  if (refreshToken.isExpired()) {
    throw new OAuthErrorException(OAuthErrorException.INVALID_GRANT,"Refresh token expired");
  }
  if (refreshToken.getIssuedAt() < realm.getNotBefore()) {
    throw new OAuthErrorException(OAuthErrorException.INVALID_GRANT,"Stale refresh token");
  }
  return refreshToken;
}
