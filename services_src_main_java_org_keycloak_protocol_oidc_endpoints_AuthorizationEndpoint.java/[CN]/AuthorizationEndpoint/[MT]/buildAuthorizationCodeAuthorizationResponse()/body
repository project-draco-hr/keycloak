{
  String accessCode=new ClientSessionCode(realm,clientSession).getCode();
  if (idpHint != null && !"".equals(idpHint)) {
    IdentityProviderModel identityProviderModel=realm.getIdentityProviderById(idpHint);
    if (identityProviderModel == null) {
      return Flows.forms(session,realm,null,uriInfo).setError("Could not find an identity provider with the identifier [" + idpHint + "].").createErrorPage();
    }
    return buildRedirectToIdentityProvider(idpHint,accessCode);
  }
  Response response=authManager.checkNonFormAuthentication(session,clientSession,realm,uriInfo,request,clientConnection,headers,event);
  if (response != null)   return response;
  HttpAuthenticationManager httpAuthManager=new HttpAuthenticationManager(session,clientSession,realm,uriInfo,request,clientConnection,event);
  HttpAuthenticationManager.HttpAuthOutput httpAuthOutput=httpAuthManager.spnegoAuthenticate();
  if (httpAuthOutput.getResponse() != null)   return httpAuthOutput.getResponse();
  if (prompt != null && prompt.equals("none")) {
    OIDCLoginProtocol oauth=new OIDCLoginProtocol(session,realm,uriInfo);
    return oauth.cancelLogin(clientSession);
  }
  List<IdentityProviderModel> identityProviders=realm.getIdentityProviders();
  for (  IdentityProviderModel identityProvider : identityProviders) {
    if (identityProvider.isAuthenticateByDefault()) {
      return buildRedirectToIdentityProvider(identityProvider.getId(),accessCode);
    }
  }
  List<RequiredCredentialModel> requiredCredentials=realm.getRequiredCredentials();
  if (requiredCredentials.isEmpty()) {
    if (!identityProviders.isEmpty()) {
      if (identityProviders.size() == 1) {
        return buildRedirectToIdentityProvider(identityProviders.get(0).getId(),accessCode);
      }
      return Flows.forms(session,realm,null,uriInfo).setError("Realm [" + realm.getName() + "] supports multiple identity providers. Could not determine which identity provider should be used to authenticate with.").createErrorPage();
    }
    return Flows.forms(session,realm,null,uriInfo).setError("Realm [" + realm.getName() + "] does not support any credential type.").createErrorPage();
  }
  LoginFormsProvider forms=Flows.forms(session,realm,clientSession.getClient(),uriInfo).setClientSessionCode(accessCode);
  if (httpAuthOutput.getChallenge() != null) {
    httpAuthOutput.getChallenge().sendChallenge(forms);
  }
  String rememberMeUsername=AuthenticationManager.getRememberMeUsername(realm,headers);
  if (loginHint != null || rememberMeUsername != null) {
    MultivaluedMap<String,String> formData=new MultivaluedMapImpl<String,String>();
    if (loginHint != null) {
      formData.add(AuthenticationManager.FORM_USERNAME,loginHint);
    }
 else {
      formData.add(AuthenticationManager.FORM_USERNAME,rememberMeUsername);
      formData.add("rememberMe","on");
    }
    forms.setFormData(formData);
  }
  return forms.createLogin();
}
