{
  if (nameIdFormat.equals(JBossSAMLURIConstants.NAMEID_FORMAT_EMAIL.get())) {
    return userSession.getUser().getEmail();
  }
 else   if (nameIdFormat.equals(JBossSAMLURIConstants.NAMEID_FORMAT_TRANSIENT.get())) {
    return "G-" + UUID.randomUUID().toString();
  }
 else   if (nameIdFormat.equals(JBossSAMLURIConstants.NAMEID_FORMAT_PERSISTENT.get())) {
    UserModel user=userSession.getUser();
    String name=SAML_PERSISTENT_NAME_ID_FOR + "." + clientSession.getClient().getClientId();
    String samlPersistentId=user.getFirstAttribute(name);
    if (samlPersistentId != null)     return samlPersistentId;
    samlPersistentId="G-" + UUID.randomUUID().toString();
    user.setSingleAttribute(name,samlPersistentId);
    return samlPersistentId;
  }
 else   if (nameIdFormat.equals(JBossSAMLURIConstants.NAMEID_FORMAT_UNSPECIFIED.get())) {
    return userSession.getUser().getUsername();
  }
 else {
    return userSession.getUser().getUsername();
  }
}
