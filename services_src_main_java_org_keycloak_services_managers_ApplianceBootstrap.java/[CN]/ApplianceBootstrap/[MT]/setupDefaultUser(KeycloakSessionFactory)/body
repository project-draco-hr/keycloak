{
  KeycloakSession session=sessionFactory.create();
  session.getTransaction().begin();
  try {
    RealmModel realm=session.realms().getRealm(Config.getAdminRealm());
    if (session.users().getUserByUsername("admin",realm) == null) {
      UserModel adminUser=session.users().addUser(realm,"admin");
      adminUser.setEnabled(true);
      UserCredentialModel usrCredModel=new UserCredentialModel();
      usrCredModel.setType(UserCredentialModel.PASSWORD);
      usrCredModel.setValue("admin");
      session.users().updateCredential(realm,adminUser,usrCredModel);
      adminUser.addRequiredAction(UserModel.RequiredAction.UPDATE_PASSWORD);
      RoleModel adminRole=realm.getRole(AdminRoles.ADMIN);
      adminUser.grantRole(adminRole);
      ClientModel accountApp=realm.getClientNameMap().get(Constants.ACCOUNT_MANAGEMENT_CLIENT_ID);
      for (      String r : accountApp.getDefaultRoles()) {
        adminUser.grantRole(accountApp.getRole(r));
      }
    }
    session.getTransaction().commit();
    return true;
  }
  finally {
    session.close();
  }
}
