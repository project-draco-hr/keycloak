{
  Cookie cookie=headers.getCookies().get(cookieName);
  if (cookie == null) {
    logger.debug("authenticateCookie could not find cookie: {0}",cookieName);
    return null;
  }
  String tokenString=cookie.getValue();
  try {
    SkeletonKeyToken token=RSATokenVerifier.verifyToken(tokenString,realm.getPublicKey(),realm.getId());
    if (!token.isActive()) {
      logger.debug("identity cookie expired");
      expireIdentityCookie(realm,uriInfo);
      return null;
    }
    Auth auth=new Auth();
    UserModel user=realm.getUser(token.getPrincipal());
    if (user == null || !user.isEnabled()) {
      logger.debug("Unknown user in identity cookie");
      expireIdentityCookie(realm,uriInfo);
      return null;
    }
    auth.setUser(user);
    if (token.getIssuedFor() != null) {
      UserModel client=realm.getUser(token.getIssuedFor());
      if (client == null || !client.isEnabled()) {
        logger.debug("Unknown client in identity cookie");
        expireIdentityCookie(realm,uriInfo);
        return null;
      }
      auth.setClient(client);
    }
    return auth;
  }
 catch (  VerificationException e) {
    logger.debug("Failed to verify identity cookie",e);
    expireIdentityCookie(realm,uriInfo);
  }
  return null;
}
