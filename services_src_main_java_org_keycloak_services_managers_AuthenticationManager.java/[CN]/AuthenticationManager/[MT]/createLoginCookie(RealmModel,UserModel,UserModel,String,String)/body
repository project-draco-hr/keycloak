{
  SkeletonKeyToken identityToken=createIdentityToken(realm,user.getLoginName());
  if (client != null) {
    identityToken.issuedFor(client.getLoginName());
  }
  String encoded=encodeToken(realm,identityToken);
  boolean secureOnly=!realm.isSslNotRequired();
  logger.debug("creatingLoginCookie - name: {0} path: {1}",cookieName,cookiePath);
  NewCookie cookie=new NewCookie(cookieName,encoded,cookiePath,null,null,NewCookie.DEFAULT_MAX_AGE,secureOnly,true);
  return cookie;
}
