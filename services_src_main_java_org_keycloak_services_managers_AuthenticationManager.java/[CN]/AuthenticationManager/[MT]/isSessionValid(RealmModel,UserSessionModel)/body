{
  if (userSession == null)   return false;
  int currentTime=Time.currentTime();
  int max=userSession.getStarted() + realm.getSsoSessionMaxLifespan();
  boolean valid=userSession != null && userSession.getLastSessionRefresh() + realm.getSsoSessionIdleTimeout() > currentTime && max > currentTime;
  return valid;
}
