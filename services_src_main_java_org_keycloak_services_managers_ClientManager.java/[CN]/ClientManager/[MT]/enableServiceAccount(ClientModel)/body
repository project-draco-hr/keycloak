{
  client.setServiceAccountsEnabled(true);
  RealmModel realm=client.getRealm();
  Map<String,String> search=new HashMap<>();
  search.put(ServiceAccountConstants.SERVICE_ACCOUNT_CLIENT_ATTRIBUTE,client.getId());
  List<UserModel> serviceAccountUsers=realmManager.getSession().users().searchForUserByUserAttributes(search,realm);
  if (serviceAccountUsers.size() == 0) {
    String username=ServiceAccountConstants.SERVICE_ACCOUNT_USER_PREFIX + client.getClientId();
    logger.infof("Creating service account user '%s'",username);
    UserModel user=realmManager.getSession().users().addUser(realm,username);
    user.setEnabled(true);
    user.setEmail(username + "@placeholder.org");
    user.setSingleAttribute(ServiceAccountConstants.SERVICE_ACCOUNT_CLIENT_ATTRIBUTE,client.getId());
  }
  if (client.getProtocolMapperByName(OIDCLoginProtocol.LOGIN_PROTOCOL,ServiceAccountConstants.CLIENT_ID_PROTOCOL_MAPPER) == null) {
    logger.debugf("Creating service account protocol mapper '%s' for client '%s'",ServiceAccountConstants.CLIENT_ID_PROTOCOL_MAPPER,client.getClientId());
    ProtocolMapperModel protocolMapper=UserSessionNoteMapper.createClaimMapper(ServiceAccountConstants.CLIENT_ID_PROTOCOL_MAPPER,ServiceAccountConstants.CLIENT_ID,ServiceAccountConstants.CLIENT_ID,"String",false,"",true,true);
    client.addProtocolMapper(protocolMapper);
  }
  if (client.getProtocolMapperByName(OIDCLoginProtocol.LOGIN_PROTOCOL,ServiceAccountConstants.CLIENT_HOST_PROTOCOL_MAPPER) == null) {
    logger.debugf("Creating service account protocol mapper '%s' for client '%s'",ServiceAccountConstants.CLIENT_HOST_PROTOCOL_MAPPER,client.getClientId());
    ProtocolMapperModel protocolMapper=UserSessionNoteMapper.createClaimMapper(ServiceAccountConstants.CLIENT_HOST_PROTOCOL_MAPPER,ServiceAccountConstants.CLIENT_HOST,ServiceAccountConstants.CLIENT_HOST,"String",false,"",true,true);
    client.addProtocolMapper(protocolMapper);
  }
  if (client.getProtocolMapperByName(OIDCLoginProtocol.LOGIN_PROTOCOL,ServiceAccountConstants.CLIENT_ADDRESS_PROTOCOL_MAPPER) == null) {
    logger.debugf("Creating service account protocol mapper '%s' for client '%s'",ServiceAccountConstants.CLIENT_ADDRESS_PROTOCOL_MAPPER,client.getClientId());
    ProtocolMapperModel protocolMapper=UserSessionNoteMapper.createClaimMapper(ServiceAccountConstants.CLIENT_ADDRESS_PROTOCOL_MAPPER,ServiceAccountConstants.CLIENT_ADDRESS,ServiceAccountConstants.CLIENT_ADDRESS,"String",false,"",true,true);
    client.addProtocolMapper(protocolMapper);
  }
}
