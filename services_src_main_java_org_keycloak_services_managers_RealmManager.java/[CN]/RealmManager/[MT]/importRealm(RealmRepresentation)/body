{
  String id=rep.getId();
  if (id == null) {
    id=KeycloakModelUtils.generateId();
  }
  RealmModel realm=model.createRealm(id,rep.getRealm());
  realm.setName(rep.getRealm());
  setupRealmDefaults(realm);
  boolean postponeMasterClientSetup=postponeMasterClientSetup(rep);
  if (!postponeMasterClientSetup) {
    setupMasterAdminManagement(realm);
  }
  if (!hasRealmAdminManagementClient(rep))   setupRealmAdminManagement(realm);
  if (!hasAccountManagementClient(rep))   setupAccountManagement(realm);
  boolean postponeImpersonationSetup=false;
  if (!hasImpersonationServiceClient(rep)) {
    if (hasRealmAdminManagementClient(rep)) {
      postponeImpersonationSetup=true;
    }
 else {
      setupImpersonationService(realm);
    }
  }
  if (!hasBrokerClient(rep))   setupBrokerService(realm);
  if (!hasAdminConsoleClient(rep))   setupAdminConsole(realm);
  if (!hasRealmRole(rep,Constants.OFFLINE_ACCESS_ROLE))   setupOfflineTokens(realm);
  RepresentationToModel.importRealm(session,rep,realm);
  if (postponeMasterClientSetup) {
    setupMasterAdminManagement(realm);
  }
  if (postponeImpersonationSetup) {
    setupImpersonationService(realm);
  }
  setupAuthenticationFlows(realm);
  setupRequiredActions(realm);
  List<UserFederationProviderModel> federationProviders=realm.getUserFederationProviders();
  UsersSyncManager usersSyncManager=new UsersSyncManager();
  for (  final UserFederationProviderModel fedProvider : federationProviders) {
    usersSyncManager.refreshPeriodicSyncForProvider(session.getKeycloakSessionFactory(),session.getProvider(TimerProvider.class),fedProvider,realm.getId());
  }
  return realm;
}
