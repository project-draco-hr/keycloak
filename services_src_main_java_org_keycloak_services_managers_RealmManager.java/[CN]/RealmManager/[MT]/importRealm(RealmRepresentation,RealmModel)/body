{
  newRealm.setName(rep.getRealm());
  if (rep.isEnabled() != null)   newRealm.setEnabled(rep.isEnabled());
  if (rep.isSocial() != null)   newRealm.setSocial(rep.isSocial());
  if (rep.getTokenLifespan() != null)   newRealm.setTokenLifespan(rep.getTokenLifespan());
 else   newRealm.setTokenLifespan(300);
  if (rep.getAccessCodeLifespan() != null)   newRealm.setAccessCodeLifespan(rep.getAccessCodeLifespan());
 else   newRealm.setAccessCodeLifespan(60);
  if (rep.getAccessCodeLifespanUserAction() != null)   newRealm.setAccessCodeLifespanUserAction(rep.getAccessCodeLifespanUserAction());
 else   newRealm.setAccessCodeLifespanUserAction(300);
  if (rep.isSslNotRequired() != null)   newRealm.setSslNotRequired(rep.isSslNotRequired());
  if (rep.isRegistrationAllowed() != null)   newRealm.setRegistrationAllowed(rep.isRegistrationAllowed());
  if (rep.isVerifyEmail() != null)   newRealm.setVerifyEmail(rep.isVerifyEmail());
  if (rep.isResetPasswordAllowed() != null)   newRealm.setResetPasswordAllowed(rep.isResetPasswordAllowed());
  if (rep.isUpdateProfileOnInitialSocialLogin() != null)   newRealm.setUpdateProfileOnInitialSocialLogin(rep.isUpdateProfileOnInitialSocialLogin());
  if (rep.getPrivateKey() == null || rep.getPublicKey() == null) {
    generateRealmKeys(newRealm);
  }
 else {
    newRealm.setPrivateKeyPem(rep.getPrivateKey());
    newRealm.setPublicKeyPem(rep.getPublicKey());
  }
  Map<String,UserModel> userMap=new HashMap<String,UserModel>();
  if (rep.getRequiredCredentials() != null) {
    for (    String requiredCred : rep.getRequiredCredentials()) {
      addRequiredCredential(newRealm,requiredCred);
    }
  }
 else {
    addRequiredCredential(newRealm,CredentialRepresentation.PASSWORD);
  }
  if (rep.getRequiredApplicationCredentials() != null) {
    for (    String requiredCred : rep.getRequiredApplicationCredentials()) {
      addResourceRequiredCredential(newRealm,requiredCred);
    }
  }
 else {
    addResourceRequiredCredential(newRealm,CredentialRepresentation.PASSWORD);
  }
  if (rep.getRequiredOAuthClientCredentials() != null) {
    for (    String requiredCred : rep.getRequiredOAuthClientCredentials()) {
      addOAuthClientRequiredCredential(newRealm,requiredCred);
    }
  }
 else {
    addOAuthClientRequiredCredential(newRealm,CredentialRepresentation.PASSWORD);
  }
  newRealm.setPasswordPolicy(new PasswordPolicy(rep.getPasswordPolicy()));
  if (rep.getUsers() != null) {
    for (    UserRepresentation userRep : rep.getUsers()) {
      UserModel user=createUser(newRealm,userRep);
      userMap.put(user.getLoginName(),user);
    }
  }
  if (rep.getRoles() != null) {
    for (    RoleRepresentation roleRep : rep.getRoles()) {
      createRole(newRealm,roleRep);
    }
  }
  if (rep.getDefaultRoles() != null) {
    for (    String roleString : rep.getDefaultRoles()) {
      newRealm.addDefaultRole(roleString.trim());
    }
  }
  if (rep.getApplications() != null) {
    Map<String,ApplicationModel> appMap=createApplications(rep,newRealm);
    for (    ApplicationModel app : appMap.values()) {
      userMap.put(app.getApplicationUser().getLoginName(),app.getApplicationUser());
    }
  }
  if (rep.getOauthClients() != null) {
    Map<String,OAuthClientModel> oauthMap=createOAuthClients(rep,newRealm);
    for (    OAuthClientModel app : oauthMap.values()) {
      userMap.put(app.getOAuthAgent().getLoginName(),app.getOAuthAgent());
    }
  }
  Map<String,ApplicationModel> appMap=newRealm.getApplicationNameMap();
  if (rep.getApplicationRoleMappings() != null) {
    ApplicationManager manager=new ApplicationManager(this);
    for (    Map.Entry<String,List<UserRoleMappingRepresentation>> entry : rep.getApplicationRoleMappings().entrySet()) {
      ApplicationModel app=appMap.get(entry.getKey());
      if (app == null) {
        throw new RuntimeException("Unable to find application role mappings for app: " + entry.getKey());
      }
      manager.createRoleMappings(newRealm,app,entry.getValue());
    }
  }
  if (rep.getApplicationScopeMappings() != null) {
    ApplicationManager manager=new ApplicationManager(this);
    for (    Map.Entry<String,List<ScopeMappingRepresentation>> entry : rep.getApplicationScopeMappings().entrySet()) {
      ApplicationModel app=appMap.get(entry.getKey());
      if (app == null) {
        throw new RuntimeException("Unable to find application role mappings for app: " + entry.getKey());
      }
      manager.createScopeMappings(newRealm,app,entry.getValue());
    }
  }
  if (rep.getRoleMappings() != null) {
    for (    UserRoleMappingRepresentation mapping : rep.getRoleMappings()) {
      UserModel user=userMap.get(mapping.getUsername());
      for (      String roleString : mapping.getRoles()) {
        RoleModel role=newRealm.getRole(roleString.trim());
        if (role == null) {
          role=newRealm.addRole(roleString.trim());
        }
        newRealm.grantRole(user,role);
      }
    }
  }
  if (rep.getScopeMappings() != null) {
    for (    ScopeMappingRepresentation scope : rep.getScopeMappings()) {
      for (      String roleString : scope.getRoles()) {
        RoleModel role=newRealm.getRole(roleString.trim());
        if (role == null) {
          role=newRealm.addRole(roleString.trim());
        }
        UserModel user=userMap.get(scope.getUsername());
        newRealm.addScopeMapping(user,role.getName());
      }
    }
  }
  if (rep.getSocialMappings() != null) {
    for (    SocialMappingRepresentation socialMapping : rep.getSocialMappings()) {
      UserModel user=userMap.get(socialMapping.getUsername());
      for (      SocialLinkRepresentation link : socialMapping.getSocialLinks()) {
        SocialLinkModel mappingModel=new SocialLinkModel(link.getSocialProvider(),link.getSocialUsername());
        newRealm.addSocialLink(user,mappingModel);
      }
    }
  }
  if (rep.getSmtpServer() != null) {
    newRealm.setSmtpConfig(new HashMap(rep.getSmtpServer()));
  }
  if (rep.getSocialProviders() != null) {
    newRealm.setSocialConfig(new HashMap(rep.getSocialProviders()));
  }
}
