{
  String managementUrl=application.getManagementUrl();
  if (managementUrl != null) {
    SessionStatsAction adminAction=new SessionStatsAction(TokenIdGenerator.generateId(),(int)(System.currentTimeMillis() / 1000) + 30,application.getName());
    adminAction.setListUsers(users);
    String token=new TokenManager().encodeToken(realm,adminAction);
    logger.info("session stats for application: {0} url: {1}",application.getName(),managementUrl);
    Response response=client.target(managementUrl).path(AdapterConstants.K_GET_SESSION_STATS).request().post(Entity.text(token));
    if (response.getStatus() != 200) {
      logger.warn("Failed to get stats: " + response.getStatus());
      return null;
    }
    SessionStats stats=response.readEntity(SessionStats.class);
    if (users && stats.getUsers() != null) {
      Map<String,UserStats> newUsers=new HashMap<String,UserStats>();
      for (      Map.Entry<String,UserStats> entry : stats.getUsers().entrySet()) {
        UserModel user=realm.getUserById(entry.getKey());
        if (user == null)         continue;
        newUsers.put(user.getLoginName(),entry.getValue());
      }
      stats.setUsers(newUsers);
    }
    return stats;
  }
 else {
    logger.info("no management url.");
    return null;
  }
}
