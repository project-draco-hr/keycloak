{
  AccessTokenResponse res=new AccessTokenResponse();
  if (idToken != null) {
    String encodedToken=new JWSBuilder().jsonContent(idToken).rsa256(realm.getPrivateKey());
    res.setIdToken(encodedToken);
  }
  if (accessToken != null) {
    String encodedToken=new JWSBuilder().jsonContent(accessToken).rsa256(realm.getPrivateKey());
    res.setToken(encodedToken);
    res.setTokenType("bearer");
    if (accessToken.getExpiration() != 0) {
      long time=accessToken.getExpiration() - (System.currentTimeMillis() / 1000);
      res.setExpiresIn(time);
    }
  }
  if (refreshToken != null) {
    String encodedToken=new JWSBuilder().jsonContent(refreshToken).rsa256(realm.getPrivateKey());
    res.setRefreshToken(encodedToken);
  }
  res.setNotBeforePolicy(realm.getNotBefore());
  return res;
}
