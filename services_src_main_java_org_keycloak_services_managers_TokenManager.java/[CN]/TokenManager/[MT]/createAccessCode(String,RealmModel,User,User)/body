{
  SkeletonKeyToken token=null;
  if (scopeParam != null)   token=createScopedToken(scopeParam,realm,client,user);
 else   token=createUnscopedToken(realm,client,user);
  AccessCodeEntry code=new AccessCodeEntry();
  code.setExpiration((System.currentTimeMillis() / 1000) + realm.getAccessCodeLifespan());
  code.setToken(token);
  code.setClient(client);
  accessCodeMap.put(code.getId(),code);
  String accessCode=null;
  try {
    accessCode=new JWSBuilder().content(code.getId().getBytes("UTF-8")).rsa256(realm.getPrivateKey());
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
  return accessCode;
}
