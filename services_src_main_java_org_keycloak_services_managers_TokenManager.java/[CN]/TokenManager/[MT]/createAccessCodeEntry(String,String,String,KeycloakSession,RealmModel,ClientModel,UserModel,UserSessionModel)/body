{
  AccessCode code=new AccessCode();
  code.setId(UUID.randomUUID().toString() + System.currentTimeMillis());
  code.setClientId(client.getClientId());
  code.setUserId(user.getId());
  code.setTimestamp(Time.currentTime());
  code.setSessionState(session != null ? session.getId() : null);
  code.setRedirectUri(redirect);
  code.setState(state);
  Set<String> requestedRoles=new HashSet<String>();
  for (  RoleModel r : getAccess(scopeParam,client,user)) {
    requestedRoles.add(r.getId());
  }
  code.setRequestedRoles(requestedRoles);
  AccessCodeEntry entry=new AccessCodeEntry(keycloakSession,realm,code);
  return entry;
}
