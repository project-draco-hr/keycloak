{
  AccessToken token=new AccessToken();
  token.id(KeycloakModelUtils.generateId());
  token.issuedNow();
  token.subject(user.getId());
  token.audience(realm.getName());
  if (realm.getAccessTokenLifespan() > 0) {
    token.expiration((System.currentTimeMillis() / 1000) + realm.getAccessTokenLifespan());
  }
  for (  RoleModel role : realm.getRoleMappings(user)) {
    addComposites(token,role);
  }
  return token;
}
