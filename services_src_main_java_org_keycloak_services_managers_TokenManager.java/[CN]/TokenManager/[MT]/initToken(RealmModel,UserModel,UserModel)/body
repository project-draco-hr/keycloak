{
  SkeletonKeyToken token=new SkeletonKeyToken();
  token.id(RealmManager.generateId());
  token.principal(user.getLoginName());
  token.audience(realm.getName());
  token.issuedNow();
  token.issuedFor(client.getLoginName());
  if (realm.getTokenLifespan() > 0) {
    token.expiration((System.currentTimeMillis() / 1000) + realm.getTokenLifespan());
  }
  Set<String> allowedOrigins=client.getWebOrigins();
  if (allowedOrigins != null && allowedOrigins.size() > 0) {
    List<String> allowed=new ArrayList<String>();
    allowed.addAll(allowedOrigins);
    token.setAllowedOrigins(allowed);
  }
  return token;
}
