{
  NoSQLQuery query=NoSQLQueryBuilder.create(MongoDBQueryBuilder.class).andCondition("userId",user.getId()).build();
  PasswordData passwordData=noSQL.loadSingleObject(PasswordData.class,query);
  if (passwordData == null) {
    passwordData=new PasswordData();
  }
  String passwordSalt=generateSalt();
  passwordData.setSalt(passwordSalt);
  passwordData.setEncodedHash(this.passwordEncoder.encode(saltPassword(password,passwordSalt)));
  if (effectiveDate != null) {
    passwordData.setEffectiveDate(effectiveDate);
  }
  passwordData.setExpiryDate(expiryDate);
  passwordData.setUserId(user.getId());
  noSQL.saveObject(passwordData);
}
