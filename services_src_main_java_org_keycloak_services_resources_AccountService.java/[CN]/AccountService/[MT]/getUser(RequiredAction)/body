{
  if (uriInfo.getQueryParameters().containsKey(FormFlows.CODE)) {
    AccessCodeEntry accessCodeEntry=getAccessCodeEntry(uriInfo.getQueryParameters().getFirst(FormFlows.CODE));
    if (accessCodeEntry == null) {
      return null;
    }
    String loginName=accessCodeEntry.getUser().getLoginName();
    UserModel user=realm.getUser(loginName);
    if (!user.getRequiredActions().contains(action)) {
      return null;
    }
    if (!accessCodeEntry.getUser().getRequiredActions().contains(action)) {
      return null;
    }
    return user;
  }
 else {
    return getUserFromAuthManager();
  }
}
