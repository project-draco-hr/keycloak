{
  UserModel client=auth.getClient();
  if (realm.hasRole(client,realm.getRole(Constants.APPLICATION_ROLE))) {
    UserModel user=auth.getUser();
    if (hasRole(user,Constants.ACCOUNT_MANAGE_ROLE) || (role != null && hasRole(user,role))) {
      return true;
    }
  }
  AccessToken.Access access=auth.getToken().getResourceAccess(application.getName());
  if (access != null) {
    if (access.isUserInRole(Constants.ACCOUNT_MANAGE_ROLE) || (role != null && access.isUserInRole(role))) {
      return true;
    }
  }
  return false;
}
