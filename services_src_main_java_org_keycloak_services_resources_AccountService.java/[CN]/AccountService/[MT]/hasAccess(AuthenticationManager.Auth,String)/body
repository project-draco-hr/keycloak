{
  UserModel client=auth.getClient();
  if (realm.hasRole(client,Constants.APPLICATION_ROLE)) {
    if (hasRole(client,Constants.ACCOUNT_MANAGE_ROLE) || (role != null && hasRole(client,role))) {
      return true;
    }
  }
  SkeletonKeyToken.Access access=auth.getToken().getResourceAccess(application.getName());
  if (access != null) {
    if (access.isUserInRole(Constants.ACCOUNT_MANAGE_ROLE) || (role != null && access.isUserInRole(role))) {
      return true;
    }
  }
  return false;
}
