{
  if (uriInfo.getQueryParameters().containsKey("key")) {
    AccessCodeEntry accessCode=tokenManager.getAccessCode(uriInfo.getQueryParameters().getFirst("key"));
    if (accessCode == null || accessCode.isExpired() || !accessCode.getRequiredActions().contains(RequiredAction.UPDATE_PASSWORD)) {
      return Response.status(Status.FORBIDDEN).build();
    }
    return Flows.forms(realm,request,uriInfo).setAccessCode(accessCode).forwardToAction(RequiredAction.UPDATE_PASSWORD);
  }
 else {
    UserModel user=getUserFromAuthManager();
    if (user == null) {
      return Response.status(Status.FORBIDDEN).build();
    }
    return Flows.forms(realm,request,uriInfo).setUser(user).forwardToPassword();
  }
}
