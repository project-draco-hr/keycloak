{
  Auth auth=getAuth(true);
  require(auth,AccountRoles.MANAGE_ACCOUNT);
  UserModel user=auth.getUser();
  Account account=AccountLoader.load().createAccount(uriInfo).setRealm(realm).setUser(auth.getUser());
  String password=formData.getFirst("password");
  String passwordNew=formData.getFirst("password-new");
  String passwordConfirm=formData.getFirst("password-confirm");
  if (Validation.isEmpty(passwordNew)) {
    return account.setError(Messages.MISSING_PASSWORD).createResponse(AccountPages.PASSWORD);
  }
 else   if (!passwordNew.equals(passwordConfirm)) {
    return account.setError(Messages.INVALID_PASSWORD_CONFIRM).createResponse(AccountPages.PASSWORD);
  }
  AuthenticationProviderManager authProviderManager=AuthenticationProviderManager.getManager(realm);
  if (Validation.isEmpty(password)) {
    return account.setError(Messages.MISSING_PASSWORD).createResponse(AccountPages.PASSWORD);
  }
 else   if (authProviderManager.validatePassword(user.getLoginName(),password).getAuthProviderStatus() != AuthProviderStatus.SUCCESS) {
    return account.setError(Messages.INVALID_PASSWORD_EXISTING).createResponse(AccountPages.PASSWORD);
  }
  try {
    authProviderManager.updatePassword(user.getLoginName(),passwordNew);
  }
 catch (  AuthenticationProviderException ape) {
    return account.setError(ape.getMessage()).createResponse(AccountPages.PASSWORD);
  }
  audit.event(Events.UPDATE_PASSWORD).client(auth.getClient()).user(auth.getUser()).success();
  return account.setSuccess("accountPasswordUpdated").createResponse(AccountPages.PASSWORD);
}
