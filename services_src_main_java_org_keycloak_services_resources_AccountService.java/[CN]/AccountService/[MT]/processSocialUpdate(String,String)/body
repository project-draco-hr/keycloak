{
  if (auth == null) {
    return login("social");
  }
  require(AccountRoles.MANAGE_ACCOUNT);
  UserModel user=auth.getUser();
  if (Validation.isEmpty(providerId)) {
    return account.setError(Messages.MISSING_SOCIAL_PROVIDER).createResponse(AccountPages.SOCIAL);
  }
  AccountSocialAction accountSocialAction=AccountSocialAction.getAction(action);
  if (accountSocialAction == null) {
    return account.setError(Messages.INVALID_SOCIAL_ACTION).createResponse(AccountPages.SOCIAL);
  }
  SocialProvider provider=SocialLoader.load(providerId);
  if (provider == null) {
    return account.setError(Messages.SOCIAL_PROVIDER_NOT_FOUND).createResponse(AccountPages.SOCIAL);
  }
  if (!user.isEnabled()) {
    return account.setError(Messages.ACCOUNT_DISABLED).createResponse(AccountPages.SOCIAL);
  }
switch (accountSocialAction) {
case ADD:
    String redirectUri=UriBuilder.fromUri(Urls.accountSocialPage(uriInfo.getBaseUri(),realm.getName())).build().toString();
  try {
    return Flows.social(realm,uriInfo,provider).user(user).putClientAttribute(OAuth2Constants.CLIENT_ID,Constants.ACCOUNT_MANAGEMENT_APP).putClientAttribute(OAuth2Constants.STATE,UUID.randomUUID().toString()).putClientAttribute(OAuth2Constants.REDIRECT_URI,redirectUri).redirectToSocialProvider();
  }
 catch (  SocialProviderException spe) {
    return account.setError(Messages.SOCIAL_REDIRECT_ERROR).createResponse(AccountPages.SOCIAL);
  }
case REMOVE:
SocialLinkModel link=realm.getSocialLink(user,providerId);
if (link != null) {
if (realm.getSocialLinks(user).size() > 1 || user.getAuthenticationLink() != null) {
  realm.removeSocialLink(user,providerId);
  logger.debug("Social provider " + providerId + " removed successfully from user "+ user.getLoginName());
  audit.event(EventType.REMOVE_SOCIAL_LINK).client(auth.getClient()).user(auth.getUser()).detail(Details.USERNAME,link.getSocialUserId() + "@" + link.getSocialProvider()).success();
  return account.setSuccess(Messages.SOCIAL_PROVIDER_REMOVED).createResponse(AccountPages.SOCIAL);
}
 else {
  return account.setError(Messages.SOCIAL_REMOVING_LAST_PROVIDER).createResponse(AccountPages.SOCIAL);
}
}
 else {
return account.setError(Messages.SOCIAL_LINK_NOT_ACTIVE).createResponse(AccountPages.SOCIAL);
}
default :
logger.warn("Action is null!");
return null;
}
}
