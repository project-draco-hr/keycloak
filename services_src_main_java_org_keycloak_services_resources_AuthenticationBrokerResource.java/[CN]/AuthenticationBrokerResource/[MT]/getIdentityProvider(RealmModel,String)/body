{
  for (  IdentityProviderModel model : realm.getIdentityProviders()) {
    if (model.getId().equals(providerId)) {
      IdentityProviderFactory providerFactory=getIdentityProviderFactory(model);
      if (providerFactory == null) {
        throw new RuntimeException("Could not find provider factory for identity provider [" + providerId + "].");
      }
      return providerFactory.create(model);
    }
  }
  return null;
}
