{
  this.event.detail(Details.IDENTITY_PROVIDER,providerId);
  if (isDebugEnabled()) {
    LOGGER.debugf("Sending authentication request to identity provider [%s].",providerId);
  }
  try {
    ClientSessionCode clientSessionCode=parseClientSessionCode(code,providerId);
    IdentityProvider identityProvider=getIdentityProvider(providerId);
    AuthenticationResponse authenticationResponse=identityProvider.handleRequest(createAuthenticationRequest(providerId,clientSessionCode));
    Response response=authenticationResponse.getResponse();
    if (response != null) {
      this.event.success();
      if (isDebugEnabled()) {
        LOGGER.debugf("Identity provider [%s] is going to send a request [%s].",identityProvider,response);
      }
      return response;
    }
  }
 catch (  IdentityBrokerException e) {
    return redirectToErrorPage(Messages.COULD_NOT_SEND_AUTHENTICATION_REQUEST,e,providerId);
  }
catch (  Exception e) {
    return redirectToErrorPage(Messages.UNEXPECTED_ERROR_HANDLING_REQUEST,e,providerId);
  }
  return redirectToErrorPage(Messages.COULD_NOT_PROCEED_WITH_AUTHENTICATION_REQUEST);
}
