{
  this.factory=createSessionFactory();
  this.contextPath=context.getContextPath();
  KeycloakRegistry registry=new KeycloakRegistry();
  registry.putService(KeycloakSessionFactory.class,factory);
  context.setAttribute(KeycloakRegistry.class.getName(),registry);
  TokenManager tokenManager=new TokenManager();
  SocialRequestManager socialRequestManager=new SocialRequestManager();
  singletons.add(new RealmsResource(tokenManager,socialRequestManager));
  singletons.add(new AdminService(tokenManager));
  singletons.add(new SocialResource(tokenManager,socialRequestManager));
  classes.add(SkeletonKeyContextResolver.class);
  classes.add(QRCodeResource.class);
  classes.add(ThemeResource.class);
  setupDefaultRealm();
}
