{
  loadConfig();
  this.contextPath=context.getContextPath();
  this.sessionFactory=createSessionFactory();
  dispatcher.getDefaultContextObjects().put(KeycloakApplication.class,this);
  BruteForceProtector protector=new BruteForceProtector(sessionFactory);
  dispatcher.getDefaultContextObjects().put(BruteForceProtector.class,protector);
  ResteasyProviderFactory.pushContext(BruteForceProtector.class,protector);
  ResteasyProviderFactory.pushContext(KeycloakApplication.class,this);
  protector.start();
  context.setAttribute(BruteForceProtector.class.getName(),protector);
  context.setAttribute(KeycloakSessionFactory.class.getName(),this.sessionFactory);
  singletons.add(new ServerVersionResource());
  singletons.add(new RealmsResource());
  singletons.add(new AdminRoot());
  singletons.add(new ModelExceptionMapper());
  classes.add(SkeletonKeyContextResolver.class);
  classes.add(QRCodeResource.class);
  classes.add(ThemeResource.class);
  classes.add(JsResource.class);
  classes.add(WelcomeResource.class);
  setupDefaultRealm(context.getContextPath());
  migrateModel();
  new ExportImportManager().checkExportImport(this.sessionFactory,context.getContextPath());
  importRealms(context);
  AdminRecovery.recover(sessionFactory);
  setupScheduledTasks(sessionFactory);
}
