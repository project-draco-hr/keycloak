{
  dispatcher.getDefaultContextObjects().put(KeycloakApplication.class,this);
  this.contextPath=context.getContextPath();
  this.factory=createSessionFactory();
  BruteForceProtector protector=new BruteForceProtector(factory);
  dispatcher.getDefaultContextObjects().put(BruteForceProtector.class,protector);
  ResteasyProviderFactory.pushContext(BruteForceProtector.class,protector);
  protector.start();
  context.setAttribute(BruteForceProtector.class.getName(),protector);
  this.providerSessionFactory=createProviderSessionFactory();
  context.setAttribute(KeycloakSessionFactory.class.getName(),factory);
  context.setAttribute(ProviderSessionFactory.class.getName(),this.providerSessionFactory);
  TokenManager tokenManager=new TokenManager();
  SocialRequestManager socialRequestManager=new SocialRequestManager();
  singletons.add(new RealmsResource(tokenManager,socialRequestManager));
  singletons.add(new AdminService(tokenManager));
  singletons.add(new SocialResource(tokenManager,socialRequestManager));
  classes.add(SkeletonKeyContextResolver.class);
  classes.add(QRCodeResource.class);
  classes.add(AdminResource.class);
  classes.add(ThemeResource.class);
  classes.add(JsResource.class);
  classes.add(WelcomeResource.class);
  setupDefaultRealm(context.getContextPath());
  setupScheduledTasks(providerSessionFactory,factory);
}
