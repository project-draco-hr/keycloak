{
  ResourceLocalJpaIdentitySessionHandler handler=new ResourceLocalJpaIdentitySessionHandler("keycloak-identity-store");
  IdentityConfigurationBuilder builder=new IdentityConfigurationBuilder();
  builder.stores().jpa().identityClass(IdentityObject.class).attributeClass(IdentityObjectAttribute.class).relationshipClass(RelationshipObject.class).relationshipIdentityClass(RelationshipIdentityObject.class).relationshipAttributeClass(RelationshipObjectAttribute.class).credentialClass(CredentialObject.class).credentialAttributeClass(CredentialObjectAttribute.class).partitionClass(PartitionObject.class).supportAllFeatures().supportRelationshipType(RealmAdminRelationship.class,ResourceRelationship.class,RequiredCredentialRelationship.class,ScopeRelationship.class).setIdentitySessionHandler(handler);
  IdentityConfiguration build=builder.build();
  return new DefaultIdentitySessionFactory(build);
}
