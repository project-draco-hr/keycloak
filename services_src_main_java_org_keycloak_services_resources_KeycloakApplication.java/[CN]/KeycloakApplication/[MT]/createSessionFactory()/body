{
  ServiceLoader<ModelProvider> providers=ServiceLoader.load(ModelProvider.class);
  String configuredProvider=System.getProperty(MODEL_PROVIDER);
  ModelProvider provider=null;
  if (configuredProvider != null) {
    for (    ModelProvider p : providers) {
      if (p.getId().equals(configuredProvider)) {
        provider=p;
      }
    }
  }
 else {
    for (    ModelProvider p : providers) {
      if (provider == null) {
        provider=p;
      }
      if (p.getId().equals(DEFAULT_MODEL_PROVIDER)) {
        provider=p;
        break;
      }
    }
  }
  if (provider != null) {
    log.debug("Model provider: " + provider.getId());
    return provider.createFactory();
  }
  throw new RuntimeException("Model provider not found");
}
