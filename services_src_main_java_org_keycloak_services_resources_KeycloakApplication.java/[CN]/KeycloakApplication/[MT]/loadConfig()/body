{
  try {
    URL config=null;
    String configDir=System.getProperty("jboss.server.config.dir");
    if (configDir != null) {
      File f=new File(configDir + File.separator + "keycloak-server.json");
      if (f.isFile()) {
        config=f.toURI().toURL();
      }
    }
    if (config == null) {
      config=Thread.currentThread().getContextClassLoader().getResource("META-INF/keycloak-server.json");
    }
    if (config != null) {
      JsonNode node=new ObjectMapper().readTree(config);
      Properties properties=new Properties();
      properties.putAll(System.getProperties());
      for (      Map.Entry<String,String> e : System.getenv().entrySet()) {
        properties.put("env." + e.getKey(),e.getValue());
      }
      Config.init(new JsonConfigProvider(node,properties));
      log.info("Loaded config from " + config);
      return;
    }
 else {
      log.warn("Config 'keycloak-server.json' not found");
    }
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to load config",e);
  }
}
