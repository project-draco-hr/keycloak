{
  try {
    JsonNode node=null;
    String configDir=System.getProperty("jboss.server.config.dir");
    if (configDir != null) {
      File f=new File(configDir + File.separator + "keycloak-server.json");
      if (f.isFile()) {
        node=new ObjectMapper().readTree(f);
        log.info("Loaded config from " + f.getAbsolutePath());
      }
    }
    if (node == null) {
      URL resource=Thread.currentThread().getContextClassLoader().getResource("META-INF/keycloak-server.json");
      node=new ObjectMapper().readTree(resource);
      log.info("Loaded config from " + resource);
    }
    if (node != null) {
      Properties properties=new Properties();
      properties.putAll(System.getProperties());
      for (      Map.Entry<String,String> e : System.getenv().entrySet()) {
        properties.put("env." + e.getKey(),e.getValue());
      }
      Config.init(new JsonConfigProvider(node,properties));
      return;
    }
 else {
      log.warn("Config 'keycloak-server.json' not found");
    }
  }
 catch (  IOException e) {
    throw new RuntimeException("Failed to load config",e);
  }
}
