{
  RealmModel realm=init(name);
  ClientModel client=realm.getClientNameMap().get(Constants.IMPERSONATION_SERVICE_CLIENT_ID);
  if (client == null || !client.isEnabled()) {
    logger.debug("impersonate service not enabled");
    throw new NotFoundException("impersonate service not enabled");
  }
  EventBuilder event=new EventBuilder(realm,session,clientConnection);
  ImpersonationService impersonateService=new ImpersonationService(realm,client,event);
  ResteasyProviderFactory.getInstance().injectProperties(impersonateService);
  return impersonateService;
}
