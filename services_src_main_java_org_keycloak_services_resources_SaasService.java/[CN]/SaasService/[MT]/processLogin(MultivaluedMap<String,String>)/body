{
  logger.info("processLogin start");
  RealmManager realmManager=new RealmManager(session);
  RealmModel realm=getAdminstrationRealm(realmManager);
  if (realm == null)   throw new NotFoundException();
  ApplicationModel adminConsole=realm.getApplicationNameMap().get(Constants.ADMIN_CONSOLE_APPLICATION);
  UserModel adminConsoleUser=adminConsole.getApplicationUser();
  if (!realm.isEnabled()) {
    throw new NotImplementedYetException();
  }
  String username=formData.getFirst("username");
  UserModel user=realm.getUser(username);
  AuthenticationStatus status=authManager.authenticateForm(realm,user,formData);
  OAuthFlows oauth=Flows.oauth(realm,request,uriInfo,authManager,tokenManager);
switch (status) {
case SUCCESS:
    NewCookie cookie=authManager.createSaasIdentityCookie(realm,user,uriInfo);
  return Response.status(302).cookie(cookie).location(contextRoot(uriInfo).path(adminPath).build()).build();
case ACCOUNT_DISABLED:
return Flows.forms(realm,request,uriInfo).setError(Messages.ACCOUNT_DISABLED).setFormData(formData).forwardToLogin();
case ACTIONS_REQUIRED:
return oauth.processAccessCode(null,"n",contextRoot(uriInfo).path(adminPath).build().toString(),adminConsoleUser,user);
default :
return Flows.forms(realm,request,uriInfo).setError(Messages.INVALID_USER).setFormData(formData).forwardToLogin();
}
}
