{
  logger.info("processLogin start");
  return new Transaction(){
    @Override protected Response callImpl(){
      RealmManager realmManager=new RealmManager(session);
      RealmModel realm=realmManager.defaultRealm();
      if (realm == null)       throw new NotFoundException();
      if (!realm.isEnabled()) {
        throw new NotImplementedYetException();
      }
      String username=formData.getFirst("username");
      UserModel user=realm.getUser(username);
      if (user == null) {
        logger.info("Not Authenticated! Incorrect user name");
        request.setAttribute("KEYCLOAK_LOGIN_ERROR_MESSAGE","Incorrect user name.");
        forwardToLoginForm(realm);
        return null;
      }
      if (!user.isEnabled()) {
        logger.info("NAccount is disabled, contact admin.");
        request.setAttribute("KEYCLOAK_LOGIN_ERROR_MESSAGE","Account is disabled, contact admin.");
        forwardToLoginForm(realm);
        return null;
      }
      boolean authenticated=authManager.authenticateForm(realm,user,formData);
      if (!authenticated) {
        logger.info("Not Authenticated! Invalid credentials");
        request.setAttribute("KEYCLOAK_LOGIN_ERROR_MESSAGE","Invalid credentials.");
        forwardToLoginForm(realm);
        return null;
      }
      NewCookie cookie=authManager.createSaasIdentityCookie(realm,user,uriInfo);
      return Response.status(302).cookie(cookie).location(contextRoot(uriInfo).path(adminPath).build()).build();
    }
  }
.call();
}
