{
  if (!checkSsl()) {
    throw new NotAcceptableException("HTTPS required");
  }
  ClientModel client=authorizeClient(authorizationHeader,form);
  if (client.isPublicClient()) {
    throw new ForbiddenException("Public clients are not allowed to invoke grants/access");
  }
  if (form.getFirst(AuthenticationManager.FORM_USERNAME) == null) {
    throw new NotAuthorizedException("No username");
  }
  if (!realm.isEnabled()) {
    throw new NotAuthorizedException("Disabled realm");
  }
  if (authManager.authenticateForm(realm,form) != AuthenticationStatus.SUCCESS) {
    throw new NotAuthorizedException("Auth failed");
  }
  UserModel user=realm.getUser(form.getFirst(AuthenticationManager.FORM_USERNAME));
  String scope=form.getFirst(OAuth2Constants.SCOPE);
  AccessTokenResponse res=tokenManager.responseBuilder(realm,client).generateAccessToken(scope,client,user).generateIDToken().build();
  return Response.ok(res,MediaType.APPLICATION_JSON_TYPE).build();
}
