{
  audit.event(EventType.LOGOUT);
  if (redirectUri != null) {
    audit.detail(Details.REDIRECT_URI,redirectUri);
  }
  AuthenticationManager.AuthResult authResult=authManager.authenticateIdentityCookie(session,realm,uriInfo,clientConnection,headers,false);
  if (authResult != null) {
    logout(authResult.getSession());
  }
 else {
    audit.error(Errors.USER_NOT_LOGGED_IN);
    OAuthFlows oauth=Flows.oauth(session,realm,request,uriInfo,clientConnection,authManager,tokenManager);
    return oauth.forwardToSecurityFailure("Not logged in.");
  }
  if (redirectUri != null) {
    if (redirectUri.startsWith("/")) {
      UriBuilder builder=uriInfo.getAbsolutePathBuilder();
      builder.replacePath(redirectUri);
      return Response.status(302).location(builder.build()).build();
    }
    return Response.status(302).location(UriBuilder.fromUri(redirectUri).build()).build();
  }
 else {
    return Response.ok().build();
  }
}
