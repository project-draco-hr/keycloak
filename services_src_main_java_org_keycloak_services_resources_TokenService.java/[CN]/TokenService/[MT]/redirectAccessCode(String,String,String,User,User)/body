{
  String accessCode=tokenManager.createAccessCode(scopeParam,realm,client,user);
  UriBuilder redirectUri=UriBuilder.fromUri(redirect).queryParam("code",accessCode);
  if (state != null)   redirectUri.queryParam("state",state);
  Response.ResponseBuilder location=Response.status(302).location(redirectUri.build());
  if (realm.isCookieLoginAllowed()) {
    location.cookie(tokenManager.createLoginCookie(realm,user,uriInfo));
  }
  return location.build();
}
