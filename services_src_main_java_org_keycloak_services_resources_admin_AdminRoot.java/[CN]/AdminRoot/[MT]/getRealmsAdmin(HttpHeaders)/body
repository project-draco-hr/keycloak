{
  if (request.getHttpMethod().equalsIgnoreCase("OPTIONS")) {
    logger.debug("Cors admin pre-flight");
    Response response=Cors.add(request,Response.ok()).preflight().allowedMethods("GET","PUT","POST","DELETE").auth().build();
    throw new NoLogWebApplicationException(response);
  }
  AdminAuth auth=authenticateRealmAdminRequest(headers);
  if (auth != null) {
    logger.debug("authenticated admin access for: " + auth.getUser().getUsername());
  }
  Cors.add(request).allowedOrigins(auth.getToken()).allowedMethods("GET","PUT","POST","DELETE").auth().build(response);
  RealmsAdminResource adminResource=new RealmsAdminResource(auth,tokenManager);
  ResteasyProviderFactory.getInstance().injectProperties(adminResource);
  return adminResource;
}
