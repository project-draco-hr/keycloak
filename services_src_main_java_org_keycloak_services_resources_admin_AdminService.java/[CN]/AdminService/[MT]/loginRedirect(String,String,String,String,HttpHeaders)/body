{
  try {
    logger.info("loginRedirect ********************** <---");
    if (error != null) {
      logger.debug("error from oauth");
      return redirectOnLoginError(error);
    }
    RealmManager realmManager=new RealmManager(session);
    RealmModel adminRealm=getAdminstrationRealm(realmManager);
    if (!adminRealm.isEnabled()) {
      logger.debug("realm not enabled");
      return redirectOnLoginError("realm not enabled");
    }
    ApplicationModel adminConsole=adminRealm.getApplicationNameMap().get(Constants.ADMIN_CONSOLE_APPLICATION);
    if (!adminConsole.isEnabled()) {
      logger.debug("admin app not enabled");
      return redirectOnLoginError("admin app not enabled");
    }
    if (code == null) {
      logger.debug("code not specified");
      return redirectOnLoginError("invalid login data");
    }
    if (state == null) {
      logger.debug("state not specified");
      return redirectOnLoginError("invalid login data");
    }
    new OAuthRedirect().checkStateCookie(uriInfo,headers);
    logger.debug("loginRedirect SUCCESS");
    NewCookie cookie=authManager.createCookie(adminRealm,adminConsole,code,AdminService.saasCookiePath(uriInfo).build());
    URI redirectUri=UriBuilder.fromUri(uriInfo.getBaseUri()).path("../").path(adminPath).build();
    if (path != null) {
      redirectUri=redirectUri.resolve("#" + UriBuilder.fromPath(path).build().toString());
    }
    return Response.status(302).cookie(cookie).location(redirectUri).build();
  }
  finally {
    expireCookie();
  }
}
