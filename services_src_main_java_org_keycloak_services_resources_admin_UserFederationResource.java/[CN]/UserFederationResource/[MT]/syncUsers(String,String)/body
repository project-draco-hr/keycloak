{
  logger.debug("Syncing users");
  auth.requireManage();
  for (  UserFederationProviderModel model : realm.getUserFederationProviders()) {
    if (model.getId().equals(providerId)) {
      UsersSyncManager syncManager=new UsersSyncManager();
      UserFederationSyncResult syncResult=null;
      if ("triggerFullSync".equals(action)) {
        syncResult=syncManager.syncAllUsers(session.getKeycloakSessionFactory(),realm.getId(),model);
      }
 else       if ("triggerChangedUsersSync".equals(action)) {
        syncResult=syncManager.syncChangedUsers(session.getKeycloakSessionFactory(),realm.getId(),model);
      }
      adminEvent.operation(OperationType.ACTION).resourcePath(uriInfo).success();
      return syncResult;
    }
  }
  throw new NotFoundException("could not find provider");
}
