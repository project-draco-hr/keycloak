{
  auth.requireManage();
  UserModel user=session.users().getUserByUsername(username,realm);
  if (user == null) {
    throw new NotFoundException("User not found");
  }
  ApplicationModel application=realm.getApplicationByName(appName);
  if (application == null) {
    throw new NotFoundException("Application not found");
  }
  if (roles == null) {
    Set<RoleModel> roleModels=user.getApplicationRoleMappings(application);
    for (    RoleModel roleModel : roleModels) {
      if (!(roleModel.getContainer() instanceof ApplicationModel)) {
        ApplicationModel app=(ApplicationModel)roleModel.getContainer();
        if (!app.getId().equals(application.getId()))         continue;
      }
      user.deleteRoleMapping(roleModel);
    }
  }
 else {
    for (    RoleRepresentation role : roles) {
      RoleModel roleModel=application.getRole(role.getName());
      if (roleModel == null || !roleModel.getId().equals(role.getId())) {
        throw new NotFoundException("Role not found");
      }
      user.deleteRoleMapping(roleModel);
    }
  }
}
