{
  auth.requireView();
  UserModel user=session.users().getUserByUsername(username,realm);
  if (user == null) {
    throw new NotFoundException("User not found");
  }
  Set<FederatedIdentityModel> identities=session.users().getFederatedIdentities(user,realm);
  List<FederatedIdentityRepresentation> result=new ArrayList<FederatedIdentityRepresentation>();
  for (  FederatedIdentityModel identity : identities) {
    for (    IdentityProviderModel identityProviderModel : realm.getIdentityProviders()) {
      if (identityProviderModel.getProviderId().equals(identity.getIdentityProvider())) {
        FederatedIdentityRepresentation rep=ModelToRepresentation.toRepresentation(identity);
        rep.setIdentityProvider(identityProviderModel.getName());
        result.add(rep);
      }
    }
  }
  return result;
}
