{
  RealmManager manager=new RealmManager(session);
  List<UserRepresentation> results=new ArrayList<UserRepresentation>();
  List<UserModel> userModels;
  if (search != null) {
    userModels=manager.searchUsers(search,realm);
  }
 else   if (last != null || first != null || email != null || username != null) {
    Map<String,String> attributes=new HashMap<String,String>();
    if (last != null) {
      attributes.put(UserModel.LAST_NAME,last);
    }
    if (first != null) {
      attributes.put(UserModel.FIRST_NAME,first);
    }
    if (email != null) {
      attributes.put(UserModel.EMAIL,email);
    }
    if (username != null) {
      attributes.put(UserModel.LOGIN_NAME,username);
    }
    userModels=realm.searchForUserByAttributes(attributes);
    for (    UserModel user : userModels) {
      results.add(manager.toRepresentation(user));
    }
  }
 else {
    userModels=realm.getUsers();
  }
  for (  UserModel user : userModels) {
    if (isUser(user)) {
      results.add(manager.toRepresentation(user));
    }
  }
  return results;
}
