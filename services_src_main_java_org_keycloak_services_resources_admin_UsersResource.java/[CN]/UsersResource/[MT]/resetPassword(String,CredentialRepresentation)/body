{
  auth.requireManage();
  UserModel user=session.users().getUserByUsername(username,realm);
  if (user == null) {
    throw new NotFoundException("User not found");
  }
  if (pass == null || pass.getValue() == null || !CredentialRepresentation.PASSWORD.equals(pass.getType())) {
    throw new BadRequestException("No password provided");
  }
  UserCredentialModel cred=RepresentationToModel.convertCredential(pass);
  try {
    session.users().updateCredential(realm,user,cred);
  }
 catch (  IllegalStateException ise) {
    throw new BadRequestException("Resetting to N old passwords is not allowed.");
  }
catch (  ModelReadOnlyException mre) {
    throw new BadRequestException("Can't reset password as account is read only");
  }
  if (pass.isTemporary())   user.addRequiredAction(UserModel.RequiredAction.UPDATE_PASSWORD);
  adminEvent.operation(OperationType.ACTION).resourcePath(user,uriInfo.getPath()).success();
}
