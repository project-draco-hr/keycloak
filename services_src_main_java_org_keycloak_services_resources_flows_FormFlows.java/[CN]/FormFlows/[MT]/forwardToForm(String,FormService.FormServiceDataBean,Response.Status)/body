{
  ResteasyUriInfo uriInfo=request.getUri();
  MultivaluedMap<String,String> queryParameterMap=uriInfo.getQueryParameters();
  String requestURI=uriInfo.getBaseUri().getPath();
  UriBuilder uriBuilder=UriBuilder.fromUri(requestURI);
  for (  String k : queryParameterMap.keySet()) {
    uriBuilder.replaceQueryParam(k,queryParameterMap.get(k).toArray());
  }
  if (accessCode != null) {
    uriBuilder.queryParam(CODE,accessCode.getCode());
  }
  if (queryParams != null) {
    for (    Map.Entry<String,String> q : queryParams.entrySet()) {
      uriBuilder.replaceQueryParam(q.getKey(),q.getValue());
    }
  }
  URI baseURI=uriBuilder.build();
  formDataBean.setBaseURI(baseURI);
  formDataBean.setContextPath(requestURI.substring(0,requestURI.length() - 6));
  formDataBean.setSocialRegistration(socialRegistration);
  Iterator<FormService> itr=ServiceRegistry.lookupProviders(FormService.class);
  while (itr.hasNext()) {
    FormService provider=itr.next();
    if (provider.getId().equals("FormServiceId"))     return Response.status(status).type(MediaType.TEXT_HTML).entity(provider.process(template,formDataBean)).build();
  }
  return Response.status(status).entity("form provider not found").build();
}
