{
  if (Constants.INSTALLED_APP_URN.equals(redirect)) {
    return Flows.forms(providerSession,realm,uriInfo).setError(error).createCode();
  }
 else {
    UriBuilder redirectUri=UriBuilder.fromUri(redirect).queryParam(OAuth2Constants.ERROR,error);
    if (state != null) {
      redirectUri.queryParam(OAuth2Constants.STATE,state);
    }
    return Response.status(302).location(redirectUri.build()).build();
  }
}
