{
  KeycloakSession session=sessionFactory.create();
  try {
    session.getTransaction().begin();
    task.run(session);
    session.getTransaction().commit();
    logger.debug("Executed scheduled task " + task.getClass().getSimpleName());
  }
 catch (  Throwable t) {
    logger.error("Failed to run scheduled task " + task.getClass().getSimpleName(),t);
    session.getTransaction().rollback();
  }
 finally {
    try {
      session.close();
    }
 catch (    Throwable t) {
      logger.error("Failed to close ProviderSession",t);
    }
  }
}
