{
  User user=defaultRealm.getIdm().getUser(newUser.getUsername());
  if (user != null) {
    return Response.status(400).type("text/plain").entity("user exists").build();
  }
  user=new SimpleUser(newUser.getUsername());
  defaultRealm.getIdm().add(user);
  for (  UserRepresentation.Credential cred : newUser.getCredentials()) {
    UserCredentialModel credModel=new UserCredentialModel();
    credModel.setType(cred.getType());
    credModel.setValue(cred.getValue());
    defaultRealm.updateCredential(user,credModel);
  }
  URI uri=uriInfo.getBaseUriBuilder().path(RealmFactory.class).path(user.getLoginName()).build();
  return Response.created(uri).build();
}
