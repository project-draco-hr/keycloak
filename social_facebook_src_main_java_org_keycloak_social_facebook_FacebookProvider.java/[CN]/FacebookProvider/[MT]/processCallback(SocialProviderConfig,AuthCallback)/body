{
  String code=callback.getQueryParam(DEFAULT_RESPONSE_TYPE);
  try {
    if (!callback.getQueryParam("state").equals(callback.getAttribute("state"))) {
      throw new SocialProviderException("Invalid state");
    }
    ResteasyClient client=new ResteasyClientBuilder().hostnameVerification(ResteasyClientBuilder.HostnameVerificationPolicy.ANY).build();
    String accessToken=loadAccessToken(code,config,client);
    FacebookUser facebookUser=loadUser(accessToken,client);
    SocialUser socialUser=new SocialUser(facebookUser.getId());
    socialUser.setEmail(facebookUser.getEmail());
    socialUser.setLastName(facebookUser.getLastName());
    socialUser.setFirstName(facebookUser.getFirstName());
    return socialUser;
  }
 catch (  SocialProviderException spe) {
    throw spe;
  }
catch (  Exception e) {
    throw new SocialProviderException(e);
  }
}
