{
  try {
    JsonNode profile=SimpleHttp.doGet(PROFILE_URL).header("Authorization","Bearer " + accessToken).asJson();
    BrokeredIdentityContext user=new BrokeredIdentityContext(getJsonProperty(profile,"id"));
    user.setUsername(getJsonProperty(profile,"login"));
    user.setName(getJsonProperty(profile,"name"));
    user.setEmail(getJsonProperty(profile,"email"));
    user.setIdpConfig(getConfig());
    user.setIdp(this);
    return user;
  }
 catch (  Exception e) {
    throw new IdentityBrokerException("Could not obtain user profile from github.",e);
  }
}
