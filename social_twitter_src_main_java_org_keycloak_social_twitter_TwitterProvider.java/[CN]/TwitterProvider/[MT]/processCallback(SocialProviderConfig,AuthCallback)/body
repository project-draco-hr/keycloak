{
  try {
    Twitter twitter=new TwitterFactory().getInstance();
    twitter.setOAuthConsumer(config.getKey(),config.getSecret());
    String verifier=callback.getQueryParam("oauth_verifier");
    RequestToken requestToken=new RequestToken((String)callback.getAttribute("token"),(String)callback.getAttribute("tokenSecret"));
    twitter.getOAuthAccessToken(requestToken,verifier);
    twitter4j.User twitterUser=twitter.verifyCredentials();
    SocialUser user=new SocialUser(Long.toString(twitterUser.getId()));
    user.setUsername(twitterUser.getScreenName());
    String twitterName=twitterUser.getName();
    int spaceIndex=twitterName.lastIndexOf(' ');
    if (spaceIndex != -1) {
      user.setFirstName(twitterName.substring(0,spaceIndex));
      user.setLastName(twitterName.substring(spaceIndex + 1));
    }
 else {
      user.setFirstName(twitterName);
    }
    return user;
  }
 catch (  Exception e) {
    throw new SocialProviderException(e);
  }
}
