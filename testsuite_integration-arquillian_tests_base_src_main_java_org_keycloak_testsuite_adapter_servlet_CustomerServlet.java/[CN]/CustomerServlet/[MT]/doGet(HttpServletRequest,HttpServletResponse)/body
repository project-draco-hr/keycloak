{
  PrintWriter pw=resp.getWriter();
  if (req.getRequestURI().endsWith("logout")) {
    resp.setStatus(200);
    pw.println("servlet logout ok");
    req.logout();
    pw.flush();
    return;
  }
  KeycloakSecurityContext context=(KeycloakSecurityContext)req.getAttribute(KeycloakSecurityContext.class.getName());
  Client client=ClientBuilder.newClient();
  try {
    String appBase=System.getProperty("app.server.base.url","http://localhost:8280");
    WebTarget target=client.target(appBase + "/customer-db/");
    Response response=target.request().get();
    if (response.getStatus() != 401) {
      throw new AssertionError("Response status code is not 401.");
    }
    response.close();
    String html=target.request().header(HttpHeaders.AUTHORIZATION,"Bearer " + context.getTokenString()).get(String.class);
    resp.setContentType("text/html");
    pw.println(html);
    pw.flush();
  }
  finally {
    client.close();
  }
}
