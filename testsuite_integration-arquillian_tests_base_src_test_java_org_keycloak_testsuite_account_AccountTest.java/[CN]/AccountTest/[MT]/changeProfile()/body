{
  setEditUsernameAllowed(false);
  profilePage.open();
  loginPage.login("test-user@localhost","password");
  events.expectLogin().client("account").detail(Details.REDIRECT_URI,ACCOUNT_REDIRECT).assertEvent();
  Assert.assertEquals("test-user@localhost",profilePage.getUsername());
  Assert.assertEquals("Tom",profilePage.getFirstName());
  Assert.assertEquals("Brady",profilePage.getLastName());
  Assert.assertEquals("test-user@localhost",profilePage.getEmail());
  profilePage.updateProfile("","New last","new@email.com");
  Assert.assertEquals("Please specify first name.",profilePage.getError());
  Assert.assertEquals("test-user@localhost",profilePage.getUsername());
  Assert.assertEquals("",profilePage.getFirstName());
  Assert.assertEquals("New last",profilePage.getLastName());
  Assert.assertEquals("new@email.com",profilePage.getEmail());
  events.assertEmpty();
  profilePage.updateProfile("New first","","new@email.com");
  Assert.assertEquals("Please specify last name.",profilePage.getError());
  Assert.assertEquals("New first",profilePage.getFirstName());
  Assert.assertEquals("",profilePage.getLastName());
  Assert.assertEquals("new@email.com",profilePage.getEmail());
  events.assertEmpty();
  profilePage.updateProfile("New first","New last","");
  Assert.assertEquals("Please specify email.",profilePage.getError());
  Assert.assertEquals("New first",profilePage.getFirstName());
  Assert.assertEquals("New last",profilePage.getLastName());
  Assert.assertEquals("",profilePage.getEmail());
  events.assertEmpty();
  profilePage.clickCancel();
  Assert.assertEquals("test-user@localhost",profilePage.getUsername());
  Assert.assertEquals("Tom",profilePage.getFirstName());
  Assert.assertEquals("Brady",profilePage.getLastName());
  Assert.assertEquals("test-user@localhost",profilePage.getEmail());
  events.assertEmpty();
  profilePage.updateProfile("New first","New last","new@email.com");
  Assert.assertEquals("Your account has been updated.",profilePage.getSuccess());
  Assert.assertEquals("test-user@localhost",profilePage.getUsername());
  Assert.assertEquals("New first",profilePage.getFirstName());
  Assert.assertEquals("New last",profilePage.getLastName());
  Assert.assertEquals("new@email.com",profilePage.getEmail());
  events.expectAccount(EventType.UPDATE_PROFILE).assertEvent();
  events.expectAccount(EventType.UPDATE_EMAIL).detail(Details.PREVIOUS_EMAIL,"test-user@localhost").detail(Details.UPDATED_EMAIL,"new@email.com").assertEvent();
  profilePage.updateProfile("Tom","Brady","test-user@localhost");
  events.clear();
  setEditUsernameAllowed(true);
}
