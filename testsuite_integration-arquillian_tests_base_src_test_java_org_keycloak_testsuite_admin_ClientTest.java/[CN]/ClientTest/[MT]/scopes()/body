{
  Response response=realm.clients().create(ClientBuilder.create().clientId("client").fullScopeEnabled(false).build());
  String id=ApiUtil.getCreatedId(response);
  response.close();
  assertAdminEvents.poll();
  RoleMappingResource scopesResource=realm.clients().get(id).getScopeMappings();
  RoleRepresentation roleRep1=RoleBuilder.create().name("role1").build();
  RoleRepresentation roleRep2=RoleBuilder.create().name("role2").build();
  realm.roles().create(roleRep1);
  realm.roles().create(roleRep2);
  assertAdminEvents.assertEvent(realmId,OperationType.CREATE,AdminEventPaths.roleResourcePath("role1"),roleRep1,ResourceType.CLIENT_ROLE);
  assertAdminEvents.assertEvent(realmId,OperationType.CREATE,AdminEventPaths.roleResourcePath("role2"),roleRep2,ResourceType.CLIENT_ROLE);
  roleRep1=realm.roles().get("role1").toRepresentation();
  roleRep2=realm.roles().get("role2").toRepresentation();
  realm.roles().get("role1").addComposites(Collections.singletonList(roleRep2));
  assertAdminEvents.assertEvent(realmId,OperationType.CREATE,AdminEventPaths.roleResourceCompositesPath("role1"),Collections.singletonList(roleRep2),ResourceType.REALM_ROLE);
  String accountMgmtId=realm.clients().findByClientId(Constants.ACCOUNT_MANAGEMENT_CLIENT_ID).get(0).getId();
  RoleRepresentation viewAccountRoleRep=realm.clients().get(accountMgmtId).roles().get(AccountRoles.VIEW_PROFILE).toRepresentation();
  scopesResource.realmLevel().add(Collections.singletonList(roleRep1));
  assertAdminEvents.assertEvent(realmId,OperationType.CREATE,AdminEventPaths.clientScopeMappingsRealmLevelPath(id),Collections.singletonList(roleRep1),ResourceType.REALM_SCOPE_MAPPING);
  scopesResource.clientLevel(accountMgmtId).add(Collections.singletonList(viewAccountRoleRep));
  assertAdminEvents.assertEvent(realmId,OperationType.CREATE,AdminEventPaths.clientScopeMappingsClientLevelPath(id,accountMgmtId),Collections.singletonList(viewAccountRoleRep),ResourceType.CLIENT_SCOPE_MAPPING);
  Assert.assertNames(scopesResource.realmLevel().listAll(),"role1");
  Assert.assertNames(scopesResource.realmLevel().listEffective(),"role1","role2");
  Assert.assertNames(scopesResource.realmLevel().listAvailable(),"offline_access",Constants.AUTHZ_UMA_AUTHORIZATION);
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listAll(),AccountRoles.VIEW_PROFILE);
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listEffective(),AccountRoles.VIEW_PROFILE);
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listAvailable(),AccountRoles.MANAGE_ACCOUNT);
  Assert.assertNames(scopesResource.getAll().getRealmMappings(),"role1");
  Assert.assertNames(scopesResource.getAll().getClientMappings().get(Constants.ACCOUNT_MANAGEMENT_CLIENT_ID).getMappings(),AccountRoles.VIEW_PROFILE);
  scopesResource.realmLevel().remove(Collections.singletonList(roleRep1));
  assertAdminEvents.assertEvent(realmId,OperationType.DELETE,AdminEventPaths.clientScopeMappingsRealmLevelPath(id),Collections.singletonList(roleRep1),ResourceType.REALM_SCOPE_MAPPING);
  scopesResource.clientLevel(accountMgmtId).remove(Collections.singletonList(viewAccountRoleRep));
  assertAdminEvents.assertEvent(realmId,OperationType.DELETE,AdminEventPaths.clientScopeMappingsClientLevelPath(id,accountMgmtId),Collections.singletonList(viewAccountRoleRep),ResourceType.CLIENT_SCOPE_MAPPING);
  Assert.assertNames(scopesResource.realmLevel().listAll());
  Assert.assertNames(scopesResource.realmLevel().listEffective());
  Assert.assertNames(scopesResource.realmLevel().listAvailable(),"offline_access",Constants.AUTHZ_UMA_AUTHORIZATION,"role1","role2");
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listAll());
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listAvailable(),AccountRoles.VIEW_PROFILE,AccountRoles.MANAGE_ACCOUNT);
  Assert.assertNames(scopesResource.clientLevel(accountMgmtId).listEffective());
}
