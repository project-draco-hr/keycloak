{
  RoleRepresentation roleRep1=new RoleRepresentation();
  roleRep1.setName("role1");
  testRealmResource().roles().create(roleRep1);
  roleRep1=testRealmResource().roles().get("role1").toRepresentation();
  RoleRepresentation roleRep2=roleRep2=new RoleRepresentation();
  roleRep2.setName("role2");
  testRealmResource().roles().create(roleRep2);
  roleRep2=testRealmResource().roles().get("role2").toRepresentation();
  testRealmResource().roles().get("role1").addChildren(Collections.singletonList(roleRep2));
  ClientTemplateRepresentation templateRep=new ClientTemplateRepresentation();
  templateRep.setName("bar-template");
  templateRep.setFullScopeAllowed(false);
  String templateId=createTemplate(templateRep);
  String accountMgmtId=testRealmResource().clients().findByClientId(Constants.ACCOUNT_MANAGEMENT_CLIENT_ID).get(0).getId();
  RoleRepresentation viewAccountRoleRep=testRealmResource().clients().get(accountMgmtId).roles().get(AccountRoles.VIEW_PROFILE).toRepresentation();
  RoleMappingResource scopesResource=clientTemplates().get(templateId).getScopeMappings();
  scopesResource.realmLevel().add(Collections.singletonList(roleRep1));
  scopesResource.clientLevel(accountMgmtId).add(Collections.singletonList(viewAccountRoleRep));
  List<RoleRepresentation> allRealm=scopesResource.realmLevel().listAll();
  List<RoleRepresentation> availableRealm=scopesResource.realmLevel().listAvailable();
  List<RoleRepresentation> effectiveRealm=scopesResource.realmLevel().listEffective();
  List<RoleRepresentation> accountRoles=scopesResource.clientLevel(accountMgmtId).listAll();
  assertRolesPresent(allRealm,"role1");
  assertRolesNotPresent(availableRealm,"role1","role2");
  assertRolesPresent(effectiveRealm,"role1","role2");
  assertRolesPresent(accountRoles,AccountRoles.VIEW_PROFILE);
  MappingsRepresentation mappingsRep=clientTemplates().get(templateId).getScopeMappings().getAll();
  assertRolesPresent(mappingsRep.getRealmMappings(),"role1");
  assertRolesPresent(mappingsRep.getClientMappings().get(Constants.ACCOUNT_MANAGEMENT_CLIENT_ID).getMappings(),AccountRoles.VIEW_PROFILE);
  scopesResource.realmLevel().remove(Collections.singletonList(roleRep1));
  scopesResource.clientLevel(accountMgmtId).remove(Collections.singletonList(viewAccountRoleRep));
  allRealm=scopesResource.realmLevel().listAll();
  availableRealm=scopesResource.realmLevel().listAvailable();
  effectiveRealm=scopesResource.realmLevel().listEffective();
  accountRoles=scopesResource.clientLevel(accountMgmtId).listAll();
  assertRolesNotPresent(allRealm,"role1");
  assertRolesPresent(availableRealm,"role1","role2");
  assertRolesNotPresent(effectiveRealm,"role1","role2");
  assertRolesNotPresent(accountRoles,AccountRoles.VIEW_PROFILE);
  clientTemplates().get(templateId).remove();
}
