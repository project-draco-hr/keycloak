{
  oauthClient.doLogin("test-user@localhost","password");
  String code=oauthClient.getCurrentQuery().get(OAuth2Constants.CODE);
  EventRepresentation loginEvent=events.expectLogin().assertEvent();
  AccessTokenResponse accessTokenResponse=oauthClient.doAccessTokenRequest(code,"password");
  String tokenResponse=oauthClient.introspectAccessTokenWithClientCredential("confidential-cli","secret1",accessTokenResponse.getAccessToken());
  TokenMetadataRepresentation rep=JsonSerialization.readValue(tokenResponse,TokenMetadataRepresentation.class);
  assertTrue(rep.isActive());
  assertEquals("test-user@localhost",rep.getUserName());
  assertEquals("test-app",rep.getClientId());
  assertEquals(loginEvent.getUserId(),rep.getSubject());
  events.clear();
}
