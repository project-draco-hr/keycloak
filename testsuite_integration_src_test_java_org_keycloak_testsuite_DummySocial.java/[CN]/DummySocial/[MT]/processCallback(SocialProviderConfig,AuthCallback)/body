{
  String error=callback.getQueryParam(OAuth2Constants.ERROR);
  if (error != null) {
    throw new SocialAccessDeniedException();
  }
  if (!callback.getQueryParam(OAuth2Constants.STATE).equals(callback.getAttribute(OAuth2Constants.STATE))) {
    throw new SocialProviderException("Invalid state");
  }
  String id=callback.getQueryParam("id");
  String username=callback.getQueryParam("username");
  SocialUser user=new SocialUser(id,username);
  user.setName(callback.getQueryParam("firstname"),callback.getQueryParam("lastname"));
  user.setEmail(callback.getQueryParam("email"));
  return user;
}
