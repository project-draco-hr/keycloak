{
  log.info("Starting infinispan CLI. Exit with 'exit'");
  BufferedReader reader=new BufferedReader(new InputStreamReader(System.in));
  String line;
  try {
    while ((line=reader.readLine()) != null) {
      log.info("Command: " + line);
      if (line.equals("exit")) {
        return;
      }
      final String finalLine=line;
      KeycloakModelUtils.runJobInTransaction(sessionFactory,new KeycloakSessionTask(){
        @Override public void run(        KeycloakSession session){
          InfinispanConnectionProvider provider=session.getProvider(InfinispanConnectionProvider.class);
          Cache<String,SessionEntity> ispnCache=provider.getCache(InfinispanConnectionProvider.OFFLINE_SESSION_CACHE_NAME);
          runTask(finalLine,ispnCache);
        }
      }
);
    }
  }
  finally {
    log.info("Exit infinispan CLI");
    reader.close();
  }
}
