{
  HttpClient client=new DefaultHttpClient();
  HttpPost post=new HttpPost(getAccessTokenUrl());
  List<NameValuePair> parameters=new LinkedList<NameValuePair>();
  if (grantType != null) {
    parameters.add(new BasicNameValuePair("grant_type",grantType));
  }
  if (code != null) {
    parameters.add(new BasicNameValuePair("code",code));
  }
  if (redirectUri != null) {
    parameters.add(new BasicNameValuePair("redirect_uri",redirectUri));
  }
  if (clientId != null && password != null) {
    String authorization=BasicAuthHelper.createHeader(clientId,password);
    post.setHeader("Authorization",authorization);
  }
 else   if (clientId != null) {
    parameters.add(new BasicNameValuePair("client_id",clientId));
  }
  UrlEncodedFormEntity formEntity=null;
  try {
    formEntity=new UrlEncodedFormEntity(parameters,"UTF-8");
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
  post.setEntity(formEntity);
  try {
    return new AccessTokenResponse(client.execute(post));
  }
 catch (  Exception e) {
    throw new RuntimeException("Failed to retrieve access token",e);
  }
}
