{
  PrintWriter pw=resp.getWriter();
  if (req.getParameterValues("error") != null) {
    pw.print("<html><head><title></title></head><body>Access rights not granted.</body></html>");
  }
 else   if (req.getParameterValues("code") != null) {
    String token=client.getBearerToken(req);
    pw.print("<html><head><title></title></head><body>Access rights granted.<br/>Token:" + token + "<br/>");
    try {
      PublicKey realmKey=PemUtils.decodePublicKey(realmKeyPem);
      SkeletonKeyToken skeletonToken=RSATokenVerifier.verifyToken(token,realmKey,realm);
      pw.print("Role:");
      for (      String role : skeletonToken.getRealmAccess().getRoles()) {
        pw.print(role);
      }
      pw.print(".<br/>");
      for (      Map.Entry<String,SkeletonKeyToken.Access> entry : skeletonToken.getResourceAccess().entrySet()) {
        pw.print("App:" + entry.getKey() + ";");
        for (        String role : entry.getValue().getRoles()) {
          pw.print(role);
        }
      }
      pw.print(".<br/>");
    }
 catch (    Exception e) {
    }
    pw.print("</body></html>");
  }
 else {
    client.redirectRelative("",req,resp);
  }
  pw.flush();
}
