{
  try {
    keycloakRule.configure(new KeycloakRule.KeycloakSetup(){
      @Override public void config(      RealmManager manager,      RealmModel adminstrationRealm,      RealmModel appRealm){
        ApplicationModel app=appRealm.getApplicationNameMap().get(org.keycloak.models.Constants.ACCOUNT_APPLICATION);
        defaultRoles=app.getDefaultRoles();
        app.updateDefaultRoles(new String[0]);
      }
    }
);
    oauth.doLogin("test-user@localhost","password");
    String code=oauth.getCurrentQuery().get("code");
    String token=oauth.doAccessTokenRequest(code,"password").getAccessToken();
    HttpResponse response=doGetProfile(token,null);
    assertEquals(403,response.getStatusLine().getStatusCode());
  }
  finally {
    keycloakRule.configure(new KeycloakRule.KeycloakSetup(){
      @Override public void config(      RealmManager manager,      RealmModel adminstrationRealm,      RealmModel appRealm){
        appRealm.getApplicationNameMap().get(org.keycloak.models.Constants.ACCOUNT_APPLICATION).updateDefaultRoles((String[])defaultRoles.toArray(new String[0]));
      }
    }
);
  }
}
