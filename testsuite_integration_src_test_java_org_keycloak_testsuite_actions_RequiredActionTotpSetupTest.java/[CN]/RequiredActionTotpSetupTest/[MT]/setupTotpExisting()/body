{
  loginPage.open();
  loginPage.login("test-user@localhost","password");
  totpPage.assertCurrent();
  String totpSecret=totpPage.getTotpSecret();
  totpPage.configure(totp.generate(totpSecret));
  events.expectRequiredAction("update_totp").assertEvent();
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  events.expectLogin().assertEvent();
  oauth.openLogout();
  events.expectLogout().assertEvent();
  loginPage.open();
  loginPage.login("test-user@localhost","password");
  loginTotpPage.login(totp.generate(totpSecret));
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  events.expectLogin().assertEvent();
}
