{
  loginPage.open();
  loginPage.login("test-user@localhost","password");
  updateProfilePage.assertCurrent();
  updateProfilePage.update("New first","New last","new@email.com");
  events.expectRequiredAction("update_profile").assertEvent();
  events.expectRequiredAction("update_email").detail(Details.PREVIOUS_EMAIL,"test-user@localhost").detail(Details.UPDATED_EMAIL,"new@email.com").assertEvent();
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  events.expectLogin().assertEvent();
}
