{
  ProviderSession providerSession=keycloakRule.startSession();
  try {
    RealmManager manager=new RealmManager(providerSession.getProvider(KeycloakSession.class));
    RealmModel adminRealm=manager.getRealm(Config.getAdminRealm());
    ApplicationModel adminConsole=adminRealm.getApplicationByName(Constants.ADMIN_CONSOLE_APPLICATION);
    TokenManager tm=new TokenManager();
    UserModel admin=adminRealm.getUser("admin");
    UserSessionModel userSession=adminRealm.createUserSession(admin,null);
    AccessToken token=tm.createClientAccessToken(null,adminRealm,adminConsole,admin,userSession);
    return tm.encodeToken(adminRealm,token);
  }
  finally {
    keycloakRule.stopSession(providerSession,true);
  }
}
