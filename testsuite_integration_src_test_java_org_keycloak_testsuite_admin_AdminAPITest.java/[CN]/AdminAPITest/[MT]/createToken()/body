{
  KeycloakSession session=keycloakRule.startSession();
  try {
    RealmManager manager=new RealmManager(session);
    RealmModel adminRealm=manager.getRealm(Config.getAdminRealm());
    ApplicationModel adminConsole=adminRealm.getApplicationByName(Constants.ADMIN_CONSOLE_APPLICATION);
    TokenManager tm=new TokenManager();
    UserModel admin=session.users().getUserByUsername("admin",adminRealm);
    UserSessionModel userSession=session.sessions().createUserSession(adminRealm,admin,"admin",null,"form",false);
    AccessToken token=tm.createClientAccessToken(tm.getAccess(null,adminConsole,admin),adminRealm,adminConsole,admin,userSession,null);
    return tm.encodeToken(adminRealm,token);
  }
  finally {
    keycloakRule.stopSession(session,true);
  }
}
