{
  UserRepresentation user1=new UserRepresentation();
  user1.setUsername("user1");
  user1.attribute("attr1","value1user1");
  user1.attribute("attr2","value2user1");
  Response response=realm.users().create(user1);
  String user1Id=ApiUtil.getCreatedId(response);
  response.close();
  UserRepresentation user2=new UserRepresentation();
  user2.setUsername("user2");
  user2.attribute("attr1","value1user2");
  user2.attribute("attr2","value2user2");
  response=realm.users().create(user2);
  String user2Id=ApiUtil.getCreatedId(response);
  response.close();
  user1=realm.users().get(user1Id).toRepresentation();
  assertEquals(2,user1.getAttributes().size());
  assertEquals("value1user1",user1.getAttributes().get("attr1"));
  assertEquals("value2user1",user1.getAttributes().get("attr2"));
  user2=realm.users().get(user2Id).toRepresentation();
  assertEquals(2,user2.getAttributes().size());
  assertEquals("value1user2",user2.getAttributes().get("attr1"));
  assertEquals("value2user2",user2.getAttributes().get("attr2"));
  user1.attribute("attr1","value3user1");
  user1.attribute("attr3","value4user1");
  realm.users().get(user1Id).update(user1);
  user1=realm.users().get(user1Id).toRepresentation();
  assertEquals(3,user1.getAttributes().size());
  assertEquals("value3user1",user1.getAttributes().get("attr1"));
  assertEquals("value2user1",user1.getAttributes().get("attr2"));
  assertEquals("value4user1",user1.getAttributes().get("attr3"));
  user1.getAttributes().remove("attr1");
  realm.users().get(user1Id).update(user1);
  user1=realm.users().get(user1Id).toRepresentation();
  assertEquals(2,user1.getAttributes().size());
  assertEquals("value2user1",user1.getAttributes().get("attr2"));
  assertEquals("value4user1",user1.getAttributes().get("attr3"));
  user1.getAttributes().clear();
  realm.users().get(user1Id).update(user1);
  user1=realm.users().get(user1Id).toRepresentation();
  assertNull(user1.getAttributes());
}
