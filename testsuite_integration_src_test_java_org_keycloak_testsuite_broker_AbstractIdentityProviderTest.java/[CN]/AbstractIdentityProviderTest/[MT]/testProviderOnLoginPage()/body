{
  IdentityProviderModel identityProviderModel=getIdentityProviderModel();
  RealmModel realm=getRealm();
  ClientModel clientModel=realm.getClientByClientId("test-app");
  ClientModel client2=realm.getClientByClientId("test-app");
  assertEquals(0,client2.getIdentityProviders().size());
  this.driver.navigate().to("http://localhost:8081/test-app/");
  assertTrue(this.driver.getCurrentUrl().startsWith("http://localhost:8081/auth/realms/realm-with-broker/protocol/openid-connect/auth"));
  loginPage.findSocialButton(getProviderId());
  List<ClientIdentityProviderMappingModel> appIdentityProviders=new ArrayList<ClientIdentityProviderMappingModel>();
  ClientIdentityProviderMappingModel mapping=new ClientIdentityProviderMappingModel();
  mapping.setIdentityProvider(getProviderId());
  mapping.setRetrieveToken(true);
  appIdentityProviders.add(mapping);
  clientModel.updateIdentityProviders(appIdentityProviders);
  this.driver.navigate().to("http://localhost:8081/test-app/");
  loginPage.findSocialButton(getProviderId());
}
