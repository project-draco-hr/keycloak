{
  RealmModel realm=installTestRealm();
  List<IdentityProviderModel> identityProviders=realm.getIdentityProviders();
  assertFalse(identityProviders.isEmpty());
  IdentityProviderModel identityProviderModel=identityProviders.get(0);
  String identityProviderId=identityProviderModel.getAlias();
  identityProviderModel.getConfig().put("config-added","value-added");
  identityProviderModel.setEnabled(false);
  identityProviderModel.setTrustEmail(true);
  identityProviderModel.setStoreToken(true);
  identityProviderModel.setAuthenticateByDefault(true);
  identityProviderModel.setFirstBrokerLoginFlowId(realm.getBrowserFlow().getId());
  realm.updateIdentityProvider(identityProviderModel);
  commit();
  realm=this.realmManager.getRealm(realm.getId());
  identityProviderModel=realm.getIdentityProviderByAlias(identityProviderId);
  assertEquals("value-added",identityProviderModel.getConfig().get("config-added"));
  assertFalse(identityProviderModel.isEnabled());
  assertTrue(identityProviderModel.isTrustEmail());
  assertTrue(identityProviderModel.isStoreToken());
  assertTrue(identityProviderModel.isAuthenticateByDefault());
  assertEquals(identityProviderModel.getFirstBrokerLoginFlowId(),realm.getBrowserFlow().getId());
  identityProviderModel.getConfig().remove("config-added");
  identityProviderModel.setEnabled(true);
  identityProviderModel.setTrustEmail(false);
  identityProviderModel.setAuthenticateByDefault(false);
  realm.updateIdentityProvider(identityProviderModel);
  commit();
  realm=this.realmManager.getRealm(realm.getId());
  identityProviderModel=realm.getIdentityProviderByAlias(identityProviderId);
  assertFalse(identityProviderModel.getConfig().containsKey("config-added"));
  assertTrue(identityProviderModel.isEnabled());
  assertFalse(identityProviderModel.isTrustEmail());
  assertFalse(identityProviderModel.isAuthenticateByDefault());
  this.realmManager.removeRealm(realm);
}
