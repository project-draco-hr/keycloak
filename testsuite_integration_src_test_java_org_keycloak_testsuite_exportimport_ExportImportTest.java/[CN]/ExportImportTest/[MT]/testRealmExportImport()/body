{
  ExportImportConfig.setAction(ExportImportConfig.ACTION_EXPORT);
  ExportImportConfig.setRealmName("test");
  keycloakRule.restartServer();
  KeycloakSession session=keycloakRule.startSession();
  try {
    RealmProvider realmProvider=session.realms();
    UserProvider userProvider=session.users();
    new RealmManager(session).removeRealm(realmProvider.getRealmByName("test"));
    Assert.assertEquals(2,realmProvider.getRealms().size());
    assertNotAuthenticated(userProvider,realmProvider,"test","test-user@localhost","password");
    assertNotAuthenticated(userProvider,realmProvider,"test","user1","password");
    assertNotAuthenticated(userProvider,realmProvider,"test","user2","password");
    assertNotAuthenticated(userProvider,realmProvider,"test","user3","password");
  }
  finally {
    keycloakRule.stopSession(session,true);
  }
  ExportImportConfig.setAction(ExportImportConfig.ACTION_IMPORT);
  keycloakRule.restartServer();
  session=keycloakRule.startSession();
  try {
    RealmProvider realmProvider=session.realms();
    UserProvider userProvider=session.users();
    Assert.assertEquals(3,realmProvider.getRealms().size());
    assertAuthenticated(userProvider,realmProvider,"test","test-user@localhost","password");
    assertAuthenticated(userProvider,realmProvider,"test","user1","password");
    assertAuthenticated(userProvider,realmProvider,"test","user2","password");
    assertAuthenticated(userProvider,realmProvider,"test","user3","password");
  }
  finally {
    keycloakRule.stopSession(session,true);
  }
}
