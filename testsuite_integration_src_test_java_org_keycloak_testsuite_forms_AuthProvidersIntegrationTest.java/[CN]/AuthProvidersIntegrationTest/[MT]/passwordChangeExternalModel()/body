{
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      adminstrationRealm.setPasswordPolicy(new PasswordPolicy("length(6)"));
    }
  }
);
  try {
    changePasswordPage.open();
    loginPage.login("mary-admin","password-admin");
    changePasswordPage.changePassword("password-admin","pass","pass");
    Assert.assertEquals("Invalid password: minimum length 6",profilePage.getError());
    changePasswordPage.changePassword("password-admin","password-updated","password-updated");
    Assert.assertEquals("Your password has been updated",profilePage.getSuccess());
    changePasswordPage.logout();
    loginPage.open();
    loginPage.login("mary-admin","password-updated");
    Assert.assertEquals(AppPage.RequestType.AUTH_RESPONSE,appPage.getRequestType());
  }
  finally {
    keycloakRule.update(new KeycloakRule.KeycloakSetup(){
      @Override public void config(      RealmManager manager,      RealmModel adminstrationRealm,      RealmModel appRealm){
        adminstrationRealm.setPasswordPolicy(new PasswordPolicy(null));
      }
    }
);
  }
}
