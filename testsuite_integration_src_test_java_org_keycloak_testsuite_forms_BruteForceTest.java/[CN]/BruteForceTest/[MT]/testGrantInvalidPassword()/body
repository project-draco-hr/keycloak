{
{
    String totpSecret=totp.generate("totpSecret");
    OAuthClient.AccessTokenResponse response=getTestToken("password",totpSecret);
    Assert.assertNotNull(response.getAccessToken());
    Assert.assertNull(response.getError());
    events.clear();
  }
{
    String totpSecret=totp.generate("totpSecret");
    OAuthClient.AccessTokenResponse response=getTestToken("invalid",totpSecret);
    Assert.assertNull(response.getAccessToken());
    Assert.assertEquals(response.getError(),"invalid_grant");
    Assert.assertEquals(response.getErrorDescription(),"Invalid user credentials");
    events.clear();
  }
{
    String totpSecret=totp.generate("totpSecret");
    OAuthClient.AccessTokenResponse response=getTestToken("invalid",totpSecret);
    Assert.assertNull(response.getAccessToken());
    Assert.assertEquals(response.getError(),"invalid_grant");
    Assert.assertEquals(response.getErrorDescription(),"Invalid user credentials");
    events.clear();
  }
{
    String totpSecret=totp.generate("totpSecret");
    OAuthClient.AccessTokenResponse response=getTestToken("password",totpSecret);
    Assert.assertNull(response.getAccessToken());
    Assert.assertNotNull(response.getError());
    Assert.assertEquals(response.getError(),"invalid_grant");
    Assert.assertEquals(response.getErrorDescription(),"Account temporarily disabled");
    events.clear();
  }
  clearUserFailures();
{
    String totpSecret=totp.generate("totpSecret");
    OAuthClient.AccessTokenResponse response=getTestToken("password",totpSecret);
    Assert.assertNotNull(response.getAccessToken());
    Assert.assertNull(response.getError());
    events.clear();
  }
}
