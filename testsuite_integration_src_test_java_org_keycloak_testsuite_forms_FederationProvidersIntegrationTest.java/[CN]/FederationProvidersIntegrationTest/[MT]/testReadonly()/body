{
  KeycloakSession session=keycloakRule.startSession();
  RealmModel appRealm=session.realms().getRealmByName("test");
  UserFederationProviderModel model=new UserFederationProviderModel(ldapModel.getId(),ldapModel.getProviderName(),ldapModel.getConfig(),ldapModel.getPriority(),ldapModel.getDisplayName());
  model.getConfig().put(LDAPFederationProvider.EDIT_MODE,UserFederationProvider.EditMode.READ_ONLY.toString());
  appRealm.updateUserFederationProvider(model);
  UserModel user=session.users().getUserByUsername("johnkeycloak",appRealm);
  Assert.assertNotNull(user);
  Assert.assertNotNull(user.getFederationLink());
  Assert.assertEquals(user.getFederationLink(),ldapModel.getId());
  try {
    user.setEmail("error@error.com");
    Assert.fail("should fail");
  }
 catch (  Exception e) {
  }
  try {
    user.setLastName("Berk");
    Assert.fail("should fail");
  }
 catch (  Exception e) {
  }
  try {
    user.setFirstName("Bilbo");
    Assert.fail("should fail");
  }
 catch (  Exception e) {
  }
  try {
    UserCredentialModel cred=UserCredentialModel.password("poop");
    user.updateCredential(cred);
    Assert.fail("should fail");
  }
 catch (  Exception e) {
  }
  session.getTransaction().rollback();
  session.close();
  session=keycloakRule.startSession();
  appRealm=session.realms().getRealmByName("test");
  Assert.assertEquals(UserFederationProvider.EditMode.WRITABLE.toString(),appRealm.getUserFederationProviders().get(0).getConfig().get(LDAPFederationProvider.EDIT_MODE));
  keycloakRule.stopSession(session,false);
}
