{
  KeycloakSession session=keycloakRule.startSession();
  UserModel user=session.users().addUser(session.realms().getRealmByName("test"),"login@test.com");
  user.setEnabled(true);
  user.updateCredential(UserCredentialModel.password("password"));
  keycloakRule.stopSession(session,true);
  loginPage.open();
  loginPage.login("login@test.com","password");
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  Assert.assertNotNull(oauth.getCurrentQuery().get(OAuth2Constants.CODE));
  events.expectLogin().user(userId).detail(Details.USERNAME,"login@test.com").assertEvent();
}
