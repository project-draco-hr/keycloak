{
  keycloakRule.configure(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.setPasswordPolicy(new PasswordPolicy("length"));
    }
  }
);
  loginPage.open();
  loginPage.resetPassword();
  resetPasswordPage.assertCurrent();
  resetPasswordPage.changePassword("test-user@localhost");
  resetPasswordPage.assertCurrent();
  Assert.assertEquals("You should receive an email shortly with further instructions.",resetPasswordPage.getMessage());
  Assert.assertEquals(1,greenMail.getReceivedMessages().length);
  MimeMessage message=greenMail.getReceivedMessages()[0];
  String body=(String)message.getContent();
  String changePasswordUrl=body.split("\n")[3];
  driver.navigate().to(changePasswordUrl.trim());
  updatePasswordPage.assertCurrent();
  updatePasswordPage.changePassword("invalid","invalid");
  Assert.assertNotEquals("Success!",resetPasswordPage.getMessage());
  Assert.assertEquals("Invalid password: minimum length 8",resetPasswordPage.getMessage());
  updatePasswordPage.changePassword("new-password","new-password");
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  oauth.openLogout();
  loginPage.open();
  loginPage.login("test-user@localhost","new-password");
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
}
