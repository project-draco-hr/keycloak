{
  loginPage.open();
  loginPage.login("test-user@localhost","password");
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  Assert.assertNotNull(oauth.getCurrentQuery().get(OAuth2Constants.CODE));
  events.expectLogin().assertEvent();
  appPage.open();
  oauth.openLoginForm();
  Assert.assertEquals(RequestType.AUTH_RESPONSE,appPage.getRequestType());
  profilePage.open();
  Assert.assertTrue(profilePage.isCurrent());
  events.expectLogin().detail(Details.AUTH_METHOD,"sso").removeDetail(Details.USERNAME).client("test-app").assertEvent();
}
