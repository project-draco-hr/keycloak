{
  test1CreateRealm();
  UserProvider userProvider=realmManager.getSession().users();
  UserModel user=userProvider.addUser(realmModel,"bburke");
  UserCredentialModel cred=new UserCredentialModel();
  cred.setType(CredentialRepresentation.PASSWORD);
  cred.setValue("geheim");
  user.updateCredential(cred);
  Assert.assertTrue(userProvider.validCredentials(session,realmModel,user,UserCredentialModel.password("geheim")));
  List<UserCredentialValueModel> creds=user.getCredentialsDirectly();
  Assert.assertEquals(creds.get(0).getHashIterations(),20000);
  realmModel.setPasswordPolicy(PasswordPolicy.parse(realmManager.getSession(),"hashIterations(200)"));
  Assert.assertTrue(userProvider.validCredentials(session,realmModel,user,UserCredentialModel.password("geheim")));
  creds=user.getCredentialsDirectly();
  Assert.assertEquals(creds.get(0).getHashIterations(),200);
  realmModel.setPasswordPolicy(PasswordPolicy.parse(realmManager.getSession(),"hashIterations(1)"));
}
