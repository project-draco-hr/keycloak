{
  int lifespan=realm.getAccessCodeLifespanUserAction();
  try {
    authFormWithTotpPasswordToken();
    realm.setAccessCodeLifespanUserAction(1);
    formData.remove(CredentialRepresentation.PASSWORD_TOKEN);
    String passwordToken=new JWSBuilder().jsonContent(new PasswordToken(realm.getName(),"invalid")).rsa256(realm.getPrivateKey());
    formData.add(CredentialRepresentation.PASSWORD_TOKEN,passwordToken);
    Time.setOffset(2);
    AuthenticationStatus status=am.authenticateForm(session,dummyConnection,realm,formData);
    Assert.assertEquals(AuthenticationStatus.INVALID_CREDENTIALS,status);
    Time.setOffset(0);
  }
  finally {
    realm.setAccessCodeLifespanUserAction(lifespan);
  }
}
