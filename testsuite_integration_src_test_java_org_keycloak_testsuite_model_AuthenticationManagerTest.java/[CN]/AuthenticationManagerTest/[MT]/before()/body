{
  super.before();
  realm=realmManager.createRealm("TestAuth");
  realm.setAccessCodeLifespan(100);
  realm.setEnabled(true);
  realm.setName("TestAuth");
  KeycloakModelUtils.generateRealmKeys(realm);
  realm.setAccessTokenLifespan(1000);
  realm.addRequiredCredential(CredentialRepresentation.PASSWORD);
  protector=ResteasyProviderFactory.getContextData(BruteForceProtector.class);
  am=new AuthenticationManager(protector);
  user=realmManager.getSession().users().addUser(realm,"test");
  user.setEnabled(true);
  UserCredentialModel credential=new UserCredentialModel();
  credential.setType(CredentialRepresentation.PASSWORD);
  credential.setValue("password");
  user.updateCredential(credential);
  formData=new MultivaluedMapImpl<String,String>();
  formData.add("username","test");
  formData.add(CredentialRepresentation.PASSWORD,"password");
  otp=new TimeBasedOTP();
}
