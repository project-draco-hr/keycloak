{
  RealmModel realm=realmManager.getRealm("original");
  RoleModel realmRole=realm.getRole("realm-role");
  String realmRoleId=realmRole.getId();
  realm.removeRole(realmRole);
  commit();
  realm=realmManager.getRealm("original");
  Map<String,ClientModel> clients=realm.getClientNameMap();
  ClientModel fooClient=clients.get("foo-client");
  ClientModel barClient=clients.get("bar-client");
  UserModel john=session.users().getUserByUsername("john",realm);
  GrantedConsentModel johnConsent=john.getGrantedConsentByClient(fooClient.getId());
  Assert.assertEquals(johnConsent.getGrantedRoles().size(),1);
  Assert.assertEquals(johnConsent.getGrantedProtocolMappers().size(),1);
  Assert.assertFalse(johnConsent.isRoleGranted(realmRoleId));
  Assert.assertTrue(isRoleGranted(barClient,"bar-client-role",johnConsent));
}
