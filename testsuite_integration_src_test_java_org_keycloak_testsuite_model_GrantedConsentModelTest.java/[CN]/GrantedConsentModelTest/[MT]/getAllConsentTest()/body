{
  RealmModel realm=realmManager.getRealm("original");
  Map<String,ClientModel> clients=realm.getClientNameMap();
  ClientModel fooClient=clients.get("foo-client");
  UserModel john=session.users().getUserByUsername("john",realm);
  UserModel mary=session.users().getUserByUsername("mary",realm);
  List<GrantedConsentModel> johnConsents=john.getGrantedConsents();
  Assert.assertEquals(2,johnConsents.size());
  List<GrantedConsentModel> maryConsents=mary.getGrantedConsents();
  Assert.assertEquals(1,maryConsents.size());
  GrantedConsentModel maryConsent=maryConsents.get(0);
  Assert.assertEquals(maryConsent.getClientId(),fooClient.getId());
  Assert.assertEquals(maryConsent.getGrantedRoles().size(),1);
  Assert.assertEquals(maryConsent.getGrantedProtocolMappers().size(),1);
  Assert.assertTrue(isRoleGranted(realm,"realm-role",maryConsent));
  Assert.assertTrue(isMapperGranted(fooClient,"foo",maryConsent));
}
