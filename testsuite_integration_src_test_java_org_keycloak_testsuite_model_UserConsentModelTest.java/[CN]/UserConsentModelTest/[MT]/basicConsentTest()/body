{
  RealmModel realm=realmManager.getRealm("original");
  ClientModel fooClient=realm.getClientByClientId("foo-client");
  ClientModel barClient=realm.getClientByClientId("bar-client");
  UserModel john=session.users().getUserByUsername("john",realm);
  UserModel mary=session.users().getUserByUsername("mary",realm);
  UserConsentModel johnFooConsent=realmManager.getSession().users().getConsentByClient(realm,john.getId(),fooClient.getId());
  Assert.assertEquals(johnFooConsent.getGrantedRoles().size(),2);
  Assert.assertEquals(johnFooConsent.getGrantedProtocolMappers().size(),1);
  Assert.assertTrue(isRoleGranted(realm,"realm-role",johnFooConsent));
  Assert.assertTrue(isRoleGranted(barClient,"bar-client-role",johnFooConsent));
  Assert.assertTrue(isMapperGranted(fooClient,"foo",johnFooConsent));
  Assert.assertNotNull("Created Date should be set",johnFooConsent.getCreatedDate());
  Assert.assertNotNull("Last Updated Date should be set",johnFooConsent.getLastUpdatedDate());
  UserConsentModel johnBarConsent=realmManager.getSession().users().getConsentByClient(realm,john.getId(),barClient.getId());
  Assert.assertEquals(johnBarConsent.getGrantedRoles().size(),1);
  Assert.assertEquals(johnBarConsent.getGrantedProtocolMappers().size(),1);
  Assert.assertTrue(isRoleGranted(realm,"realm-role",johnBarConsent));
  Assert.assertTrue(isMapperGranted(barClient,"bar",johnBarConsent));
  Assert.assertNotNull("Created Date should be set",johnBarConsent.getCreatedDate());
  Assert.assertNotNull("Last Updated Date should be set",johnBarConsent.getLastUpdatedDate());
  UserConsentModel maryConsent=realmManager.getSession().users().getConsentByClient(realm,mary.getId(),fooClient.getId());
  Assert.assertEquals(maryConsent.getGrantedRoles().size(),1);
  Assert.assertEquals(maryConsent.getGrantedProtocolMappers().size(),1);
  Assert.assertTrue(isRoleGranted(realm,"realm-role",maryConsent));
  Assert.assertFalse(isRoleGranted(barClient,"bar-client-role",maryConsent));
  Assert.assertTrue(isMapperGranted(fooClient,"foo",maryConsent));
  Assert.assertNotNull("Created Date should be set",maryConsent.getCreatedDate());
  Assert.assertNotNull("Last Updated Date should be set",maryConsent.getLastUpdatedDate());
  Assert.assertNull(realmManager.getSession().users().getConsentByClient(realm,mary.getId(),barClient.getId()));
}
