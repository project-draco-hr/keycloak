{
  RealmModel realm=realmManager.createRealm("original");
  ClientModel fooClient=realm.addClient("foo");
  ClientModel barClient=realm.addClient("bar");
  UserModel user1=session.users().addUser(realm,"user1");
  UserModel user2=session.users().addUser(realm,"user2");
  addOfflineUserSession(realm,user1,"123","something1");
  addOfflineClientSession(realm,user1,"456","123",fooClient.getId(),"something2");
  addOfflineClientSession(realm,user1,"789","123",barClient.getId(),"something3");
  addOfflineUserSession(realm,user2,"2123","something4");
  addOfflineClientSession(realm,user2,"2456","2123",fooClient.getId(),"something5");
  commit();
  Assert.assertEquals(2,session.users().getOfflineClientSessionsCount(realm,fooClient));
  Assert.assertEquals(1,session.users().getOfflineClientSessionsCount(realm,barClient));
  Collection<OfflineClientSessionModel> clientSessions=session.users().getOfflineClientSessions(realm,fooClient,0,10);
  Assert.assertEquals(2,clientSessions.size());
  clientSessions=session.users().getOfflineClientSessions(realm,fooClient,0,1);
  OfflineClientSessionModel cls=clientSessions.iterator().next();
  assertSessionEquals(cls,"456","123",fooClient.getId(),user1.getId(),"something2");
  clientSessions=session.users().getOfflineClientSessions(realm,fooClient,1,1);
  cls=clientSessions.iterator().next();
  assertSessionEquals(cls,"2456","2123",fooClient.getId(),user2.getId(),"something5");
  clientSessions=session.users().getOfflineClientSessions(realm,barClient,0,10);
  Assert.assertEquals(1,clientSessions.size());
  cls=clientSessions.iterator().next();
  assertSessionEquals(cls,"789","123",barClient.getId(),user1.getId(),"something3");
  realm=realmManager.getRealmByName("original");
  realm.removeClient(barClient.getId());
  commit();
  realm=realmManager.getRealmByName("original");
  user1=session.users().getUserByUsername("user1",realm);
  Assert.assertEquals("something1",session.users().getOfflineUserSession(realm,user1,"123").getData());
  Assert.assertEquals("something2",session.users().getOfflineClientSession(realm,user1,"456").getData());
  Assert.assertNull(session.users().getOfflineClientSession(realm,user1,"789"));
  realm.removeClient(fooClient.getId());
  commit();
  realm=realmManager.getRealmByName("original");
  user1=session.users().getUserByUsername("user1",realm);
  Assert.assertNull(session.users().getOfflineClientSession(realm,user1,"456"));
  Assert.assertNull(session.users().getOfflineClientSession(realm,user1,"789"));
  Assert.assertNull(session.users().getOfflineUserSession(realm,user1,"123"));
  Assert.assertEquals(0,session.users().getOfflineUserSessions(realm,user1).size());
  Assert.assertEquals(0,session.users().getOfflineClientSessions(realm,user1).size());
}
