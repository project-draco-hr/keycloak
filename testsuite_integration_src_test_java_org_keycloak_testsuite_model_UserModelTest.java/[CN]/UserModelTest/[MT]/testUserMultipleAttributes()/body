{
  RealmModel realm=realmManager.createRealm("original");
  UserModel user=session.users().addUser(realm,"user");
  UserModel userNoAttrs=session.users().addUser(realm,"user-noattrs");
  user.setSingleAttribute("key1","value1");
  List<String> attrVals=new ArrayList<>(Arrays.asList("val21","val22"));
  user.setAttribute("key2",attrVals);
  commit();
  realm=realmManager.getRealmByName("original");
  user=session.users().getUserByUsername("user",realm);
  attrVals=user.getAttribute("key1");
  Assert.assertEquals(1,attrVals.size());
  Assert.assertEquals("value1",attrVals.get(0));
  Assert.assertEquals("value1",user.getFirstAttribute("key1"));
  attrVals=user.getAttribute("key2");
  Assert.assertEquals(2,attrVals.size());
  Assert.assertTrue(attrVals.contains("val21"));
  Assert.assertTrue(attrVals.contains("val22"));
  attrVals=user.getAttribute("key3");
  Assert.assertTrue(attrVals.isEmpty());
  Assert.assertNull(user.getFirstAttribute("key3"));
  Map<String,List<String>> allAttrVals=user.getAttributes();
  Assert.assertEquals(2,allAttrVals.size());
  Assert.assertEquals(allAttrVals.get("key1"),user.getAttribute("key1"));
  Assert.assertEquals(allAttrVals.get("key2"),user.getAttribute("key2"));
  user.removeAttribute("key1");
  user.setSingleAttribute("key2","val23");
  commit();
  realm=realmManager.getRealmByName("original");
  user=session.users().getUserByUsername("user",realm);
  Assert.assertNull(user.getFirstAttribute("key1"));
  attrVals=user.getAttribute("key2");
  Assert.assertEquals(1,attrVals.size());
  Assert.assertEquals("val23",attrVals.get(0));
}
