{
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.getApplicationNameMap().get("test-app").addRedirectUri(Constants.INSTALLED_APP_URN);
    }
  }
);
  oauth.redirectUri(Constants.INSTALLED_APP_URN);
  oauth.doLogin("test-user@localhost","password");
  String title=driver.getTitle();
  Assert.assertTrue(title.startsWith("Success code="));
  String code=driver.findElement(By.id(OAuth2Constants.CODE)).getText();
  oauth.verifyCode(code);
  String codeId=events.expectLogin().detail(Details.REDIRECT_URI,Constants.INSTALLED_APP_URN).assertEvent().getDetails().get(Details.CODE_ID);
  Assert.assertEquals(codeId,new JWSInput(code).readContentAsString());
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.getApplicationNameMap().get("test-app").removeRedirectUri(Constants.INSTALLED_APP_URN);
    }
  }
);
}
