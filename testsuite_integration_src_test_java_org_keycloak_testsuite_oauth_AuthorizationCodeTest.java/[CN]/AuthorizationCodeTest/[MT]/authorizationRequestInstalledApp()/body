{
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.getClientNameMap().get("test-app").addRedirectUri(Constants.INSTALLED_APP_URN);
    }
  }
);
  oauth.redirectUri(Constants.INSTALLED_APP_URN);
  oauth.doLogin("test-user@localhost","password");
  String title=driver.getTitle();
  Assert.assertEquals("Success code",title);
  String code=driver.findElement(By.id(OAuth2Constants.CODE)).getAttribute("value");
  keycloakRule.verifyCode(code);
  String codeId=events.expectLogin().detail(Details.REDIRECT_URI,"http://localhost:8081/auth/realms/test/protocol/openid-connect/oauth/oob").assertEvent().getDetails().get(Details.CODE_ID);
  assertCode(codeId,code);
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.getClientNameMap().get("test-app").removeRedirectUri(Constants.INSTALLED_APP_URN);
    }
  }
);
}
