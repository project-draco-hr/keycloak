{
  keycloakRule.update(new KeycloakRule.KeycloakSetup(){
    @Override public void config(    RealmManager manager,    RealmModel adminstrationRealm,    RealmModel appRealm){
      appRealm.getApplicationByName("test-app").addRedirectUri(oauth.getRedirectUri());
    }
  }
);
  oauth.state("mystate");
  AuthorizationCodeResponse response=oauth.doLogin("test-user@localhost","password");
  Assert.assertTrue(response.isRedirected());
  Assert.assertNotNull(response.getCode());
  oauth.verifyCode(response.getCode());
  String codeId=events.expectLogin().assertEvent().getDetails().get(Details.CODE_ID);
  AccessCode accessCode=new JWSInput(response.getCode()).readJsonContent(AccessCode.class);
  Assert.assertEquals(codeId,accessCode.getId());
}
