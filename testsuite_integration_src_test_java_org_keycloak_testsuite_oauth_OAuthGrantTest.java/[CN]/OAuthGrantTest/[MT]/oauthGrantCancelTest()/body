{
  oauth.clientId("third-party");
  oauth.doLoginGrant("test-user@localhost","password");
  grantPage.assertCurrent();
  Assert.assertTrue(driver.getPageSource().contains(ROLE_USER));
  Assert.assertTrue(driver.getPageSource().contains(ROLE_CUSTOMER));
  grantPage.cancel();
  Assert.assertTrue(oauth.getCurrentQuery().containsKey(OAuth2Constants.ERROR));
  assertEquals("access_denied",oauth.getCurrentQuery().get(OAuth2Constants.ERROR));
  events.expectLogin().client("third-party").error("rejected_by_user").removeDetail(Details.CONSENT).assertEvent();
}
