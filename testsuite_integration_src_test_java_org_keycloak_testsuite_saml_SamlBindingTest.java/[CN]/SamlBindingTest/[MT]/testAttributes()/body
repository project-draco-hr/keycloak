{
  SamlSPFacade.samlResponse=null;
  driver.navigate().to("http://localhost:8081/employee/");
  Assert.assertTrue(driver.getCurrentUrl().startsWith("http://localhost:8081/auth/realms/demo/protocol/saml"));
  System.out.println(driver.getCurrentUrl());
  loginPage.login("bburke","password");
  Assert.assertEquals(driver.getCurrentUrl(),"http://localhost:8081/employee/");
  Assert.assertNotNull(SamlSPFacade.samlResponse);
  SAML2Response saml2Response=new SAML2Response();
  byte[] samlResponse=PostBindingUtil.base64Decode(SamlSPFacade.samlResponse);
  ResponseType rt=saml2Response.getResponseType(new ByteArrayInputStream(samlResponse));
  Assert.assertTrue(rt.getAssertions().size() == 1);
  AssertionType assertion=rt.getAssertions().get(0).getAssertion();
  boolean email=false;
  boolean phone=false;
  for (  AttributeStatementType statement : assertion.getAttributeStatements()) {
    for (    AttributeStatementType.ASTChoiceType choice : statement.getAttributes()) {
      AttributeType attr=choice.getAttribute();
      if (X500SAMLProfileConstants.EMAIL.getFriendlyName().equals(attr.getFriendlyName())) {
        Assert.assertEquals(X500SAMLProfileConstants.EMAIL.get(),attr.getName());
        Assert.assertEquals(JBossSAMLURIConstants.ATTRIBUTE_FORMAT_URI.get(),attr.getNameFormat());
        Assert.assertEquals(attr.getAttributeValue().get(0),"bburke@redhat.com");
        email=true;
      }
 else       if (attr.getName().equals("phone")) {
        Assert.assertEquals(JBossSAMLURIConstants.ATTRIBUTE_FORMAT_BASIC.get(),attr.getNameFormat());
        Assert.assertEquals(attr.getAttributeValue().get(0),"617");
        phone=true;
      }
    }
  }
  Assert.assertTrue(email);
  Assert.assertTrue(phone);
}
