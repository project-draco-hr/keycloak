{
  resp.setContentType("text/html");
  String action=req.getParameter("action");
  String actionDone=null;
  if (action != null) {
    if (action.equals("code")) {
      keycloakLoginRedirect(req,resp);
      return;
    }
 else     if (action.equals("exchangeCode")) {
      exchangeCodeForToken(req,resp);
      actionDone="Token retrieved";
    }
 else     if (action.equals("refresh")) {
      refreshToken(req,resp);
      actionDone="Token refreshed";
    }
 else     if (action.equals("logout")) {
      logoutRedirect(req,resp);
      return;
    }
  }
  String code=req.getParameter("code");
  if (code != null) {
    req.getSession().setAttribute("code",code);
    actionDone="Code retrieved";
  }
  String freemarkerRedirect=freemarkerRedirect(req,resp,actionDone);
  resp.getWriter().println(freemarkerRedirect);
  resp.getWriter().flush();
}
