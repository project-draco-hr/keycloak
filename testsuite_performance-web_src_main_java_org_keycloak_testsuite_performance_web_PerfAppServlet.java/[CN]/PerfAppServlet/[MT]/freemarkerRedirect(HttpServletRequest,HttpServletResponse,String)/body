{
  AccessToken accessTokenParsed=(AccessToken)req.getSession().getAttribute("accessTokenParsed");
  RefreshToken refreshTokenParsed=(RefreshToken)req.getSession().getAttribute("refreshTokenParsed");
  Map<String,Object> attributes=new HashMap<String,Object>();
  attributes.put("requestURI",req.getRequestURI());
  attributes.put("code",req.getSession().getAttribute("code"));
  attributes.put("accessToken",req.getSession().getAttribute("accessToken"));
  attributes.put("refreshToken",req.getSession().getAttribute("refreshToken"));
  attributes.put("accessTokenParsed",accessTokenParsed);
  attributes.put("refreshTokenParsed",refreshTokenParsed);
  attributes.put("actionDone",actionDone);
  if (accessTokenParsed != null) {
    attributes.put("accessTokenExpiration",Time.toDate(accessTokenParsed.getExpiration()).toString());
  }
  if (refreshTokenParsed != null) {
    attributes.put("refreshTokenExpiration",Time.toDate(refreshTokenParsed.getExpiration()).toString());
  }
  try {
    Writer out=new StringWriter();
    indexTemplate.process(attributes,out);
    return out.toString();
  }
 catch (  TemplateException te) {
    throw new ServletException(te);
  }
}
