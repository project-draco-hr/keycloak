{
  SampleResult result=new SampleResult();
  result.sampleStart();
  if (!setupSuccess) {
    getLogger().error("setupTest didn't executed successfully. Skipping");
    result.setResponseCode("500");
    result.sampleEnd();
    result.setSuccessful(true);
    return result;
  }
  KeycloakSession session=factory.create();
  KeycloakTransaction transaction=session.getTransaction();
  try {
    transaction.begin();
    worker.run(result,session);
    result.setResponseCodeOK();
    transaction.commit();
  }
 catch (  Exception e) {
    getLogger().error("Error during worker processing",e);
    result.setResponseCode("500");
    transaction.rollback();
  }
 finally {
    result.sampleEnd();
    result.setSuccessful(true);
    session.close();
  }
  return result;
}
