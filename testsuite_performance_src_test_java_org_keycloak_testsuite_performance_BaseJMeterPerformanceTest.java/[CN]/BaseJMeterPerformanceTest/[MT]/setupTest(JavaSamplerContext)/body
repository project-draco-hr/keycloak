{
  super.setupTest(context);
  worker=getWorker();
  factory=getFactory();
  ProviderSession providerSession=factory.createSession();
  KeycloakSession identitySession=providerSession.getProvider(KeycloakSession.class);
  KeycloakTransaction transaction=identitySession.getTransaction();
  transaction.begin();
  int workerId=counter.getAndIncrement();
  try {
    worker.setup(workerId,identitySession);
    setupSuccess=true;
  }
  finally {
    if (setupSuccess) {
      transaction.commit();
    }
 else {
      transaction.rollback();
    }
    providerSession.close();
  }
}
