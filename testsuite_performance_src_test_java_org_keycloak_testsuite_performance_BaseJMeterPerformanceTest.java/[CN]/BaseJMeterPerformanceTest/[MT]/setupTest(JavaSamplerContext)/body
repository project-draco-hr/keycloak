{
  super.setupTest(context);
  worker=getWorker();
  factory=getFactory();
  getLogger().info("Retrieved factory: " + factory);
  KeycloakSession session=factory.create();
  KeycloakTransaction transaction=session.getTransaction();
  transaction.begin();
  int workerId=counter.getAndIncrement();
  try {
    worker.setup(workerId,session);
    setupSuccess=true;
  }
  finally {
    if (setupSuccess) {
      transaction.commit();
    }
 else {
      transaction.rollback();
    }
    session.close();
  }
}
