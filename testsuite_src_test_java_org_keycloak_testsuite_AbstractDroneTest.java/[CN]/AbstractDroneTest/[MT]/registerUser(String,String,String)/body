{
  selenium.open(appUrl.toString());
  selenium.waitForPageToLoad(DEFAULT_WAIT);
  selenium.click("link=Register");
  selenium.waitForPageToLoad(DEFAULT_WAIT);
  selenium.type("id=name","Test User");
  selenium.type("id=email","test@user.com");
  if (username != null) {
    selenium.type("id=username",username);
  }
  if (password != null) {
    selenium.type("id=password",password);
    selenium.type("id=password-confirm",password);
  }
  selenium.click("css=input[type=\"submit\"]");
  selenium.waitForPageToLoad(DEFAULT_WAIT);
  if (expectErrorMessage == null) {
    Assert.assertEquals(username,selenium.getText("id=user"));
  }
 else {
    Assert.assertTrue(selenium.isTextPresent(expectErrorMessage));
  }
}
