{
  job.start();
  KeycloakSession session=sessionFactory.create();
  try {
    session.getTransaction().begin();
    RealmModel realm=new RealmManager(session).getRealmByName(realmName);
    Map<String,ApplicationModel> apps=realm.getApplicationNameMap();
    Set<RoleModel> realmRoles=realm.getRoles();
    Map<String,Set<RoleModel>> appRoles=new HashMap<String,Set<RoleModel>>();
    for (    Map.Entry<String,ApplicationModel> appEntry : apps.entrySet()) {
      appRoles.put(appEntry.getKey(),appEntry.getValue().getRoles());
    }
    for (int i=start; i < (start + count); i++) {
      runIteration(realm,apps,realmRoles,appRoles,i);
      job.increment();
    }
    session.getTransaction().commit();
  }
 catch (  Throwable t) {
    handleThrowable(t,session);
  }
 finally {
    latch.countDown();
    session.close();
  }
}
